[
  {
    "objectID": "chapter 6.html",
    "href": "chapter 6.html",
    "title": "7  Продукционная модель JABBA",
    "section": "",
    "text": "7.1 Введение\nБиблиотека JABBA https://github.com/jabbamodel/JABBA - оценка запаса с помощью стохастической версии продукционной модели и байесовского подхода. JABBA и SPiCT – наиболее распространенные в международной практике инструменты, реализующие продукционный подход к оценке запасов гидробионтов при нехватки данных.\nПомимо R JABBA требует дополнительно установки JAGS. Для демонстрации основных функций пакета в настоящем скрипте используются входные данные из примера SPiCT, поэтому в скрипте демонстрации модели JABBA сценарий моделирования назван “SPiCT_adapted”.\nСкрипт этого практического занятия можно скачать по ссылке.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Продукционная модель JABBA</span>"
    ]
  },
  {
    "objectID": "chapter 6.html#подготовка-среды-и-загрузка-данных",
    "href": "chapter 6.html#подготовка-среды-и-загрузка-данных",
    "title": "7  Продукционная модель JABBA",
    "section": "7.2 Подготовка среды и загрузка данных",
    "text": "7.2 Подготовка среды и загрузка данных\nВ данном разделе выполняется базовая настройка среды R для работы с пакетом JABBA. Инициируется загрузка двух необходимых пакетов: JABBA (основной инструмент оценки запасов) и reshape2 (для преобразования структур данных). Создается целевая директория “NEW JABBA” для автоматического сохранения всех результатов анализа, после чего рабочая среда переключается на эту папку.\nФормируются три обязательных компонента входных данных:\n\nДанные по вылову (catch): Годовые значения уловов за 20-летний период (2005-2024 гг.), представленные в виде вектора из 20 числовых значений.\nДва индекса обилия:\n\n\nCPUE (улов на единицу усилия): 20 наблюдений\nBESS (альтернативный индекс, например, данные съемок): 19 наблюдений (первое значение отсутствует, обозначено как NA)\n\n\nСтандартные ошибки (SE) для индексов: Для упрощения примера задаются фиксированным коэффициентом вариации (CV=20%). Это означает, что для каждого ненулевого значения индекса SE рассчитывается как 20% от его величины. Пропуски в индексах (NA) автоматически сохраняются как NA в таблице SE.\n\nВсе данные структурируются в три таблицы с единой временной осью (2005-2024 гг.): отдельно для уловов, значений индексов и их стандартных ошибок. Эта подготовка обеспечивает корректный формат входных данных, необходимых для последующего построения продукционной модели в JABBA.\n\n# ------------------------- 1. ПОДГОТОВКА СРЕДЫ ---------------------------\n\n# Загрузка необходимых пакетов\nlibrary(JABBA) # Основной пакет для оценки запасов\nlibrary(reshape2) # Для преобразования данных (функция dcast)\n\n# Установка рабочей директории (папки, где будут храниться результаты)\nsetwd(\"C:/BAKANEV/JABBA\")\n\n# Создание папки для результатов анализа\nassessment &lt;- \"NEW JABBA\" # Название оценки\noutput.dir &lt;- file.path(getwd(), assessment) # Создание пути к папке\ndir.create(output.dir, showWarnings = FALSE) # Создание папки (если не существует)\nsetwd(output.dir) # Переход в созданную папку\n\n# ------------------------- 2. ЗАГРУЗКА И ПОДГОТОВКА ДАННЫХ ---------------------------\n\n# Создание вектора лет анализа\nYear &lt;- 2005:2024 # Последовательность лет от 2005 до 2024\n\n# Вектор данных об уловах (catch)\nCatch &lt;- c(5,7,6,10,14,25,28,30,32,35,25,20,15,12,10,12,10,13,11,12)\n\n# Вектор данных индекса обилия CPUE (catch per unit effort)\nCPUE &lt;- c(27.4,26.8,16.8,23.0,29.0,30.0,16.5,17.2,10.5,14.6,8.3,11.4,15.5,13.8,11.5,15.3,12.2,15.6,16.2,13.4)\n# Вектор данных индекса обилия BESS\nBESS &lt;- c(NA,16.3,20.7,15.1,18.6,16.0,13.8,13.3,11.7,11.8,9.3,7.1,8.0,9.2,10.3,9.8,10.3,11.7,13.7,13.4)\n\n# Форматирование данных в таблицы для JABBA\ncatch_data &lt;- data.frame(year = Year, catch = Catch) # Таблица уловов\ncpue_data &lt;- data.frame(year = Year, CPUE = CPUE, BESS = BESS) # Таблица индексов\n\n# Расчет стандартных ошибок (SE) для индексов\n# Используем коэффициент вариации (CV) = 20% (0.2)\n\nse_data &lt;- data.frame(\n year = Year,\n CPUE = ifelse(is.na(CPUE), NA, 0.2),\n BESS = ifelse(is.na(BESS), NA, 0.2))",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Продукционная модель JABBA</span>"
    ]
  },
  {
    "objectID": "chapter 6.html#настройка-и-запуск-модели-jabba",
    "href": "chapter 6.html#настройка-и-запуск-модели-jabba",
    "title": "7  Продукционная модель JABBA",
    "section": "7.3 Настройка и запуск модели JABBA",
    "text": "7.3 Настройка и запуск модели JABBA\nВ этом разделе выполняется конфигурация и запуск JABBA. Сначала с помощью функции build_jabba формируется структура входных данных для модели, куда передаются подготовленные таблицы уловов, индексов CPUE/BESS и их стандартных ошибок. Указывается название оценки (“NEW JABBA”) и сценарий моделирования (“SPiCT_adapted”). В качестве биологической основы выбрана модель Шефера (логистический рост). Настраиваются ключевые априорные распределения: для темпа роста популяции (r) задано нормальное распределение N(0.2±0.5), для емкости среды (K) - логнормальное LN(189.6±0.795), для начальной заполненности запаса (ψ) - бета-распределение Beta(0.75±0.25). Установлена оценка процессной ошибки (sigma.est=TRUE) и слабоинформативные априоры для дисперсии наблюдений.\nНепосредственный запуск Байесовской оценки выполняется функцией fit_jabba, которая использует MCMC-алгоритм. Конфигурация MCMC включает 50,000 итераций с отбрасыванием первых 10,000 (фаза “burn-in”), прореживанием цепей в 5 раз и запуском 2 независимых цепей для проверки сходимости. Результатом работы является объект fit, содержащий апостериорные распределения параметров, оценки биомассы и диагностику модели, которые будут использоваться для последующего анализа состояния запаса.\n\n# ------------------- 3. НАСТРОЙКА И ЗАПУСК МОДЕЛИ JABBA --------------------\n\n\n# Создание входных данных для модели\n\njbinput &lt;- build_jabba(\ncatch = catch_data,# Данные об уловах\ncpue = cpue_data,# Данные индексов обилия\nse = se_data,# Стандартные ошибки\nassessment = assessment, # Название оценки\nscenario = \"SPiCT_adapted\", # Сценарий модели\nmodel.type = \"Schaefer\", # Тип модели (Шефера)\nsigma.est = TRUE, # Оценивать изменчивость процесса?\nr.prior = c(0.2, 0.5),# Априорное распределение для r (среднее, SD)\nK.prior = c(189.6, 0.795),# Априорное для K (среднее, SD)\npsi.prior = c(0.75, 0.25),# Априорное для начального заполнения\nigamma = c(0.001, 0.001), # Параметры для дисперсии наблюдений\nverbose = FALSE # Отключить подробный вывод\n)\n\n# Запуск Байесовской модели (MCMC)\n\nfit &lt;- fit_jabba(\njbinput,# Входные данные\nni = 50000, # Общее количество итераций\nnb = 10000, # Количество \"выжигаемых\" итераций (burn-in)\nnt = 5,# Частота прореживания (thinning)\nnc = 2 # Количество цепей MCMC\n)",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Продукционная модель JABBA</span>"
    ]
  },
  {
    "objectID": "chapter 6.html#анализ-параметров-модели-jabba-fitpars",
    "href": "chapter 6.html#анализ-параметров-модели-jabba-fitpars",
    "title": "7  Продукционная модель JABBA",
    "section": "7.4 Анализ параметров модели JABBA (fit$pars)",
    "text": "7.4 Анализ параметров модели JABBA (fit$pars)\nКоманда fit$pars выведет таблицу, содержит медианные значения, 95% доверительные интервалы и результаты тестов сходимости MCMC для ключевых характеристик модели.\n\n&gt; fit$pars\n\n        Median        LCI           UCI          Geweke.p Heidel.p\nK      257.137636616 178.4613660245 442.25933810 0.533    0.401\nr      0.268924223   0.1517493450   0.42756749   0.324    0.864\nq.1    0.102043488   0.0565010978   0.15490243   0.920    0.967\nq.2    0.078076035   0.0433099875   0.11858679   0.986    0.954\npsi    0.875023951   0.5909908905   1.23643434   0.970    0.470\nsigma2 0.003477230   0.0005645686   0.02110338   0.369    0.563\ntau2.1 0.006817871   0.0006978604   0.05031429   0.845    0.392\ntau2.2 0.002775946   0.0004835058   0.01978467   0.522    0.445\nm      2.000000000   2.0000000000   2.00000000   NaN      NA\n&gt;\n\nБиологические параметры:\n\nK(емкость среды): Медиана 257.14 единиц биомассы, например тыс.тонн (95% ДИ: 178.46–442.26). Широкий доверительный интервал отражает типичную неопределенность при отсутствии данных о периоде, когда запас приближался к нетронутому состоянию.\nr(темп роста): Медиана 0.269 год⁻¹ (95% ДИ: 0.152–0.428) соответствует биологическим ожиданиям для многих промысловых видов рыб.\nψ(начальная биомасса): Медиана 0.875 (95% ДИ: 0.591–1.236) указывает, что в 2005 году биомасса составляла ~87.5% от K.\n\nПараметры наблюдений:\n\nq.1(коэффициент уловистости (улавливаемости) CPUE): Медиана 0.102 (95% ДИ: 0.056–0.155)\nq.2(коэффициент уловистости (улавливаемости) BESS): Медиана 0.078 (95% ДИ: 0.043–0.119) Широкие доверительные интервалы (&gt;50% от медианы) подтверждают недостаточную информативность данных для точной оценки этих параметров.\n\nОценки ошибок:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nПараметр\n\nМедиана\n\n95% ДИ\n\nНазначение\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nsigma2\n\n0.0035\n\n[0.0006, 0.021]\n\nДисперсия ошибки процесса\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ntau2.1\n\n0.0068\n\n[0.0007, 0.050]\n\nДисперсия ошибки CPUE\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ntau2.2\n\n0.0028\n\n[0.0005, 0.020]\n\nДисперсия ошибки BESS\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nСоотношение σ²/τ² показывает:\n\nДля CPUE: 0.0035/0.0068 ≈ 0.51\n\nДля BESS: 0.0035/0.0028 ≈ 1.25\n\n\n\n\n\n\nЭто свидетельствует, что неопределенность в большей степени обусловлена погрешностью данных, чем стохастичностью биологической динамики.\nДиагностика сходимости MCMC: Все p-значения тестов (Geweke, Heidel) превышают 0.05, что подтверждает сходимость цепей:\nУправленческие выводы:\n1.Из-за неопределенности в оценках K и q интерпретацию следует фокусировать на относительных показателях (B/Bmsy, F/Fmsy).\n2.Для повышения точности модели требуется:\n\nДополнительные данные за периоды высокой биомассы (для уточнения K)\nКалибровка индексов обилия (для снижения τ²)\n\n3.Высокие значения τ² указывают на необходимость улучшения качества данных CPUE и BESS.\nДиагностика и визуализация результатов\nПосле выполнения байесовской оценки в JABBA проводится комплексная диагностика и визуализация результатов. Автоматически генерируется набор стандартных графиков через функцию jabba_plots, которые сохраняются в рабочую директорию. Для углубленного анализа последовательно строятся специализированные графики: динамика уловов с модельными значениями, согласованность наблюдаемых и предсказанных индексов CPUE/BESS, сравнение априорных и апостериорных распределений ключевых параметров (r, K, q), а также диагностика остатков модели. Особое внимание уделяется сходимости MCMC-цепей для исключения вычислительных ошибок.\nВажнейшая часть анализа - визуализация временных трендов: абсолютной биомассы (B), промысловой смертности (F) и их соотношений с целевыми уровнями (B/Bmsy, F/Fmsy). Фазовый портрет и Кобэ-график интегрируют эти показатели, наглядно отображая историческую и текущую позицию запаса относительно ориентиров управления (перелов/недолов). Дополнительно выполняются тест на случайность остатков, логарифмические аппроксимации и анализ отклонений процесса, что обеспечивает всестороннюю проверку адекватности модели. Финал этапа - экспорт рассчитанных временных рядов (биомасса, F, B/Bmsy и др.) в CSV-файл для дальнейшего использования.\n\n# ------------------- 4. ДИАГНОСТИКА И ВИЗУАЛИЗАЦИЯ РЕЗУЛЬТАТОВ --------------------\n\n# Генерация стандартных диагностических графиков\n\njbplot_ensemble(fit)\njabba_plots(fit, output.dir = output.dir)\n\n# Индивидуальные графики для детального анализа:\n\njbplot_catch(fit)# График уловов\njbplot_cpuefits(fit)# Сравнение модельных и наблюдаемых индексов\njbplot_ppdist(fit)# Распределения априорных и апостериорных параметров\njbplot_residuals(fit)# Остатки модели\njbplot_mcmc(fit)# Диагностика сходимости MCMC\njbplot_trj(fit, type = \"B\")# Динамика биомассы\njbplot_trj(fit, type = \"F\")# Динамика промысловой смертности\njbplot_trj(fit, type = \"BBmsy\")# Отношение *B/B~msy~*\njbplot_trj(fit, type = \"FFmsy\")# Отношение *F/F~msy~*\njbplot_spphase(fit)# **График продуктивности запаса с разметкой фаз Kobe**\njbplot_kobe(fit)# Кобэ-график (*B/B~msy~* vs *F/F~msy~*)\n\n# Дополнительные диагностики:\n\njbplot_runstest(fit)# Тест на случайность остатков\njbplot_logfits(fit)# Графики в логарифмической шкале\n\njbplot_procdev(fit)# Отклонения процесса\n\n# Сохранение временных рядов результатов\n\nwrite.csv(fit$timeseries, file = \"results.csv\", row.names = FALSE)\n\n\n\n\nРис. 1.: Генерация стандартных графиков: относительной и абсолютной промысловой биомассы, а также смертности, ошибки процесса и динамики вылова.\n\n\n\n\n\nРис. 2.: Сравнение модельных и наблюдаемых индексов\n\n\nГрафик сравнения позволяет визуально оценить адекватность модели реальным данным и выявить систематические расхождения. Он отображает: 1.Наблюдаемые значенияиндексов (например, CPUE и BESS) в виде точек с вертикальными отрезками, отражающими доверительные интервалы на основе стандартных ошибок. 2.Модельные предсказания в виде сплошной линии с затененной областью (50 и 95% доверительные интервалы апостериорного распределения).\nКлючевые аспекты интерпретации:\nСогласованность: Если модельная кривая проходит в пределах доверительных интервалов наблюдаемых точек, это свидетельствует о хорошем описании трендов. Смещения: Систематическое занижение/завышение предсказаний для определенных периодов указывает на недостатки модели (например, недоучет факторов среды или нелегального вылова). Чувствительность индексов: Различия в точности аппроксимации CPUE и BESS помогают оценить, какой индекс информативнее отражает динамику биомассы. Аномалии: Резкие выбросы точек за пределы доверительной зоны модели сигнализируют о годах с нетипичными условиями (ошибки данных, природные катаклизмы). Практическое значение: График отвечает на вопрос — способна ли выбранная продукционная модель (в данном случае Шефера) достоверно воспроизводить историческую динамику запаса, что является основой для корректных прогнозов.\n\n\n\nРис. 3.: Распределения априорных и апостериорных параметров\n\n\nЭтот график предоставляет инструмент для анализа влияния данных на исходные предположения модели. Он визуализирует:\n1.Априорные распределения(темные области): - Заданные до анализа (например:r ~ N(0.2, 0.5),K ~ LN(189.6, 0.795)). - Отражают экспертные гипотезы или литературные данные о параметрах.\n2.Апостериорные распределения(светлые области): - Рассчитанные в ходе Байесовского вывода (MCMC) после учета данных (уловы, индексы). - Показывают,как фактическая информация модифицировала первоначальные предположения.\nАспекты интерпретации:\nСдвиг пиков: Если апостериор смещен относительно априора (напр., пик для r сдвинулся от 0.2 к 0.3) – данные “перевесили” априорную гипотезу. Сужение кривой: Резкое сокращение дисперсии апостериора (напр., для K) свидетельствует о высокой информативности данных по этому параметру. Конфликт: Если апостериорный пик находится в “хвосте” априора (напр., априор для q задан N(1,0.2), а апостериор с пиком при 2.5) – сигнал о несоответствии данных или модели.\nПараметры-индикаторы:\n\nr (темп роста): Четкий апостериор указывает на надежную оценку продуктивности запаса.\nK (емкость среды): Узкий апостериор – уверенность в оценке исторической биомассы.\nψ (начальная заполненность): Расхождение с априором может указывать на ошибку в задании начальных условий.\n\nДиагностическое значение:\nЕсли апостериоры близки к априорам – данные не внесли новую информацию (требует пересмотра индексов). Если апостериоры асимметричны/многомодальны – возможны проблемы идентификации параметров (необходимы дополнительные диагностики).\nВывод: График отвечает на вопрос – насколько исходные биологические гипотезы подтвердились реальными данными, что критично для обоснованности оценки.\nКасательно графиков коэффициентов пропорциональности или улавливаемости q. Здесь, для простоты примера, вручную не задаются. JABBA по умолчанию (автоматически) назначает слабый или малоинформативный априор: q ~ LogNormal(mean = 1, SD = 1000) Это практически равномерное распределение в широком диапазоне (от ~0 до +∞). Поэтому на графиках не видны темные области априорных распределений q1 и q2. Физический смысл: Мы не знаем, во сколько раз индекс отличается от абсолютной биомассы.\nPPMR и PPVR: диагностические показатели в JABBA\nВ байесовском анализе, который лежит в основе работы JABBA, ключевым этапом является проверка сходимости MCMC-цепей. Именно для этой цели используются диагностические показатели PPMR (Potential Scale Reduction Factor for Multivariate Monitoring) и PPVR (Potential Scale Reduction Factor for Predictive Variance). Эти статистики позволяют оценить, насколько надежны полученные оценки параметров модели. PPMR представляет собой многомерный аналог классического R-hat критерия и оценивает сходимость сразу для всех параметров модели, учитывая их взаимосвязи. Он рассчитывается как корень из отношения дисперсии между цепями к дисперсии внутри цепей. Идеальное значение PPMR должно быть близко к 1, а значения выше 1.1 указывают на серьезные проблемы со сходимостью. PPVR же фокусируется конкретно на сходимости дисперсии апостериорных предсказаний, что особенно важно для оценки надежности доверительных интервалов прогнозируемых величин, таких как B/Bmsy или F/Fmsy. Значения PPVR также должны стремиться к 1.\nВ вашем конкретном случае анализ этих показателей дает неоднозначную картину. Для параметра K (несущая способность) мы видим практически идеальную сходимость: PPMR равен 0.97, что даже немного меньше 1, что указывает на превосходную стабильность оценок между цепями, а крайне низкое значение PPVR (0.109) говорит о высокой согласованности в оценке неопределенности. Это позволяет с уверенностью доверять полученным значениям K. Однако ситуация с параметром r (темп роста популяции) вызывает серьезные опасения. Значение PPMR 1.471 существенно превышает критический порог, что свидетельствует о явных проблемах со сходимостью цепей. Хотя PPVR 0.322 выглядит лучше, это не компенсирует высокий PPMR. Такая ситуация часто возникает при слишком широких априорных распределениях или недостатке информативных данных, особенно в периоды роста популяции. Для параметра ψ (начальная заполненность запаса) ситуация промежуточная: PPMR 1.174 находится на границе допустимого, а PPVR 0.501 указывает на умеренную согласованность в оценке неопределенности.\nДля улучшения сходимости рекомендуется предпринять несколько шагов. Во-первых, стоит значительно увеличить количество итераций MCMC - например, до 100000 для ni и 20000 для фазы “burn-in” (nb). Во-вторых, необходимо пересмотреть априорные распределения, особенно для параметра r: возможно, стоит уменьшить стандартное отклонение с 0.5 до 0.2-0.3, если есть экспертные основания для такого ужесточения. В-третьих, стоит проверить качество входных данных - достаточно ли репрезентативны имеющиеся индексы обилия, особенно в ключевые периоды динамики популяции. Важно понимать, что при сохраняющихся проблемах со сходимостью абсолютные оценки биомассы и темпа роста могут оставаться ненадежными, однако относительные показатели, такие как B/Bmsy, часто оказываются более устойчивыми к подобным проблемам. Это связано с тем, что они в меньшей степени зависят от абсолютных значений проблемных параметров. Таким образом, несмотря на выявленные сложности, модель может оставаться полезной для принятия управленческих решений, особенно если фокусироваться на относительных показателях состояния запаса.\n\n\n\nРис. 4.: Остатки модели\n\n\nГрафик остатков в JABBA (jbplot_residuals) представляет собой важный диагностический инструмент, позволяющий оценить качество соответствия модели реальным данным. На этом графике отображаются остатки - разницы между наблюдаемыми значениями индексов обилия (CPUE и BESS) и их модельными оценками. В вашем случае график строится на основе конкретных значений остатков, где для CPUE они варьируются от -0.38 до +0.31, а для BESS - от -0.20 до +0.17, с отсутствующим значением (NA) для BESS в 2005 году.\nГрафик имеет несколько ключевых элементов. Во-первых, это боксплоты, которые визуализируют распределение остатков для каждого индекса в целом, показывая медиану, квартили и возможные выбросы. Во-вторых, на график накладывается сглаженная линия (loess), которая помогает выявить систематические тренды в остатках. Например, если остатки демонстрируют явную тенденцию к увеличению или уменьшению со временем, это может указывать на неучтенные факторы в модели. В ваших данных остатки CPUE показывают некоторую изменчивость, но без явного тренда, в то время как BESS имеет более стабильные остатки с меньшим разбросом.\nИнтерпретация остатков имеет решающее значение. В идеале остатки должны быть случайно распределены вокруг нуля без видимых закономерностей. Наличие кластеров положительных или отрицательных остатков в определенные периоды может указывать на систематические ошибки модели. В нашем случае отсутствие явных трендов на графике - хороший знак, хотя отдельные выбросы, такие как отрицательный остаток CPUE в 2013 году (-0.38), заслуживают внимания. Размеры остатков также важны: значения, превышающие по модулю 0.5, считаются значительными и могут указывать на проблемы с данными или спецификацией модели.\nГрафик остатков особенно полезен для сравнения разных индексов. В нашем анализе видно, что остатки CPUE имеют больший разброс по сравнению с BESS, что может говорить либо о более высокой вариабельности данных CPUE, либо о том, что модель хуже описывает эту компоненту. Отсутствие данных BESS для 2005 года (NA) корректно обрабатывается графиком. Важно отметить, что систематические смещения остатков вверх или вниз могут указывать на проблемы с калибровкой коэффициентов уловистости (q), что согласуется с ранее выявленными сложностями в их оценке.\n\n\n\nРис. 5.: График продуктивности запаса с разметкой фаз Кобэ с динамикой вылова\n\n\nГрафик представляет собой комплексную визуализацию, объединяющую три ключевых аспекта анализа продукционной модели: 1) продукционную функцию (дуга), 2) динамику вылова относительно биомассы и 3) фазовые переходы состояния запаса в координатах Кобэ-графика\nНа графике по оси X отображается биомасса (в абсолютных единицах или относительно Bmsy), а по оси Y — вылов и чистая продукция (surplus production). Кривая производственной функции (обычно параболическая для модели Шефера) показывает зависимость между биомассой и устойчивым выловом. Точки на графике представляют фактические годовые значения биомассы и вылова, соединенные линиями в хронологическом порядке. Цвет точек кодирует фазовое состояние запаса согласно классификации Kobe: зеленый — устойчивое состояние (B/Bmsy, F/Fmsy), желтый/оранжевый — перелов (B/Bmsy, F/Fmsy или B/Bmsy, F/Fmsy), красный — коллапс (B/Bmsy, F/Fmsy).\n\n\n\nРис. 6.: Кобэ-график (B/Bmsy vs F/Fmsy) с динамикой вылова\n\n\nГрафик Кобэ, генерируемый функцией jbplot_kobe(fit), представляет собой фазовый портрет, где по оси X отложено отношение биомассы к целевому уровню (B/Bmsy), а по оси Y — отношение промысловой смертности к устойчивому уровню (F/Fmsy). Этот график разделен на четыре квадранта, определяющих статус запаса. Зеленый квадрант (B/Bmsy &gt; 1, F/Fmsy &lt; 1) соответствует устойчивому состоянию без перелова. Желтый квадрант (B/Bmsy &gt; 1, F/Fmsy &gt; 1) сигнализирует о риске перелова. Оранжевый квадрант (B/Bmsy &lt; 1, F/Fmsy &gt; 1) указывает на активный перелов, а желтый (B/Bmsy &lt; 1, F/Fmsy &lt; 1) — на фазу восстановления запаса.\nВ нашем анализе целевые ориентиры рассчитаны на основе параметров модели: Bmsy = K/2 = 257.14/2 ≈ 128.57, а MSY = r×K/4 ≈ 0.269×257.14/4 ≈ 17.29. На графике отображена траектория запаса с 2005 по 2024 годы, где каждая точка соответствует медианным оценкам за год, а соединяющие их линии показывают хронологическую динамику. В 2005 году запас находился в идеальном состоянии: B/Bmsy = 1.83 (95% ДИ: 1.25–2.52), F/Fmsy = 0.15 (0.09–0.26), что помещает его глубоко в зеленый квадрант.\nПериод 2010-2015 годов демонстрирует критическое ухудшение состояния: к 2013 году B/Bmsy снижается до 0.89 (0.64–1.15), а F/Fmsy достигает пика 1.74 (1.16–2.86) в 2011 году, что соответствует оранжевому квадранту активного перелова. Это совпадает с историческими данными о максимальных уловах (28-35 единиц в 2009-2013 гг.), превышающих расчетный MSY (17.29). Последующий период (2016-2024) показывает восстановление: к 2024 году B/Bmsy возрастает до 1.29 (0.90–1.64), а F/Fmsy снижается до 0.51 (0.31–0.93), возвращая запас в зеленый квадрант.\nТекущее положение (2024 год) указывает на восстановление запаса, однако горизонтально вытянутое облако неопределенности для B/Bmsy отражает чувствительность к оценке параметра K, чей широкий доверительный интервал (178–442) обусловлен исторической нехваткой данных о периоде высокой биомассы. Вертикальная компактность F/Fmsy подтверждает относительно точную оценку промысловой смертности. Управленческая рекомендация основывается на медианных значениях: поддержание F/Fmsy на уровне ≈0.5 позволит сохранить запас в устойчивом состоянии. Однако из-за неопределенности в оценке B/Bmsy (риск попадания в желтый квадрант при нижней границе ДИ 0.90) необходим ежегодный мониторинг с обновлением модели по новым данным. Исторический пример перелова 2011-2013 годов демонстрирует последствия превышения F/Fmsy &gt;1.5, что должно учитываться при установке лимитов вылова.\n\n7.4.1 Дополнительные диагностики\n\n# Дополнительные диагностики:\njbplot_runstest(fit)    # Тест на случайность остатков\njbplot_logfits(fit)     # Графики в логарифмической шкале\njbplot_procdev(fit)     # Отклонения процесса\n\n# Сохранение временных рядов результатов\nwrite.csv(fit$timeseries, file = \"results.csv\", row.names = FALSE)\n\n\n\n\nРис. 7.: График теста серий (runs test) для диагностики остатков\n\n\nДублирование графика остатков, но для каждого индекса выводится отдельный график. На графике отображаются остатки модели (разницы между наблюдаемыми и предсказанными значениями индексов обилия) в виде последовательности точек, упорядоченных по времени.Тест серий (runs test) анализирует последовательность чередований положительных и отрицательных остатков. Случайное распределение остатков (что является желаемым результатом) будет проявляться в частом чередовании положительных и отрицательных значений. Напротив, наличие длинных серий (несколько положительных или отрицательных остатков подряд) может указывать на:\n\nНеучтенные временные зависимости в данных\nНеадекватность структуры модели (например, пропущенные важные переменные)\nСистематические ошибки в данных\nНеправильную спецификацию функциональной формы модели\n\nГрафик отклонений процесса (Process Deviations) в JABBA\n\n\n\nРис. 8.: Отклонения процесса\n\n\nГрафик отклонений процесса (jbplot_procdev(fit)) отображает различия между фактической динамикой биомассы и теоретическими предсказаниями продукционной модели. Эти отклонения (Bdev) количественно выражают влияние неучтенных моделью факторов на популяцию — от климатических аномалий до изменений в кормовой базе. В нашем анализе медианные значения Bdev колеблются в узком диапазоне от -0.024 (2011) до +0.021 (2017), при этом все 95% доверительные интервалы включают ноль. Это свидетельствует об отсутствии статистически значимых отклонений, что подтверждает адекватность базовой модели Шефера. Биологически положительные Bdev указывают на неожиданный рост биомассы (например, за счет улучшения условий воспроизводства), тогда как отрицательные — на незапланированные потери (эпизоотии, незарегистрированную смертность).\nОсобый интерес представляют два периода: 2011 год с минимальным Bdev (-0.024) совпадает с пиком промысловой нагрузки (F/Fmsy ≈ 1.74), что может отражать дополнительную естественную смертность, вызванную переловом. В 2017 году положительное отклонение (+0.021) соответствует фазе активного восстановления запаса. Важно, что 80% лет показывают абсолютные значения Bdev &lt; 0.01 — исключительно высокий показатель, подчеркивающий надежность модели. Приемлемым диапазоном считаются отклонения в пределах ±0.05 при сохранении доверительных интервалов, пересекающих ноль; наши данные существенно строже этих критериев.\nСущественное влияние на отклонения процесса оказывает неучтенный вылов. Если такой вылов присутствует, модель, не получая данных о реальном изъятии, будет систематически переоценивать биомассу. Это проявляется как стабильно отрицательные Bdev, особенно выраженные в периоды интенсивного промысла. Например, при ежегодном неучтенном изъятии в 20% от официального улова, медианные отклонения сместились бы в зону -0.05…-0.10, а доверительные интервалы перестали бы включать ноль. В нашем случае отсутствие таких систематических сдвигов (разброс Bdev симметричен относительно нуля) позволяет заключить, что неучтенный вылов не является критическим фактором для данной популяции. Однако для окончательных выводов требуется анализ ретроспективных данных по промысловому усилию и независимая верификация учетных методик.\nПомимо визуализации, используя нижеприведенный скрипт, можно получить фактические значения, например, с 90%-ным доверительным интервалом: years &lt;- fit$yr\n\n# Агрегировать Bdev по годам (медиана и 90% интервал)\n\nproc_dev \\&lt;- aggregate(Bdev \\~ year, data = fit\\$kbtrj, FUN = function(x) c(median = median(x), lci = quantile(x, 0.05), uci = quantile(x, 0.95)))\n\nprint(proc_dev)",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Продукционная модель JABBA</span>"
    ]
  },
  {
    "objectID": "chapter 6.html#ретроспективный-анализ",
    "href": "chapter 6.html#ретроспективный-анализ",
    "title": "7  Продукционная модель JABBA",
    "section": "7.5 Ретроспективный анализ",
    "text": "7.5 Ретроспективный анализ\nМы переходим к ретроспективному анализу (hindcasting), который является важным инструментом для оценки устойчивости модели и ее чувствительности к новым данным. В ретроспективном анализе модель последовательно переоценивается с исключением последних лет данных (по одному году за раз, в данном случае от 1 до 5 лет). Это позволяет проверить, насколько сильно меняются оценки ключевых параметров и статуса запаса при поступлении новых данных.\nВ вашем скрипте ретроспективный анализ запускается функцией `hindcast_jabba()`, которая использует исходные настройки модели (`jbinput`) и результаты базовой оценки (`fit`). Аргумент `peels = 1:5` указывает, что нужно последовательно удалять от 1 до 5 последних лет данных. Результаты сохраняются в объект `hc`.\nЗатем с помощью функции `jbplot_retro()` визуализируются результаты ретроспективного анализа. График показывает, как меняется оценка биомассы (или B/Bmsy) при исключении данных за последние годы. На графике будет изображена траектория базовой оценки (со всеми данными) и траектории, полученные при удалении 1, 2, 3, 4 и 5 лет. Также рассчитывается и отображается статистика Мона (Mohn’s rho), которая количественно оценивает смещение ретроспективных оценок относительно базовой.\n\n# ------------------- 5. РЕТРОСПЕКТИВНЫЙ АНАЛИЗ --------------------\n\n# Создание папки для результатов ретроспективы\nretro.dir &lt;- file.path(output.dir, \"retro\")\ndir.create(retro.dir, showWarnings = FALSE)\n\n# Запуск ретроспективного анализа (убираем по 1-5 лет)\nhc &lt;- hindcast_jabba(jbinput = jbinput, fit = fit, peels = 1:5)\n\n# Визуализация ретроспективного анализа\nmohnsrho &lt;- jbplot_retro(\n  hc, \n  as.png = FALSE,         # Чтобы сохранить как PNG-файл установите TRUE\n  output.dir = retro.dir,\n  xlim = c(2007, 2022)   # Ограничения по годам на графике\n)\n\n# Кросс-валидация\nmase &lt;- jbplot_hcxval(hc, as.png = FALSE, output.dir = retro.dir)\n\nСтатистика Мона (Mohn’s rho):\nКлючевой показатель смещения, рассчитываемый как относительная разница между ретроспективной и базовой оценкой в год исключения:\n\\[\n\\rho = \\frac{X_{\\text{ретро}} - X_{\\text{база}}}{X_{\\text{база}}}\n\\]\n\n&gt; mohnsrho\n                 B           F         Bmsy        Fmsy         procB\n2024   -0.01949857  0.01635894  0.031098563 -0.05870471  0.0019184659\n2023    0.06336652 -0.05341885 -0.009782004  0.03945419 -0.0004440846\n2022   -0.04605748  0.04811313 -0.043482407  0.10142418 -0.0029895725\n2021   -0.04274631  0.03790912  0.014020696 -0.03150997  0.0011936097\n2020   -0.04268405  0.04748624 -0.034149276  0.04684297 -0.0006575862\nrho.mu -0.01752398  0.01928972 -0.008458886  0.01950133 -0.0001958335\n               MSY\n2024    0.02871203\n2023   -0.02266077\n2022   -0.03747819\n2021    0.02474720\n2020    0.00148479\nrho.mu -0.00103899\n&gt; \n\n\n\n\nРис. 9.: Графики ретроспективного анализа\n\n\n\nНаши результаты:\n\nБиомасса (*Bм): ρ=−0.018 (слабое отрицательное смещение)\nСмертность (F): ρ=+0.019 (слабое положительное смещение)\nMSY: ρ=−0.001 (незначимое смещение) Критерий: ∣ρ∣&lt;0.2 приемлемо наши значения ≪0.2.\n\nВизуализация (jbplot_retro) показывает:\n\nКак меняется траектория биомассы при исключении данных\n“Веер” расходящихся линий: чем сильнее расхождение, тем выше нестабильность модели\nВ вашем случае линии остаются близкими — модель устойчива.\n\n\nМетрика MASE (Mean Absolute Scaled Error).\nКросс-валидация с помощью jbplot_hcxval() оценивает предсказательную способность модели. Для каждого “среза” (peel) модель предсказывает индекс обилия для удаленных лет, а затем эти предсказания сравниваются с фактическими наблюдениями. Рассчитывается MASE (Mean Absolute Scaled Error) — средняя абсолютная ошибка прогноза, нормированная на ошибку наивного прогноза (который предполагает, что будущее значение равно последнему наблюдённому).\n\\[\n\\mathrm{MASE} = \\frac{\\text{Средняя ошибка прогноза}}{\\text{Средняя ошибка наивного прогноза}}\n\\]\n\nMASE &lt; 1: Модель лучше наивного метода (предсказывающего “завтра=сегодня”)\nMASE &gt; 1: Модель работает хуже наивного метода\n\n\n\n\nРис. 10.: Метрика MASE\n\n\n\n&gt; mase\n  Index      MASE  MASE.adj     MAE.PR   MAE.base n.eval\n1  CPUE 0.6806899 0.6402326 0.13413055 0.19705090      5\n2  BESS 0.9539647 0.6632760 0.07763672 0.08138322      5\n3 joint 0.7605651 0.7605651 0.10588363 0.13921706     10\n\nНаши результаты показывают, что для CPUE модель предсказывает лучше, чем наивный метод (0.68&lt;1), а для BESS — немного хуже (0.95≈1). Совместный MASE (0.76) указывает на удовлетворительную общую прогнозную способность. Однако для индекса BESS стоит обратить внимание на возможные улучшения.\n\n\n\n\n\n\n\n\nИндекс\nMASE\nИнтерпретация\n\n\n\n\nCPUE\n0.68\nХорошо: Прогноз на 32% точнее наивного\n\n\nBESS\n0.95\nУдовлетворительно: Почти эквивалентен наивному методу\n\n\nСовместно\n0.76\nПриемлемая общая точность\n\n\n\nПочему это важно?\n\nДля управления запасами:\n\n\nСтабильность Mohn’s rho (ρ≈0) означает, что текущие рекомендации по вылову не изменятся радикально при получении новых данных.\nНизкий MASE подтверждает надежность краткосрочных прогнозов.\n\n\nДля диагностики модели:\n\n\nСистематическое смещение ρB&gt;0.3 могло бы указывать на переоценку запаса (риск перелова).\nMASE &gt; 1 для BESS требует улучшения описания этого индекса (например, через калибровку q).\n\n\nИсторический контекст:\nВ наших данных слабое смещение для MSY (ρ=−0.001) подтверждает, что модель корректно определяет максимальный устойчивый вылов (17.29), несмотря на проблемы с оценкой r (PPMR=1.47).\n\nВыводы для нашего случая:\nРетроспективный анализ показал:\n\nВысокую стабильность: Смещения параметров статистически незначимы.\nУдовлетворительную прогнозную силу: Особенно для CPUE (MASE=0.68).\nОбласть улучшения: Индекс BESS требует внимания (MASE=0.95), возможно, за счет включения ковариат или пересмотра ошибок наблюдений.\nНадежность управленческих выводов: Текущие оценки статуса запаса (B/Bmsy = 1.29, F/Fmsy = 0.51) устойчивы к добавлению новых данных.\n\nЭтот этап завершает валидацию модели, подтверждая, что она пригодна для разработки рекомендаций по управлению промыслом.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Продукционная модель JABBA</span>"
    ]
  },
  {
    "objectID": "chapter 6.html#прогнозирование",
    "href": "chapter 6.html#прогнозирование",
    "title": "7  Продукционная модель JABBA",
    "section": "7.6 Прогнозирование",
    "text": "7.6 Прогнозирование\nПрогнозирование в JABBA представляет собой заключительный этап оценки запасов, позволяющий смоделировать будущую динамику популяции при различных сценариях управления промыслом. В нашем случае был выполнен 10-летний стохастический прогноз (2025-2034 гг.), основанный на текущем состоянии запаса, где биомасса в 2024 году оценивается в 148.6 тыс. т при соотношении B/Bmsy = 1.29 и промысловой нагрузке F/Fmsy = 0.51. Были рассмотрены четыре сценария годового изъятия: консервативный (10 тыс. т), умеренные (12 и 14 тыс. т) и интенсивный (16 тыс. т), что соответствует 58-93% от расчетного максимального устойчивого улова (MSY = 17.29).\n\n# ------------------- 6. ПРОГНОЗИРОВАНИЕ --------------------\n\n# Прогноз на основе F (ловушечное усилие)\nfw1 &lt;- fw_jabba(\n  fit,\n  nyears = 10,       # Длина прогноза (лет)\n  imp.yr = 1,        # Год внедрения новых правил\n  imp.values = seq(10, 16, 2), # Варианты управления (уровни улова)\n  quant = \"Catch\",   # Прогнозировать по уловам\n  type = \"abs\",      # Абсолютные значения\n  stochastic = TRUE  # Стохастический прогноз\n)\n\n# Графики ансамбля прогнозов\njbpar(mfrow = c(3, 2)) # Настройка макета графиков (3 строки, 2 столбца)\njbplot_ensemble(fw1)    # Основной график прогнозов\n\n\n\n\nРис. 11.: Прогностические графики\n\n\nКлючевой особенностью прогноза является его стохастическая природа — каждый сценарий учитывает неопределенность параметров модели, включая вариабельность темпа роста популяции (r) и ёмкости среды (K), а также ошибку процесса (σ² = 0.0035). Это позволяет получить не точечные предсказания, а вероятностные распределения будущих состояний. Результаты показывают дифференцированную динамику: при вылове 10-12 тыс. т биомасса демонстрирует устойчивый рост (до 178 и 168 тыс. т к 2034 году), сценарий с 14 тыс. т стабилизирует запас на уровне около 158 тыс. т, тогда как интенсивный вылов (16 тыс. т) приводит к постепенному снижению биомассы до 147 единиц.\nБиологическая интерпретация этих траекторий основывается на соотношении прогнозируемых показателей с целевыми ориентирами. Для сценария C16 к 2034 году ожидается приближение B/Bmsy к 1.14, что хотя и остается выше единицы, но указывает на сокращение “буферного” запаса. Особое внимание следует уделить чувствительности модели к оценке параметра r, чья высокая неопределенность (PPMR = 1.47) может существенно влиять на долгосрочные прогнозы — например, если реальный темп роста окажется ближе к нижней границе доверительного интервала (0.15), сценарий C16 может привести к переходу в зону перелова уже к 2030 году.\nУправленческие рекомендации, вытекающие из анализа, предлагают компромисс между экономической эффективностью и предосторожностью. Оптимальным признается диапазон вылова 12-14 единиц, обеспечивающий 70-80% от потенциального прироста продукции без риска снижения запаса ниже целевого уровня. Сценарий C16 может рассматриваться как временная мера только при наличии подтверждающих данных о высоком продуктивном потенциале популяции, но требует ежегодного мониторинга с коррекцией лимитов. Визуализация результатов через jbplot_ensemble() наглядно демонстрирует “веер” траекторий, где расхождение доверительных интервалов усиливается к концу периода прогноза — это прямое отражение кумулятивного эффекта неопределенности параметров и случайных факторов среды.\nВажным аспектом является интеграция прогноза в адаптивную систему управления: установив начальный лимит на уровне 14 тыс. т, следует планировать повторные оценки по данным ежегодных съемок, что позволит корректировать вылов в зависимости от фактического состояния запаса. Такой подход минимизирует риски, связанные с ограниченной точностью продукционных моделей при работе с данными низкой разрешающей способности. Исторический урок нашего анализа — пример перелова 2011-2013 годов — напоминает, что превышение F/Fmsy &gt; 1.5 способно за несколько лет подорвать даже запас, находившийся в благополучном состоянии.\nПри работе с JABBA есть трудности в получении различных графиков и фактических значений, например прогнозных. Ниже приводятся скрипты получения отдельных прогностических графиков и таблицы прогнозных значений выловов и биомасс.\n\n# График для B/Bmsy с кастомизацией\njbplot_ensemble(\n  fw1,\n  subplots = c(1),        # Только B/Bmsy\n  add = TRUE,             # Добавить к текущему графику\n  xlim = c(2020, 2035),   # Ограничение по годам\n  legend.loc = \"topleft\"  # Позиция легенды\n)\n\n\n\n\nРис. 12.: Отдельный график прогноза\n\n\nИзвлечение прогостических данных:\n\n# Фильтрация данных прогноза (2025-2034) для выбранных сценариев\nforecast_data &lt;- subset(\n  fw1, \n  year %in% 2025:2034 &    # Годы прогноза\n    run %in% c(\"C10\", \"C12\", \"C14\", \"C16\") & # Сценарии управления\n    type == \"prj\"           # Только прогнозные значения\n)\n\n# Расчет медиан биомассы (B) по годам и сценариям\nmedian_B &lt;- aggregate(\n  B ~ year + run,          # Формула: группировка по году и сценарию\n  data = forecast_data, \n  FUN = median             # Функция агрегации\n)\n\n# Расчет медиан улова (Catch) по годам и сценариям\nmedian_Catch &lt;- aggregate(\n  Catch ~ year + run, \n  data = forecast_data, \n  FUN = median\n)\n\n# Преобразование в широкий формат (годы по строкам, сценарии по столбцам)\nb_table &lt;- dcast(median_B, year ~ run, value.var = \"B\")\ncatch_table &lt;- dcast(median_Catch, year ~ run, value.var = \"Catch\")\n\n# Вывод таблиц\nprint(\"Медианная биомасса:\")\nprint(b_table)\n\nprint(\"Медианные уловы:\")\nprint(catch_table)\n\n# Сохранение таблиц\nwrite.csv(b_table, \"biomass_forecast.csv\", row.names = TRUE)\nwrite.csv(catch_table, \"catch_forecast.csv\", row.names = TRUE)",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Продукционная модель JABBA</span>"
    ]
  }
]