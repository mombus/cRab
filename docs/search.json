[
  {
    "objectID": "chapter 1.html",
    "href": "chapter 1.html",
    "title": "2  Анализ и визуализация данных улова",
    "section": "",
    "text": "2.1 Введение (в R)",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Анализ и визуализация данных улова</span>"
    ]
  },
  {
    "objectID": "chapter 1.html#загрузка-данных-и-первичный-осмотр",
    "href": "chapter 1.html#загрузка-данных-и-первичный-осмотр",
    "title": "2  Анализ и визуализация данных улова",
    "section": "2.2 Загрузка данных и первичный осмотр",
    "text": "2.2 Загрузка данных и первичный осмотр\nссылка на файл: shrimp_catch.csv\n\n# Установка рабочей директории\nsetwd(\"C:/TEXTBOOK/\")\n# Загрузка библиотек\nlibrary(tidyverse)\n# Загрузка данных\ndata &lt;- read_csv(\"shrimp_catch.csv\")\n\nКоманда glimpse знакомит со структурой данных:\n\n# Просмотр структуры и первых строк загруженных данных\nglimpse(data)\n\n\nRows: 230\nColumns: 5\n$ id     &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, ~\n$ age    &lt;int&gt; 2, 4, 4, 4, 1, 4, 2, 2, 4, 3, 4, 3, 2, 1, 2, 1, 2, 2, 2, 2, 3, ~\n$ length &lt;dbl&gt; 20.45450, 25.88928, 29.42257, 30.68292, 12.46059, 28.52152, 17.~\n$ weight &lt;dbl&gt; 1.28221748, 1.97476899, 2.65412595, 3.44746476, 0.13404801, 2.3~\n$ sex    &lt;chr&gt; \"M\", \"F\", \"F\", \"F\", \"M\", \"F\", \"M\", \"M\", \"F\", \"F\", \"F\", \"F\", \"M\"~\n&gt; \n\nМожно использовать команду str — показывает внутреннюю структуру объекта , включая количество строк, столбцов, названия переменных, их типы (chr, num, int и др.), а также несколько первых значений.\n\nstr(data)\n\n\n'data.frame':   230 obs. of  5 variables:\n $ id    : int  1 2 3 4 5 6 7 8 9 10 ...\n $ age   : int  2 4 4 4 1 4 2 2 4 3 ...\n $ length: num  20.5 25.9 29.4 30.7 12.5 ...\n $ weight: num  1.282 1.975 2.654 3.447 0.134 ...\n $ sex   : chr  \"M\" \"F\" \"F\" \"F\" ...\n&gt;",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Анализ и визуализация данных улова</span>"
    ]
  },
  {
    "objectID": "chapter 1.html#описательная-статистика-и-визуализация",
    "href": "chapter 1.html#описательная-статистика-и-визуализация",
    "title": "2  Анализ и визуализация данных улова",
    "section": "2.3 Описательная статистика и визуализация",
    "text": "2.3 Описательная статистика и визуализация\nКоманда summary выводит описательную статистику для каждой числовой переменной: минимум, 1-й квартиль, медиана, среднее, 3-й квартиль, максимум; для категориальных переменных — частоты.\n\n# Общая статистика\nsummary(data)\n\n\n       id              age            length          weight       \n Min.   :  1.00   Min.   :1.000   Min.   : 7.65   Min.   :-0.3334  \n 1st Qu.: 58.25   1st Qu.:2.000   1st Qu.:17.62   1st Qu.: 0.6320  \n Median :115.50   Median :3.000   Median :22.49   Median : 1.3660  \n Mean   :115.50   Mean   :2.509   Mean   :21.68   Mean   : 1.4933  \n 3rd Qu.:172.75   3rd Qu.:3.000   3rd Qu.:26.03   3rd Qu.: 2.1148  \n Max.   :230.00   Max.   :4.000   Max.   :36.02   Max.   : 5.1316  \n     sex           \n Length:230        \n Class :character  \n Mode  :character  \n\nПростейшими командами можно вычислить, например, соотоношение полов или корреляцию длина-вес.\n\n# Соотношение полов\nprop.table(table(data$sex)) %&gt;% round(2)\n\n\n   F    M \n0.35 0.65 \n\n\n# Корреляция длина-вес с p-value\ncor_test &lt;- cor.test(data$length, data$weight, \n                     method = \"pearson\", \n                     exact = FALSE,\n                     na.action = na.omit)\n \ncor_coef &lt;- round(cor_test$estimate, 2)\np_value &lt;- scales::pvalue(cor_test$p.value, accuracy = .001)\n \ncat(\"Корреляция Пирсона: r =\", cor_coef, \", p =\", p_value, \"\\n\")\n\n\nКорреляция Пирсона: r = 0.95 , p = &lt;0.001 \n\n\n# Распределение возраста\ntable(data$age)\n\n\n1  2  3  4 \n43 68 77 40 \n\n\n# Средние значения длины и веса по группам\ndata %&gt;%\n   group_by(age) %&gt;%\n   summarise(\n     mean_length = mean(length),\n     sd_length = sd(length),\n     mean_weight = mean(weight),\n     sd_weight = sd(weight))\n\n\n# A tibble: 4 x 5\n    age mean_length sd_length mean_weight sd_weight\n  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;\n1     1        12.7      1.37       0.249     0.234\n2     2        19.2      1.88       0.919     0.341\n3     3        24.8      1.72       1.88      0.424\n4     4        29.1      2.28       2.96      0.804\n&gt; \n\n\n2.3.1 Построение гистограммы для переменной ‘length’ (длина креветок)\nДля первого визуального знакомства команда hist строит гистограмму — простой график, который показывает, как распределены значения числовой переменной. В данном случае отображается распределение длин креветок из набора данных.\n\nhist(data$length, \n     main = \"Гистограмма длины креветок\",          # Заголовок графика\n     xlab = \"Длина (см)\",                          # Подпись оси X\n     ylab = \"Частота\",                             # Подпись оси Y\n     col = \"lightblue\",                            # Цвет столбцов\n     border = \"black\",                             # Цвет границ столбцов\n     breaks = 15)                                   # Количество интервалов\n\n\n\n\nРис. 1.1: Гистограмма длины креветок\n\n\n\n\n2.3.2 Визуализация в ggridges\nДля элегантных и компактных графиков подходит библиотека ggridges. Посторим распределение длины креветки в зависимости от пола и возраста.\n\nlibrary(ggplot2)\nlibrary(ggridges)\n\nggplot(data, aes(x = length, \n                 y = sex, \n                 group = sex, \n                 fill = sex)) +\n  geom_density_ridges(scale = 2, alpha = 0.7) +\n  scale_y_discrete(expand = c(0, 0)) +\n  scale_x_continuous(expand = c(0, 0)) +\n  labs(\n    title = \"Распределение длины карапакса по полу\",\n    x = \"Длина карапакса (мм)\",\n    y = \"Пол\"\n  ) +\n  theme(\n    panel.border = element_blank(),  # Убирает рамку вокруг графика\n    axis.line = element_line(color = \"black\")  # Сохраняет осевые линии (опционально)\n  )\n\n\n\n\nРис. 1.2: Пол-длина креветок с использованием ggridges",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Анализ и визуализация данных улова</span>"
    ]
  },
  {
    "objectID": "chapter 1.html#выявление-аутлайеров-выбросов",
    "href": "chapter 1.html#выявление-аутлайеров-выбросов",
    "title": "2  Анализ и визуализация данных улова",
    "section": "2.4 Выявление аутлайеров (выбросов)",
    "text": "2.4 Выявление аутлайеров (выбросов)\nАутлаеры (выбросы) — наблюдения, значительно отклоняющиеся от общего распределения данных. Их идентификация критически важна, так как они могут искажать результаты анализа. Один из надёжных методов обнаружения выбросов — метод межквартильного размаха (IQR).\n\n2.4.1 Теория метода\n\nРасчёт квартилей:\n\nQ1 (25-й перцентиль): значение, ниже которого находится 25% данных.\nQ3 (75-й перцентиль): значение, ниже которого находится 75% данных.\nIQR = Q3 - Q1: мера разброса средней половины данных.\n\nГраницы аутлаеров:\n\nНижняя граница: Q1−1.5×IQRQ1−1.5×IQR\nВерхняя граница: Q3+1.5×IQRQ3+1.5×IQR\nНаблюдения за этими пределами считаются выбросами.\n\n\n\n\n2.4.2 Преимущества метода\n\nУстойчивость к асимметрии распределения.\nНе требует предположения о нормальности данных.\n\n\n# Метод межквартильного размаха\noutliers &lt;- data %&gt;%\n  mutate(\n    length_z = scale(length),\n    weight_z = scale(weight)\n  ) %&gt;% \n  filter(abs(length_z) &gt; 3 | abs(weight_z) &gt; 3)\n\n# Визуализация\nggplot(data, aes(x = length, y = weight)) +\n  geom_point(aes(color = \"Обычные\"), alpha = 0.5) +\n  geom_point(data = outliers, aes(color = \"Аутлаеры\"), size = 3) +\n  scale_color_manual(values = c(\"Обычные\" = \"grey50\", \"Аутлаеры\" = \"red\")) +\n  labs(title = \"Выявление аномальных наблюдений\", color = \"Тип\")\n\n\n\n\nРис. 1.3: Распределение длины карапакса",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Анализ и визуализация данных улова</span>"
    ]
  },
  {
    "objectID": "chapter 1.html#определение-возрастной-структуры-статистические-методы-анализа-размерных-данных",
    "href": "chapter 1.html#определение-возрастной-структуры-статистические-методы-анализа-размерных-данных",
    "title": "2  Анализ и визуализация данных улова",
    "section": "2.5 Определение возрастной структуры: статистические методы анализа размерных данных",
    "text": "2.5 Определение возрастной структуры: статистические методы анализа размерных данных\nВозрастная структура популяции — часто важна для расчёта промысловой смертности, оценки репродуктивного потенциала и прогнозирования динамики запасов. Поскольку прямое измерение возраста часто невозможно (например, у беспозвоночных или рыб без четких возрастных меток), используются статистические методы, выделяющие группы в смешанных распределениях размеров.\nОсновные подходы:\n\nМетод k-средних (k-means) — алгоритм кластеризации, группирующий особи в заданное число кластеров (возрастных групп) на основе их размеров.\nМетод Бхаттачарии — статистический подход для разделения смешанных нормальных распределений, часто применяемый для идентификации мод в гистограммах.\nEM-алгоритм — оценка параметров смеси распределений, подходящая для данных с перекрывающимися возрастными группами.\nГауссовы смеси (GMM) — расширение метода Бхаттачарии для многомерного анализа.\nЯдерное сглаживание — непараметрический метод визуализации плотности, помогающий выявить скрытые моды.\n\nРассмотрим метод k-средних (k-means) и метод Бхаттачарии, предварительно построив гистограмму.\n\n# Загрузка библиотек\nlibrary(tidyverse)\nlibrary(mixtools)\n# Гистограмма длины с наложением плотности\nggplot(data, aes(x = length)) +\n  geom_histogram(aes(y = after_stat(density)), fill = \"steelblue\", bins = 20, alpha = 0.7) +\n  geom_density(color = \"#FC4E07\", linewidth = 1) +\n  labs(title = \"Распределение длины карапакса\", \n       subtitle = \"Пики могут соответствовать возрастным группам\",\n       x = \"Длина (мм)\")\n\n\n\n\nРис. 1.3: Распределение длины карапакса\n\n\n\n# Кластеризация по длине (K-means как пример)\nset.seed(123)\nclusters &lt;- kmeans(data$length, centers = 4)  # Предполагаем 4 возрастные группы\ndata$cluster &lt;- factor(clusters$cluster)\n\n# Визуализация кластеров\nggplot(data, aes(x = length, fill = cluster)) +\n  geom_histogram(bins = 25, alpha = 0.7) +\n  labs(title = \"Кластеризация по длине)\", \n       x = \"Длина (мм)\")\n\n\n\n\nРис. 1.4: Кластеризация по длине\n\n\n\n# Установка рабочей директории\nsetwd(\"C:/TEXTBOOK/\")\n\n# Загрузка библиотек\nlibrary(tidyverse)\nlibrary(mixtools)\n\n# Загрузка данных\ndata &lt;- read.csv(\"shrimp_catch.csv\")\n\n# 1. Построение и отображение гистограммы\nhist(data$length, breaks = 20, main = \"Гистограмма распределения длин карапаксов\",\n     xlab = \"Длина карапакса (мм)\", ylab = \"Частота\")\n\n# 2. Инициализация параметров (предположим 4 возрастные группы)\ninit_params &lt;- list(\n  lambda = rep(1/4, 4),\n  mu = c(13, 19, 25, 32),\n  sigma = c(1.5, 1.75, 1.75, 2.5)\n)\n\n# 3. Разделение смеси распределений методом EM\nfit &lt;- normalmixEM(data$length, k = 4, maxit = 1000, epsilon = 1e-3,\n                   lambda = init_params$lambda,\n                   mu = init_params$mu,\n                   sigma = init_params$sigma)\n\n# 4. Визуализация результатов с ggplot2\n# Генерация сетки для построения кривых\nx_grid &lt;- seq(min(data$length), max(data$length), length.out = 500)\n\n# Функция смеси\nmixture_density &lt;- function(x) {\n  fit$lambda[1] * dnorm(x, fit$mu[1], fit$sigma[1]) +\n  fit$lambda[2] * dnorm(x, fit$mu[2], fit$sigma[2]) +\n  fit$lambda[3] * dnorm(x, fit$mu[3], fit$sigma[3]) +\n  fit$lambda[4] * dnorm(x, fit$mu[4], fit$sigma[4])\n}\n\n# График\nggplot(data, aes(x = length)) +\n  # Гистограмма\n  geom_histogram(aes(y = after_stat(density)), bins = 20, fill = \"white\", color = \"black\", alpha = 0.7) +\n  # Исходное распределение (гладкая линия)\n  geom_density(color = \"red\", lwd = 1.2) +\n  # Смесь распределений\n  stat_function(fun = mixture_density, color = \"black\", lwd = 1.5) +\n  # Компоненты смеси\n  stat_function(fun = function(x) fit$lambda[1] * dnorm(x, fit$mu[1], fit$sigma[1]), color = \"blue\", lwd = 1) +\n  stat_function(fun = function(x) fit$lambda[2] * dnorm(x, fit$mu[2], fit$sigma[2]), color = \"green\", lwd = 1) +\n  stat_function(fun = function(x) fit$lambda[3] * dnorm(x, fit$mu[3], fit$sigma[3]), color = \"orange\", lwd = 1) +\n  stat_function(fun = function(x) fit$lambda[4] * dnorm(x, fit$mu[4], fit$sigma[4]), color = \"purple\", lwd = 1) +\n  \n  # Настройка темы и легенды\n  theme_minimal() +\n  labs(\n    x = \"Длина карапакса (мм)\",\n    y = \"Плотность\",\n    title = \"Разделение возрастных групп методом EM\"\n  )\n\n\n\n\nРис. 1.5: Метод Бхаттачарии",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Анализ и визуализация данных улова</span>"
    ]
  },
  {
    "objectID": "chapter 1.html#уравнение-берталанфи",
    "href": "chapter 1.html#уравнение-берталанфи",
    "title": "2  Анализ и визуализация данных улова",
    "section": "2.6 Уравнение Берталанфи",
    "text": "2.6 Уравнение Берталанфи\nУравнение Берталанфи — фундаментальная модель в рыбохозяйственной науке, описывающая асимптотический рост организмов. Оно имеет вид: \\[\nL(t) = L_{\\infty} \\cdot \\left(1 - e^{-k \\cdot (t - t_0)}\\right)\n\\] где L∞— теоретическая максимальная длина особи, k— коэффициент скорости роста, t0— гипотетический возраст при нулевой длине.\nВ приведённом коде модель применяется для анализа роста северной креветки :\n\nПодготовка данных: Удаление аутлаеров (например, строк 10 и 50) повышает точность оценки параметров.\nИнициализация параметров:\n\nL∞ задаётся как максимальная наблюдаемая длина в данных.\nk и t0 подбираются итеративно методом нелинейных наименьших квадратов (nls).\n\nВизуализация: График сопоставляет эмпирические данные (точки) с предсказаниями модели (красная линия), демонстрируя, как рост замедляется с приближением к L∞.\n\nИнтерпретация параметров:\n\nВысокое значение k (&gt;0.3) указывает на быстрый рост молоди.\nt0&lt;0 может отражать ранний метаморфоз личинок.\n\n\n# Загрузка библиотек\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(nlme)\n\n# Загрузка данных\ndata &lt;- read.csv(\"shrimp_catch.csv\")\n\n# Преобразование возраста в числовой формат\ndata$age_num &lt;- as.numeric(data$age)\n\n# Удаление аутлайеров (если необходимо)\ndata_clean &lt;- data %&gt;%\n  filter(!id %in% c(10, 50))  # Пример удаления строк с аномалиями\n\n# Начальные параметры на основе данных\nL_inf_start &lt;- max(data_clean$length, na.rm = TRUE)  # Максимальная длина\nk_start &lt;- 0.3                                        # Средняя скорость роста\nt0_start &lt;- -0.5                                      # Гипотетический возраст\n\n# Подгонка модели с увеличенным числом итераций\nmodel &lt;- nls(\n  length ~ L_inf * (1 - exp(-k * (age_num - t0))),\n  data = data_clean,\n  start = list(L_inf = L_inf_start, k = k_start, t0 = t0_start),\n  control = nls.control(maxiter = 200, warnOnly = TRUE)  # Увеличиваем лимит итераций\n)\n\n# Вывод результатов\nsummary(model)\n\n# Создание последовательности возрастов для предсказания\nage_seq &lt;- seq(min(data_clean$age_num), max(data_clean$age_num), by = 0.1)\n\n# Предсказание значений длины\nlength_pred &lt;- predict(model, newdata = data.frame(age_num = age_seq))\n\n# Построение графика\nggplot(data_clean, aes(x = age_num, y = length)) +\n  geom_point(aes(color = age), alpha = 0.7) +\n  geom_line(data = data.frame(age_num = age_seq, length = length_pred), \n            aes(x = age_num, y = length), color = \"red\", linewidth = 1.2) +\n  labs(\n    title = \"Рост креветок по уравнению Берталанфи\",\n    x = \"Возраст (годы)\",\n    y = \"Длина карапакса (мм)\",\n    color = \"Возрастная группа\"\n  ) +\n  theme_minimal()\n\n# Сохранение графика\nggsave(\"bertalanffy_model.png\", width = 8, height = 6)\n\n\n\n\nРис. 1.6: Рост креветок по уравнению Берталанфи",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Анализ и визуализация данных улова</span>"
    ]
  },
  {
    "objectID": "chapter 1.html#огива-логистическая-кривая-и-50-ное-созревание",
    "href": "chapter 1.html#огива-логистическая-кривая-и-50-ное-созревание",
    "title": "2  Анализ и визуализация данных улова",
    "section": "2.7 Огива, логистическая кривая и 50%-ное созревание",
    "text": "2.7 Огива, логистическая кривая и 50%-ное созревание\nЛогистическая кривая — ключевой инструмент для моделирования бинарных процессов, таких как созревание или смена пола у организмов. В случае протоандрических креветок (Pandalus borealis), которые меняют пол с возрастом, зависимость вероятности быть самкой от длины карапакса можно описать логистической функцией:\n\\[\nP(F) = \\frac{1}{1 + e^{-(\\beta_0 + \\beta_1 \\cdot длина)}}\n\\]\nгде P(F) — вероятность принадлежности к женскому полу, β0 — интерсепт, β1 — коэффициент влияния длины.\nТочка перегиба логистической кривой соответствует длине, при которой вероятность быть самкой равна 50%: \\[\nL_{50} = -\\frac{\\beta_0}{\\beta_1}\n\\]\n\n\n\nРис. 1.7: Логистическая кривая\n\n\nОгива (кумулятивная кривая) показывает накопление вероятности с увеличением длины. Для анализа созревания её можно построить через интеграл логистической функции. Визуально она демонстрирует, как доля самок возрастает с размером.\n\n\n\nРис. 1.8: Огива\n\n\n\n2.7.1 Оценка модели\n\nROC-кривая и AUC:\n\nПлощадь под ROC-кривой (AUC) &gt;0.7 указывает на хорошую предсказательную способность модели.\nЗначение AUC = 0.94(пример из кода) подтверждает сильную связь длины и пола.\n\n\n\n\n\nРис. 1.9: ROC-кривая и AUC\n\n\n\nИнтерпретация коэффициентов:\n\nПоложительный β1 означает: с ростом длины вероятность быть самкой увеличивается.\nНапример, β1=0.25 → увеличение длины на 1 мм повышает шансы в e0.25≈1.28 раза.\n\n\n\n\n2.7.2 Биологический контекст\n\nПротоандрический гермафродитизм: У креветок смена пола с самцов на самок происходит при достижении критического размера (~25-28 мм).\nL50 как индикатор: Снижение L50 в популяции может сигнализировать о стрессовых условиях (перелов, изменение среды), ускоряющих созревание.\n\n\n# Установка рабочей директории\nsetwd(\"C:/TEXTBOOK/\")\n\n# Загрузка библиотек\nlibrary(tidyverse)\nlibrary(pROC)\nlibrary(ggplot2)\n\n# Загрузка данных\ndata &lt;- read_csv(\"shrimp_catch.csv\")\n\n# 1. Предобработка данных -----------------------------------------------------\n# Удаление аутлаеров методом IQR\nQ1 &lt;- quantile(data$length, 0.25)\nQ3 &lt;- quantile(data$length, 0.75)\nIQR &lt;- Q3 - Q1\ndata_clean &lt;- data %&gt;%\n  filter(length &gt;= Q1 - 1.5*IQR & length &lt;= Q3 + 1.5*IQR)\n\n# 2. Логистическая регрессия --------------------------------------------------\n# Преобразование пола в бинарную переменную\ndata_clean$sex_binary &lt;- ifelse(data_clean$sex == \"F\", 1, 0)\n\n# Подгонка модели\nmodel_logit &lt;- glm(sex_binary ~ length, \n                   data = data_clean, \n                   family = binomial(link = \"logit\"))\n\n# Расчет коэффициентов\nbeta0 &lt;- coef(model_logit)[1]\nbeta1 &lt;- coef(model_logit)[2]\n\n# Вычисление L50 (длина 50% созревания)\nL50 &lt;- round(-beta0/beta1, 1)\n\n# 3. Визуализация ------------------------------------------------------------\n# Логистическая кривая\nggplot(data_clean, aes(x = length, y = sex_binary)) +\n  geom_point(aes(color = sex), alpha = 0.6, size = 2) +\n  geom_line(aes(y = predict(model_logit, type = \"response\")), \n            color = \"#D81B60\", linewidth = 1.5) +\n  geom_vline(xintercept = L50, linetype = \"dashed\", color = \"#1E88E5\") +\n  annotate(\"text\", x = L50 + 2, y = 0.2, \n           label = paste(\"L50 =\", L50, \"мм\"), color = \"#1E88E5\") +\n  scale_color_manual(values = c(\"#FFC107\", \"#1976D2\")) +\n  labs(\n    title = \"Зависимость пола от длины карапакса\",\n    subtitle = \"Логистическая регрессия с 50%-ной точкой созревания\",\n    x = \"Длина карапакса (мм)\",\n    y = \"Вероятность быть самкой (P(F))\"\n  ) +\n  theme_minimal(base_size = 12)\n\n# Огива (кумулятивное распределение)\ndata_ogive &lt;- data_clean %&gt;%\n  arrange(length) %&gt;%\n  mutate(\n    cum_females = cumsum(sex_binary),\n    cum_prob = cum_females / max(cum_females)\n  )\n\nggplot(data_ogive, aes(x = length, y = cum_prob)) +\n  geom_line(color = \"#4CAF50\", linewidth = 1.5) +\n  geom_vline(xintercept = L50, linetype = \"dashed\", color = \"#1E88E5\") +\n  geom_hline(yintercept = 0.5, linetype = \"dotted\", color = \"#757575\") +\n  annotate(\"text\", x = L50 + 2, y = 0.55, \n           label = paste(\"50% созревание при\", L50, \"мм\"), color = \"#1E88E5\") +\n  scale_y_continuous(labels = scales::percent) +\n  labs(\n    title = \"Огива: Кумулятивное распределение самок\",\n    x = \"Длина карапакса (мм)\",\n    y = \"Накопленная доля самок\"\n  ) +\n  theme_minimal(base_size = 12)\n\n# 4. Оценка модели -----------------------------------------------------------\n# ROC-анализ\nroc_obj &lt;- roc(data_clean$sex_binary, predict(model_logit, type = \"response\"))\nauc_value &lt;- round(auc(roc_obj), 2)\n\n# График ROC-кривой\nplot(roc_obj, col = \"#E53935\", main = paste(\"ROC-кривая (AUC =\", auc_value, \")\"))\n\n# 5. Сохранение результатов --------------------------------------------------\nggsave(\"logistic_curve.png\", width = 8, height = 6, dpi = 300)\nggsave(\"ogive_curve.png\", width = 8, height = 6, dpi = 300)\n\n# Вывод ключевых метрик\ncat(\"Результаты анализа:\\n\")\ncat(\"- Длина 50%-ного созревания (L50):\", L50, \"мм\\n\")\ncat(\"- AUC модели:\", auc_value, \"\\n\")\ncat(\"- Коэффициенты модели:\\n\")\ncat(\"  Intercept (β0):\", round(beta0, 2), \"\\n\")\ncat(\"  Slope (β1):\", round(beta1, 2), \"\\n\")",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Анализ и визуализация данных улова</span>"
    ]
  },
  {
    "objectID": "chapter 1.html#сравнение-групп-параметров-моделей",
    "href": "chapter 1.html#сравнение-групп-параметров-моделей",
    "title": "2  Анализ и визуализация данных улова",
    "section": "2.8 Сравнение групп, параметров, моделей",
    "text": "2.8 Сравнение групп, параметров, моделей\n\n2.8.1 Сравнение групп (на примере самцов и самок)\nРассмотрим методы сравнения количественных характеристик (длина, вес) между самцами и самками северной креветки. Анализ включает проверку нормальности распределения, выбор подходящего статистического теста и визуализацию различий.\n\n2.8.1.1 Подготовка данных\nЗагрузим данные и выделим подвыборки для самцов и самок:\n\n# Установка рабочей директории\nsetwd(\"C:/TEXTBOOK/\")\n\n# Загрузка библиотек  \nlibrary(tidyverse)  \nlibrary(ggplot2)  \nlibrary(rstatix)\nlibrary(ggpubr)\n\n# Загрузка данных  \ndata &lt;- read_csv(\"shrimp_catch.csv\") %&gt;%\n  filter(!id %in% c(10, 50))  # Удаление аномальных наблюдений \n\n# Фильтрация данных по полу  \nmales &lt;- data %&gt;% filter(sex == \"M\")  \nfemales &lt;- data %&gt;% filter(sex == \"F\") \n\n\n\n2.8.1.2 Проверка нормальности распределения\nПеред сравнением групп проверим, соответствуют ли данные нормальному распределению (тест Шапиро-Уилка):\n\n# Проверка нормальности для длины самцов  \nshapiro_test(males$length)  \n# Проверка нормальности для длины самок  \nshapiro_test(females$length) \n\nЕсли p-value &gt; 0.05, распределение считается нормальным. В противном случае используем непараметрические методы.\n\n\n2.8.1.3 Сравнение средних значений\nЕсли данные нормальны: t-тест\n\n# T-тест для сравнения длин самцов и самок  \nt_test_result &lt;- t_test(length ~ sex, data = data)  \nt_test_result \n\nЕсли данные не нормальны: U-тест Манна-Уитни\n\n# U-тест для сравнения длин самцов и самок  \nmannwhitney_result &lt;- wilcox_test(length ~ sex, data = data)  \nmannwhitney_result \n\n\n\n2.8.1.4 Эффект размера (коэффициент Коэна)\nДля оценки практической значимости различий рассчитаем коэффициент Коэна:\n\n# Расчет коэффициента Коэна  \ncohens_d_result &lt;- cohens_d(length ~ sex, data = data)  \ncohens_d_result  \n\n\nd &lt; 0.2 : малый эффект,\nd ≈ 0.5 : средний эффект,\nd &gt; 0.8 : большой эффект.\n\n\n\n2.8.1.5 Визуализация различий\nПостроим boxplot для визуального сравнения длин самцов и самок:\n\nggplot(data, aes(x = sex, y = length, fill = sex)) +  \n  geom_boxplot(color = \"black\", alpha = 0.7) +  \n  stat_compare_means(method = \"t.test\") +  # Добавление p-value  \n  labs(title = \"Сравнение длин самцов и самок\",  \n       x = \"Пол\", y = \"Длина карапакса (мм)\") +  \n  theme_minimal() \n\n\n\n\nРис. 1.10: Boxplot сравнения длин самцов и самок\n\n\n\n\n2.8.1.6 Интерпретация результатов\n\nЕсли p-value &lt; 0.05, различия между группами статистически значимы.\nЭффект размера помогает оценить биологическую важность различий. Например, если самки значительно крупнее самцов (d = 1.2), это может указывать на половой диморфизм, связанный с репродуктивной стратегией.\n2.8.1.7 Пример полного анализа для веса\n\n\n# Полный анализ для веса  \nweight_analysis &lt;- data %&gt;%  \n  group_by(sex) %&gt;%  \n  summarise(  \n    mean_weight = mean(weight),  \n    sd_weight = sd(weight),  \n    n = n()  \n  ) %&gt;%  \n  mutate(  \n    t_test = list(t_test(weight ~ sex, data = data)),  \n    cohens_d = list(cohens_d(weight ~ sex, data = data))  \n  )  \n\n# Вывод результатов  \nprint(weight_analysis) \n\n# Распределение веса по полу\nggplot(data, aes(x = factor(sex), y = weight, fill = factor(sex))) +\n  geom_violin(trim = FALSE, alpha = 0.7) +\n  geom_boxplot(width = 0.2, outlier.shape = NA, fill = \"white\") +\n  labs(title = \"Распределение веса по полу\", x = \"Пол\", y = \"Вес (г)\") +\n  theme_minimal()\n\n\n\n\nРис. 1.12: Violin plot для визуализации распределения веса\n\n\n\n\n2.8.1.8 Выводы\n\nИспользуйте t-тест для нормальных данных и U-тест для ненормальных.\nДополните анализ оценкой эффекта размера для биологической интерпретации.\nВизуализируйте различия с помощью boxplot или violin plot.\n\nРекомендации :\n\nДля многомерных данных (например, одновременное сравнение длины, веса и возраста) применяйте MANOVA.\nЕсли группы неоднородны (например, разный возрастной состав), используйте ковариационный анализ (ANCOVA).\n2.8.2 Что делать, если тест на нормальность не пройден для одной из групп?\nПри сравнении количественных характеристик (например, длины карапакса у самцов и самок) важно учитывать, соответствуют ли данные нормальному распределению. Если тест на нормальность (например, Шапиро-Уилка) показывает значимое отклонение от нормальности для одной из групп, это влияет на выбор статистического теста и интерпретацию результатов.\n2.8.2.1 Пример из нашего анализа\nМы провели сравнение длины карапакса между самцами и самками:\n\nДля самцов: shapiro_test(males$length) → p-value = 0.000574 (нормальность отвергнута).\nДля самок: shapiro_test(females$length) → p-value = 0.891 (нормальность подтверждена).\n\nНесмотря на это, мы применили как t-тест , так и U-тест Манна-Уитни :\n\nt-тест : p-value = 1.46e-40 (значимо).\nU-тест : p-value = 1.97e-27 (значимо).\nКоэффициент Коэна: d = 2.14 (большой эффект).\n\n2.8.2.2 Почему это работает?\n\nt-тест устойчив к умеренным отклонениям от нормальности :\n\nПри больших выборках (n &gt; 30) центральная предельная теорема позволяет использовать t-тест даже при слабо выраженной асимметрии.\nВ вашем случае выборка самцов (n = 149) достаточно велика, чтобы компенсировать отклонение от нормальности.\n\nU-тест Манна-Уитни — непараметрическая альтернатива :\n\nЭтот тест не требует нормальности и сравнивает ранги, а не средние значения.\nОн подтверждает значимость различий, что усиливает доверие к выводу.\n\nЭффект размера (коэффициент Кобена) :\n\nd = 2.14 указывает на большой эффект , что важно для биологической интерпретации, даже если p-values значимы.\n\n\n\n\n\n\n2.8.3 Сравнение параметров (линейные модели для оценки межгрупповых различий)\nДля сравнения параметров двух линейных моделей (например, скорости роста самцов и самок) используем следующий подход.\n\n# Установка рабочей директории\nsetwd(\"C:/TEXTBOOK/\")\n\n# Загрузка библиотек\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(broom)\nlibrary(knitr)\n\n# Загрузка данных\ndata &lt;- read_csv(\"shrimp_catch.csv\") %&gt;%\n  filter(!id %in% c(10, 50))  # Удаление аномальных наблюдений\n\n# Фильтрация данных по полу\ndata_male &lt;- data %&gt;% filter(sex == \"M\")\ndata_female &lt;- data %&gt;% filter(sex == \"F\")\n\n# Построение моделей\nmodel_male &lt;- lm(length ~ age, data = data_male)\nmodel_female &lt;- lm(length ~ age, data = data_female)\n\nggplot(data, aes(age, length, color = sex)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\", formula = y ~ x) +\n  scale_color_manual(values = c(\"#E7B800\", \"#00AFBB\")) +\n  labs(x = \"Возраст\", y = \"Длина (мм)\") +\n  theme_minimal()\n\n\n\n\nРис. 1.15: Визуализация моделей\n\n\nМетод 1: Объединенная модель с взаимодействиями\n\n# Установка рабочей директории\njoint_model &lt;- lm(length ~ age * sex, data = data)\nsummary(joint_model) %&gt;% \n  broom::tidy() %&gt;% \n  filter(term == \"age:sexM\") %&gt;% \n  kable(caption = \"Проверка различия наклонов\", digits = 3)\n\n\nTable: Проверка различия наклонов\n\n|term     | estimate| std.error| statistic| p.value|\n|:--------|--------:|---------:|---------:|-------:|\n|age:sexM |     1.86|     0.459|     4.053|       0|\n&gt; \n\nИнтерпретация:\nЗначимый коэффициент взаимодействия age:sexM (p &lt; 0.05) указывает на статистически значимые различия в скорости роста между полами.\nМетод 2: Тест Вальда\n\nlibrary(car)\ndelta_beta &lt;- coef(model_male)[\"age\"] - coef(model_female)[\"age\"]\nse_diff &lt;- sqrt(vcov(model_male)[\"age\",\"age\"] + vcov(model_female)[\"age\",\"age\"])\nz_score &lt;- delta_beta / se_diff\np_value &lt;- 2 * pnorm(-abs(z_score))\n\ncat(\"Разница коэффициентов:\", round(delta_beta, 3), \n    \"\\nZ-статистика:\", round(z_score, 3),\n    \"\\np-value:\", format.pval(p_value, digits = 2))\n\n\ncomparison_table &lt;- data.frame(\n  Параметр = c(\"Скорость роста самцов\", \"Скорость роста самок\", \"Разница\"),\n  Значение = c(\n    round(coef(model_male)[\"age\"], 2),\n    round(coef(model_female)[\"age\"], 2),\n    round(delta_beta, 2)\n  ),\n  `p-value` = c(\n    format.pval(summary(model_male)$coefficients[\"age\",4], digits = 2),\n    format.pval(summary(model_female)$coefficients[\"age\",4], digits = 2),\n    format.pval(p_value, digits = 2)\n  )\n)\nkable(comparison_table, caption = \"Сравнение коэффициентов роста\")\n\nВывод\n\n: Сравнение коэффициентов роста\n\n|Параметр              | Значение|p.value |\n|:---------------------|--------:|:-------|\n|Скорость роста самцов |     5.95|&lt;2e-16  |\n|Скорость роста самок  |     4.09|5.2e-13 |\n|Разница               |     1.86|0.00024 |\n&gt; \n\nИнтерпретация:\nЗначимая разница (p &lt; 0.05) указывает на статистически значимые различия в скорости роста между полами.\n\n\n2.8.4 Сравнение моделей\nОдним из ключевых аспектов анализа биологических данных является определение формы зависимости между переменными. В данном разделе мы рассмотрим основы подбора модели зависимости между длиной и весом креветок. Начиная с простой линейной модели, мы постепенно перейдем к более сложным нелинейным моделям, чтобы продемонстрировать методику выбора наилучшей модели. Cравним три модели — линейную, полиномиальную и степенную — чтобы определить, какая из них наилучшим образом описывает данные. Цель анализа — найти математическую зависимость, которая:\n\nТочно предсказывает вес креветки по её длине.\nИмеет биологическую интерпретацию.\nМинимизирует ошибку предсказания.\n\n\n2.8.4.1 Модели и их параметры\n\nЛинейная: \\(\\text{weight} = \\beta_0 + \\beta_1\\cdot\\text{length}\\)\nПолиномиальная 3-й степени: \\(\\text{weight} = \\beta_0 + \\beta_1\\cdot\\text{length} + \\beta_2\\cdot\\text{length}^2 + \\beta_3\\cdot\\text{length}^3\\)\nСтепенная: \\(\\text{weight} = a\\cdot\\text{length}^b\\)\n\n\n\n2.8.4.2 Метрики\n\nR² - (коэффициент детерминации): чем ближе к 1, тем лучше модель объясняет данные.\nAIC -(информационный критерий Акаике): чем меньше значение, тем лучше модель с учётом её сложности.\n\n\n\n2.8.4.3 Результаты\n\n2.8.4.3.1 1. Линейная модель\n\nCoefficients:\n             Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -2.115      0.085     -24.86   &lt;2e-16 ***\nlength       0.1665     0.0038    43.71    &lt;2e-16 ***\n\n\nR² = 0.894\nAIC = 148.02\n\n\n\n\nРис. 1.5: Линейная модель\n\n\n\n\n2.8.4.3.2 2. Полиномиальная модель\n\nCoefficients:\n                 Estimate Std. Error t value Pr(&gt;|t|)    \npoly(length,3)1  14.5038    0.2127    68.18   &lt;2e-16 ***\npoly(length,3)2   3.7209    0.2127    17.49   &lt;2e-16 ***\npoly(length,3)3   0.9526    0.2127     4.48  1.2e-05 ***\n\n\nR² = 0.957\nAIC = -52.80\n\n\n\n\nРис. 1.5: Полиномиальная модель\n\n\n\n\n2.8.4.3.3 3. Степенная модель\n\nParameters:\n   Estimate Std. Error t value Pr(&gt;|t|)    \na 0.000157   0.000028    5.60  6.3e-08 ***\nb 2.920160   0.054102   53.98   &lt;2e-16 ***\n\n\nR² = 0.955\nAIC = -48.43 \n\n\n\n\n2.8.4.4 3. Сравнение моделей\n\n\n\nМодель\nR²\nAIC\n\n\n\n\nЛинейная\n0.894\n148.02\n\n\nПолиномиальная\n0.957\n-52.80\n\n\nСтепенная\n0.955\n-48.43\n\n\n\nВыводы:\n\nПолиномиальная модель демонстрирует наилучшие показатели (максимальный R² и минимальный AIC).\nСтепенная модель близка по качеству, но её параметр b≈2.92 близок к биологически ожидаемому значению 3 (вес пропорционален объёму).\nЛинейная модель существенно уступает по точности.\n\n\n\n2.8.4.5 4. Рекомендации\n\nДля прогнозирования используйте полиномиальную модель, так как она минимизирует ошибку.\nДля биологической интерпретации предпочтительна степенная модель: weight∝length2.92.\nИзбегайте переобучения: Полиномиальные модели высокой степени могут терять интерпретируемость.\n\n\n\n2.8.4.6 5. Визуализация остатков\nОстатки степенной модели распределены равномерно, что подтверждает её адекватность: \n\n\n2.8.4.7 Заключение\nДля анализа зависимости веса от длины северной креветки рекомендуется:\n\nПолиномиальная модель — для задач, требующих максимальной точности.\nСтепенная модель — для интерпретации биологических закономерностей.\n\nСкрипт вышеописанных событий:\n\n# Установка рабочей директории\nsetwd(\"C:/TEXTBOOK/\")\n\n# Загрузка библиотек\nlibrary(tidyverse)\nlibrary(ggplot2)\n\n# Загрузка данных\ndata &lt;- read_csv(\"shrimp_catch.csv\") %&gt;%\n  filter(!id %in% c(10, 50))  # Удаление аномальных наблюдений\n\n# Проверка структуры\nglimpse(data)\n\n# Линейная модель: вес ~ длина\nmodel_linear &lt;- lm(weight ~ length, data = data)\nsummary(model_linear)\n\n# Визуализация\nggplot(data, aes(x = length, y = weight)) +\n  geom_point(color = \"steelblue\", alpha = 0.7) +\n  geom_smooth(method = \"lm\", color = \"#FC4E07\") +\n  labs(title = \"Линейная модель\", x = \"Длина (мм)\", y = \"Вес (г)\")\n\n\n# Полиномиальная модель: вес ~ длина + длина? + длина?\nmodel_poly &lt;- lm(weight ~ poly(length, 3), data = data)\nsummary(model_poly)\n\n# Визуализация\nggplot(data, aes(x = length, y = weight)) +\n  geom_point(color = \"steelblue\", alpha = 0.7) +\n  geom_smooth(method = \"lm\", formula = y ~ poly(x, 3), color = \"#E7B800\") +\n  labs(title = \"Полиномиальная модель\", x = \"Длина (мм)\", y = \"Вес (г)\")\n\n\n# Степенная модель: вес ~ длина^k (k подбирается)\nmodel_power &lt;- nls(weight ~ a * length^b, \n                   data = data, \n                   start = list(a = 0.001, b = 3))  # Начальные значения\nsummary(model_power)\n\n# Визуализация\ndata$pred_power &lt;- predict(model_power)\nggplot(data, aes(x = length, y = weight)) +\n  geom_point(color = \"steelblue\", alpha = 0.7) +\n  geom_line(aes(y = pred_power), color = \"#00BA38\", linewidth = 1.2) +\n  labs(title = \"Степенная модель\", x = \"Длина (мм)\", y = \"Вес (г)\")\n\n# Расчет AIC\nAIC(model_linear, model_poly, model_power)\n\n# Расчет R?\nr2_linear &lt;- summary(model_linear)$r.squared\nr2_poly &lt;- summary(model_poly)$r.squared\nr2_power &lt;- 1 - sum(residuals(model_power)^2) / sum((data$weight - mean(data$weight))^2)\n\n# Создание таблицы сравнения моделей\ncomparison_table &lt;- data.frame(\n  Модель = c(\"Линейная\", \"Полиномиальная\", \"Степенная\"),\n  R_square = c(r2_linear, r2_poly, r2_power),\n  AIC = c(AIC(model_linear), AIC(model_poly), AIC(model_power))\n)\n\n# Вывод таблицы\nprint(comparison_table)\n\n# Остатки для степенной модели\ndata$residuals &lt;- residuals(model_power)\n\nggplot(data, aes(x = length, y = residuals)) +\n  geom_point(color = \"#FC4E07\", alpha = 0.7) +\n  geom_hline(yintercept = 0, linetype = \"dashed\") +\n  labs(title = \"Остатки степенной модели\", x = \"Длина (мм)\", y = \"Ошибка\")",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Анализ и визуализация данных улова</span>"
    ]
  }
]