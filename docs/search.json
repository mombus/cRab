[
  {
    "objectID": "chapter 11.html",
    "href": "chapter 11.html",
    "title": "12  Картография: повышение разрешения",
    "section": "",
    "text": "В практике работы с пространственными данными часто встречается ситуация, когда исходная сетка измерений имеет недостаточно высокое разрешение для визуализации или анализа. Например, данные из океанографической базы EN4 могут быть представлены в виде редкой сетки, что приводит к “ступенчатым” или изрезанным картам при построении контуров. Для решения этой задачи применяется ресэмплинг (передискретизация) — процесс изменения пространственного разрешения растра путем интерполяции значений. Это позволяет получить более плавное и непрерывное представление данных, что особенно полезно для картографирования и последующего анализа. Полный скрипт можно скачать по ссылке.\nДля работы скрипта:\n\nСкачайте файл данных (diffTemp.xlsx)\nУстановите рабочую директорию в setwd()\nУстановите необходимые пакеты.`\n\nСкрипт начинается с очистки рабочей среды и загрузки необходимых пакетов. Задаются параметры области исследования: минимальная и максимальная долгота и широта, ограничивающие регион Баренцева моря. Загружаются данные из Excel-файла, содержащего разности температур, и преобразуются в data.frame с колонками долготы, широты и значения температуры. Создается исходный растровый объект из этих данных с указанием системы координат. Определяется целевой растр с более высоким разрешением (0.01 градуса), после чего выполняется ресэмплинг исходного растра с использованием билинейной интерполяции для сглаживания значений. Данные ресэмплинга преобразуются в data.frame с фильтрацией по заданной области и категоризацией температурных значений для построения цветовых градаций. Загружаются географические данные мировых береговых линий и создается координатная сетка. Определяется цветовая палитра для отображения температурных аномалий. Строится финальный график с использованием сглаженных данных: растровая поверхность, контуры температурных изолиний, координатная сетка и подложка мировых границ. График сохраняется в формате TIFF с высоким разрешением.\n\n# ОЧИСТКА РАБОЧЕЙ СРЕДЫ И ЗАГРУЗКА БИБЛИОТЕК --------------------------------\nrm(list = ls())  # Очистка среды от предыдущих объектов\n\n# Загрузка необходимых библиотек:\nlibrary(dplyr)      # Для манипуляций с данными\n\n\nПрисоединяю пакет: 'dplyr'\n\n\nСледующие объекты скрыты от 'package:stats':\n\n    filter, lag\n\n\nСледующие объекты скрыты от 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(sf)         # Для работы с пространственными данными\n\nLinking to GEOS 3.13.1, GDAL 3.10.2, PROJ 9.5.1; sf_use_s2() is TRUE\n\nlibrary(ggplot2)    # Для построения графиков\nlibrary(rnaturalearth)  # Для получения географических данных\nlibrary(terra)      # Для работы с растровыми данными\n\nterra 1.8.42\n\nlibrary(metR)       # Дополнительные функции для визуализации\n\n# УСТАНОВКА РАБОЧЕЙ ДИРЕКТОРИИ -----------------------------------------------\nsetwd(\"C:/SUPERPIC/\")  # Замените на актуальный путь к вашим данным\n\n# ПАРАМЕТРЫ ОБЛАСТИ ИССЛЕДОВАНИЯ ---------------------------------------------\nxmin &lt;- 10      # Минимальная долгота (границы Баренцева моря)\nxmax &lt;- 65      # Максимальная долгота\nymin &lt;- 68      # Минимальная широта\nymax &lt;- 82      # Максимальная широта\n\n# ПАРАМЕТРЫ РЕСЭМПЛИНГА ------------------------------------------------------\nnew_res &lt;- 0.1  # Новое разрешение в градусах после передискретизации\n\n# 1. ЗАГРУЗКА ИСХОДНЫХ ДАННЫХ -------------------------------------------------\n# Чтение данных из Excel-файла\nNEMO &lt;- readxl::read_excel(\"diffTemp.xlsx\", sheet = \"diffTemp\")\n\n# Создание датафрейма с координатами и температурными данными\ndf &lt;- data.frame(\n  longitude = NEMO$Lon,\n  latitude = NEMO$Lat,\n  TEMP = NEMO$dif\n)\n\n# 2. ПОДГОТОВКА ИСХОДНЫХ ДАННЫХ ДЛЯ ВИЗУАЛИЗАЦИИ ------------------------------\n# Фильтрация данных по области исследования и категоризация температур\nDF &lt;- as.data.frame(df, xy = TRUE, na.rm = TRUE) %&gt;% \n  filter(\n    longitude &gt;= xmin, longitude &lt;= xmax,\n    latitude &gt;= ymin, latitude &lt;= ymax\n  ) %&gt;%\n  mutate(\n    TEMP_cat = cut(\n      TEMP,\n      breaks = c(-Inf, 0, 0.25, 0.5, 0.75, 1, Inf),\n      labels = c(\"&lt;0\", \"0~0.25\", \"0.25~0.5\", \"0.5~0.75\", \"0.75~1\", \"&gt;1\"),\n      include.lowest = TRUE\n    )\n  )\n\n# 3. ЗАГРУЗКА ГЕОГРАФИЧЕСКИХ ДАННЫХ -------------------------------------------\n# Получение данных о береговых линиях мира\nworld &lt;- ne_countries(scale = 50, returnclass = \"sf\") %&gt;% \n  st_transform(4326) %&gt;%  # Преобразование в WGS84\n  st_wrap_dateline()      # Коррекция линии перемены дат\n\n# Создание координатной сетки\ngraticule &lt;- st_graticule(\n  lat = seq(ymin, ymax, 2),  # Шаг по широте: 2 градуса\n  lon = seq(xmin, xmax, 5),  # Шаг по долготе: 5 градусов\n  datum = st_crs(4326)       # Система координат\n)\n\n# 4. НАСТРОЙКА ЦВЕТОВОЙ СХЕМЫ -------------------------------------------------\n# Цвета для отрицательных температур (холодные тона)\ncool_colors &lt;- c(\"#2171b5\", \"#6baed6\", \"#9ecae1\")\n# Цвета для положительных температур (теплые тона)\nwarm_colors &lt;- c(\"#fee391\", \"#fe9929\", \"#d95f0e\")\n# Объединенная палитра\npalette &lt;- c(cool_colors, warm_colors)\n\n# 5. ПОСТРОЕНИЕ ГРАФИКА С ИСХОДНЫМ РАЗРЕШЕНИЕМ --------------------------------\n# Создание карты с исходными данными (низкое разрешение)\nplot_lowres &lt;- ggplot() +\n  # Отображение данных в виде растровых плиток\n  geom_tile(data = DF, aes(x = longitude, y = latitude, fill = TEMP_cat), alpha = 0.7) +\n  # Добавление изолиний температур\n  geom_contour(\n    data = DF,\n    aes(x = longitude, y = latitude, z = TEMP),\n    breaks = c(0, 0.25, 0.5, 0.75, 1),\n    color = \"black\",\n    linewidth = 0.2\n  ) +\n  # Добавление координатной сетки\n  geom_sf(data = graticule, color = \"gray70\", linewidth = 0.3) +\n  # Добавление береговых линий\n  geom_sf(\n    data = world, \n    color = \"gray30\",\n    fill = \"#E8E5D6\",\n    lwd = 0.3\n  ) +\n  # Настройка области отображения\n  coord_sf(\n    xlim = c(xmin, xmax),\n    ylim = c(ymin, ymax),\n    expand = FALSE,\n    crs = st_crs(4326)\n  ) +\n  # Настройка цветовой шкалы\n  scale_fill_manual(\n    name = \"T (°C)\",  # Знак дельта вместо \"?\"\n    values = palette,\n    drop = FALSE,\n    na.value = \"grey90\"\n  ) +\n  # Настройка внешнего вида графика\n  theme(\n    panel.background = element_rect(fill = \"white\"),\n    panel.border = element_rect(color = \"black\", fill = NA, linewidth = 1.5),\n    legend.position = \"bottom\",\n    axis.title = element_blank(),\n    text = element_text(size = 12),\n    legend.text = element_text(size = 10)\n  )\n\n# Отображение графика\nplot_lowres\n\n\n\n\n\n\n\n# 6. ПРОЦЕДУРА РЕСЭМПЛИНГА ----------------------------------------------------\n# Создание исходного растра из данных\nr &lt;- rast(df, type = \"xyz\", crs = \"EPSG:4326\")\n\n# Создание целевого растра с новым разрешением\ntarget &lt;- rast(\n  extent = ext(c(xmin, xmax, ymin, ymax)),\n  resolution = new_res,\n  crs = \"EPSG:4326\"\n)\n\n# Выполнение ресэмплинга с билинейной интерполяцией\nr_resampled &lt;- resample(r, target, method = \"bilinear\")\n\n# 7. ПОДГОТОВКА РЕСЭМПЛИРОВАННЫХ ДАННЫХ ---------------------------------------\n# Преобразование растра в датафрейм для ggplot2\nTEMPERATURE &lt;- as.data.frame(r_resampled, xy = TRUE, na.rm = TRUE) %&gt;% \n  filter(\n    x &gt;= xmin, x &lt;= xmax,\n    y &gt;= ymin, y &lt;= ymax\n  ) %&gt;%\n  mutate(\n    TEMP_cat = cut(\n      TEMP,\n      breaks = c(-Inf, 0, 0.25, 0.5, 0.75, 1, Inf),\n      labels = c(\"&lt;0\", \"0~0.25\", \"0.25~0.5\", \"0.5~0.75\", \"0.75~1\", \"&gt;1\"),\n      include.lowest = TRUE\n    )\n  )\n\n# 8. ПОСТРОЕНИЕ ГРАФИКА С ВЫСОКИМ РАЗРЕШЕНИЕМ ---------------------------------\n# Создание карты с ресэмплированными данными\nfinal_plot &lt;- ggplot() +\n  geom_tile(data = TEMPERATURE, aes(x = x, y = y, fill = TEMP_cat), alpha = 0.7) +\n  geom_contour(\n    data = TEMPERATURE,\n    aes(x = x, y = y, z = TEMP),\n    breaks = c(0, 0.25, 0.5, 0.75, 1),\n    color = \"black\",\n    linewidth = 0.2\n  ) +\n  geom_sf(data = graticule, color = \"gray70\", linewidth = 0.3) +\n  geom_sf(\n    data = world, \n    color = \"gray30\",\n    fill = \"#E8E5D6\",\n    lwd = 0.3\n  ) +\n  coord_sf(\n    xlim = c(xmin, xmax),\n    ylim = c(ymin, ymax),\n    expand = FALSE,\n    crs = st_crs(4326)\n  ) +\n  scale_fill_manual(\n    name = \"T (°C)\",  # Знак дельта вместо \"?\"\n    values = palette,\n    drop = FALSE,\n    na.value = \"grey90\"\n  ) +\n  theme(\n    panel.background = element_rect(fill = \"white\"),\n    panel.border = element_rect(color = \"black\", fill = NA, linewidth = 1.5),\n    legend.position = \"bottom\",\n    axis.title = element_blank(),\n    text = element_text(size = 12),\n    legend.text = element_text(size = 10)\n  )\n\n# Отображение финального графика\nfinal_plot\n\n\n\n\n\n\n\n# 9. СОХРАНЕНИЕ РЕЗУЛЬТАТОВ ---------------------------------------------------\n# Сохранение карты с высоким разрешением в файл\nggsave(\n  filename = \"Temperature_Map.tiff\",\n  plot = final_plot,\n  device = \"tiff\",\n  width = 17,\n  height = 15,\n  units = \"cm\",\n  dpi = 600,\n  compression = \"lzw\",\n  bg = \"white\"\n)\n\n# Дополнительно: сохранение карты с исходным разрешением\nggsave(\n  filename = \"Temperature_Map_LowRes.tiff\",\n  plot = plot_lowres,\n  device = \"tiff\",\n  width = 17,\n  height = 15,\n  units = \"cm\",\n  dpi = 600,\n  compression = \"lzw\",\n  bg = \"white\"\n)",
    "crumbs": [
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>Картография: повышение разрешения</span>"
    ]
  }
]