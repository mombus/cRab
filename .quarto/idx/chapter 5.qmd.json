{"title":"Продукционная модель SPiCT","markdown":{"yaml":{"title":"Продукционная модель SPiCT","format":"html"},"headingText":"Введение","containsRefs":false,"markdown":"\n\n\nБиблиотека SPiCT <https://github.com/DTUAqua/spict> - оценка запаса с помощью стохастической версии продукционной модели и байесовского подхода. Доступен краткий обзор пакета [`здесь`](https://github.com/DTUAqua/spict/raw/master/spict/inst/doc/spict_handbook.pdf), который служит для ознакомления с пакетом и его функционалом. В обзоре также содержится описание более продвинутых функций пакета.\n\nДокумент с техническими рекомендациями по использованию SPiCT доступен [здесь](https://github.com/DTUAqua/spict/raw/master/spict/inst/doc/spict_guidelines.pdf) . Это постоянно обновляемый документ.\n\nПакет также содержит достаточно подробную документацию в виде справочных текстов, связанных с каждой функцией (некоторые из них могут быть не полностью актуальны). Доступ к ним можно получить обычным для R способом, набрав, например `?check.inp`, . Для начала (помимо изучения краткого обзора) рекомендуется прочитать `?check.inp`и `?fit.spict`.\n\n## Установка пакетов и Загрузка данных\n\n```{r}\n#| output: false\n#| eval: false\n\n# ------------------------- 1. ПОДГОТОВКА СРЕДЫ ---------------------------\n\n## 1.1 Установка пакетов (выполнить один раз)\n# install.packages(\"tidyverse\")\n#remotes::install_github(\"DTUAqua/spict/spict\") # Установка SPiCT\n#install.packages(\"TMB\", type=\"source\")\n\n## 1.2 Загрузка библиотек\nlibrary(spict)   # Основной пакет для моделирования\nlibrary(tidyverse) # Для обработки данных и визуализации\n\n\n## 1.3 Установка рабочей директории\nsetwd(\"C:/SPICT\") # Укажите вашу рабочую папку\n\n\n# ------------------------- 2. ЗАГРУЗКА ДАННЫХ ---------------------------\n\n## 2.1 Вектор лет наблюдений\nYear <- 2005:2024\n\n## 2.2 Данные по вылову (тыс. тонн)\nCatch <- c(5,  7,  6, 10, 14, 25, 28, 30, 32, 35, 25, 20, 15, 12, 10, 12, 10, 13, 11, 12)\n\n## 2.3 Индекс CPUE (промысловый индекс)\nCPUEIndex <- c(27.427120, 26.775958, 16.811997, 22.979653, 29.048568, 29.996072, 16.476301,\n17.174455, 10.537272, 14.590435,  8.286352, 11.394168, 15.537878, 13.791166,\n11.527548, 15.336093, 12.154069, 15.568450, 16.221933, 13.421132)\n\n## 2.4 Индекс BESS (научная съемка)\nBESSIndex <- c( NA, 16.270375, 20.691355, 15.141784, 18.594620, 15.975548, 13.792012,\n13.328805, 11.659744, 11.753855,  9.309859,  7.104886,  7.963839,  9.161322,\n10.271221,  9.822960, 10.347376, 11.703610, 13.679876, 13.413696)\n```\n\n## Кросс-корреляции с временным лагом между индексами и уловами\n\n```{r}\n#| output: false\n#| eval: false\n# График кросс-корреляции: Catch и BESSindex (только данные без пропусков)\nccf(na.omit(Catch), na.omit(BESSIndex),\n    main = \"Кросс-корреляция: Уловы и BESSindex\",\n    xlab = \"Лаг (годы)\", ylab = \"Корреляция\")\n\n\n# График кросс-корреляции: Catch и CPUEIndex (только данные без пропусков)\nccf(na.omit(Catch), na.omit(CPUEIndex),\n    main = \"Кросс-корреляция: Уловы и CPUEIndex\",\n    xlab = \"Лаг (годы)\", ylab = \"Корреляция\")\n```\n\n![Рис. 1.: График кросс-корреляции: Catch и BESSindex](images/SPICT1.PNG){fig-align=\"center\" width=\"60%\"}\n\n![Рис. 2.: График кросс-корреляции: Catch и CPUEIndex](images/SPICT2.PNG){fig-align=\"center\" width=\"60%\"}\n\n## Подготовка данных для SPiCT\n\n```{r}\n#| output: false\n#| eval: false\n#| # ------------------- 3. ПОДГОТОВКА ДАННЫХ ДЛЯ SPiCT --------------------\n\n## 3.1 Форматирование данных в список SPiCT\ninput_new <- list(\n  timeC = Year,     # Годы вылова\n  obsC = Catch,     # Значения вылова\n  timeI = list(     # Временные точки для индексов:\n    Year + 0.5,     #  CPUE - середина года (июль)\n    Year + 0.75     #  BESS - 3/4 года (октябрь)\n  ),\n  obsI = list(\n    CPUEIndex,      # Значения индекса CPUE\n    BESSIndex       # Значения индекса BESS\n  )\n)\n\n## 3.2 Проверка и подготовка входных данных\ninp <- check.inp(input_new, verbose = TRUE)\n```\n\nФункция check.inp() выполняет подготовку и валидацию входных данных перед моделированием. Основные задачи функции:\n\nПроверяет наличие обязательных элементов: timeC (временные точки вылова), obsC (значения вылова). Проверяет соответствие индексов (timeI и obsI): одинаковое количество элементов в списках, соответствие длин временных рядов. Обработка пропущенных значений. Автоматически обрабатывает NA в начале вектора CPUEIndex (2005-2010). Удаляет или маркирует пропущенные значения в соответствии с настройками пакета и пр.\n\n## Настройка модели\n\n```{r}\n#| output: false\n#| eval: false\n# ------------------- 4. НАСТРОЙКА МОДЕЛИ --------------------\n\n## 4.1 Установка априорных распределений\ninp$priors$logn <- c(log(2), 0.1, 1)   # Прайер для n (модель Шефера)\ninp$ini$logn <- log(2)                  # Начальное значение\ninp$phases$logn <- -1                   # Фиксируем параметр (не оцениваем)\n\ninp$priors$logK <- c(5, 0.7, 1)       # Прайер для емкости среды (K)\ninp$priors$logbkfrac <- c(log(0.75),0.25,1) # Начальный уровень эксплуатации\n\n\n\n## 4.2 Настройка неопределенности данных\n# Повышаем неопределенность для последнего года вылова\ninp$stdevfacC[length(inp$stdevfacC)] <- 2 \n\n# Повышаем неопределенность для последнего значения BESS\ninp$stdevfacI[[2]][length(inp$stdevfacI[[2]])] <- 2 \n\n## 4.3 Настройка временного шага\ninp$dteuler <- 1/16  # Более точная дискретизация (по умолчанию 1)\n\n## 4.4 Включение оценки ковариации\ninp$getJointPrecision <- TRUE # Для оценки случайных эффектов\n```\n\n**Установка априорных распределений**\n\n```         \ninp$priors$logn <- c(log(2), 0.1, 1) inp$ini$logn <- log(2) inp$phases$logn <- -1\n```\n\n1.  **Прайер для параметра n**: Устанавливаем лог-нормальное распределение для экспоненты в продукционном уравнении, фиксируя модель Шефера (n=2).\n\n2.  **Начальное значение**: Задаем стартовую точку для оптимизации как log(2), что соответствует n=2.\n\n3.  **Фиксация параметра**: Флаг **`-1`** исключает n из оценки, делая его константой (упрощает модель).\n\n4.  **Биологический смысл**: Обеспечивает реалистичную форму кривой производства (параболическую).\n\n```         \ninp$priors$logK <- c(5, 0.7, 1)\n```\n\n1.  **Прайер для ёмкости среды**: Задаем лог-нормальное распределение для K.\n\n2.  **Параметры**: Медиана exp(5)≈148 тыс.т, SD=0.7 в лог-шкале.\n\n3.  **Значение 1**: Активирует использование прайера в расчетах.\n\n4.  **Назначение**: Отражает экспертные знания о возможном диапазоне K.\n\n```         \ninp$priors$logbkfrac <- c(log(0.75),0.25,1)\n```\n\n1.  **Приор для начальной биомассы**: Определяет распределение для B₀/K.\n\n2.  **Параметры**: Медиана 0.75 (начальная биомасса 75% от K), SD=0.25.\n\n3.  **Биологический смысл**: Отражает гипотезу, что запас изначально был близок к неиспользуемому.\n\n4.  **Важность**: Помогает оценить начальные условия при ограниченных данных.\n\n**Настройка неопределенности данных**\n\n```         \ninp$stdevfacC[length(inp$stdevfacC)] <- 2\n```\n\n1.  **Цель**: Увеличить неопределенность последнего года вылова.\n\n2.  **Значение 2**: Стандартная ошибка увеличивается вдвое.\n\n3.  **Причина**: Последние данные часто предварительные или неполные.\n\n4.  **Эффект**: Снижает влияние потенциально ненадежной точки на оценку запаса.\n\n```         \ninp$stdevfacI[[2]][length(inp$stdevfacI[[2]])] <- 2\n```\n\n1.  **Цель**: Повысить неопределенность последнего значения научного индекса (BESS).\n\n2.  **Синтаксис**: **`[[2]]`** указывает на второй индекс в списке.\n\n3.  **Обоснование**: Данные съемок могут требовать последующих корректировок.\n\n4.  **Результат**: Модель становится менее чувствительной к потенциальным аномалиям.\n\n**Настройка временного шага**\n\n```         \ninp$dteuler <- 1/16\n```\n\n1.  **Цель**: Улучшить точность численного интегрирования.\n\n2.  **Значение**: Шаг расчета ≈23 дня (вместо годового).\n\n3.  **Необходимость**: Для короткоживущих видов (н-р, креветка) с быстрой динамикой.\n\n4.  **Эффект**: Точнее учитывает внутригодовые изменения и сезонность.\n\n5.  **Цена**: Увеличивает время расчета в 3-5 раз.\n\n**Включение оценки ковариации**\n\n```         \ninp$getJointPrecision <- TRUE\n```\n\n1.  **Цель**: Рассчитать полную ковариационную матрицу параметров.\n\n2.  **Необходимость**: Для корректной оценки неопределенности производных показателей (B/BMSY).\n\n3.  **Что делает**: Учитывает взаимосвязи между параметрами и скрытыми состояниями.\n\n4.  **Преимущество**: Более реалистичные доверительные интервалы.\n\n5.  **Ограничение**: Увеличивает время расчета на 20-30%.\n\n## Визуализация входных данных\n\n```{r}\n#| output: false\n#| eval: false\n\n# ----------------- 5. ВИЗУАЛИЗАЦИЯ ВХОДНЫХ ДАННЫХ -----------------\n\n## 5.1 Общий график данных\nplotspict.data(inp)\n\nplotspict.ci(inp)\n```\n\n![Рис. 3.: Визуализация входных данных](images/SPICT3.PNG){fig-align=\"center\" width=\"60%\"}\n\n## Запуск модели\n\n```{r}\n#| output: false\n#| eval: false\n# ------------------- 6. ЗАПУСК МОДЕЛИ --------------------\n\n## 6.1 Настройка оптимизатора\ninp$optimiser.control = list(iter.max = 1e5, eval.max = 1e5)\n\n## 6.2 Подгонка модели\nfit <- fit.spict(inp)\n\n## 6.3 Добавление OSA-остатков\nfit <- calc.osa.resid(fit) \n\n```\n\n**Настройка оптимизатора**\n\n```         \ninp$optimiser.control = list(iter.max = 1e5, eval.max = 1e5)\n```\n\n**Что это делает:**\n\n1.  Увеличивает максимальное количество итераций (iter.max) и вычислений (eval.max) для алгоритма оптимизации до 100,000\n\n2.  Обеспечивает, что процесс оптимизации не остановится преждевременно из-за ограничений по умолчанию\n\n3.  Особенно важно для сложных моделей с несколькими индексами или при плохой сходимости\n\n4.  Помогает алгоритму найти глобальный минимум функции правдоподобия\n\n5.  Предотвращает ошибки типа \"maximum iterations reached\"\n\n**Подгонка модели**\n\n```         \nfit <- fit.spict(inp)\n```\n\n**Что происходит:**\n\n1.  **Оценка параметров**: Ищет значения параметров (K, r, q и др.), максимизирующие правдоподобие\n\n2.  **Интегрирование уравнений**: Решает дифференциальные уравнения модели с шагом dteuler\n\n3.  **Расчет неопределенности**: Оценивает стандартные ошибки через обратную матрицу Гессе\n\n4.  **Диагностика сходимости**: Проверяет успешность оптимизации (fit\\$opt\\$convergence)\n\n5.  **Сохраняет результаты**: Формирует объект fit со всеми выходами модели\n\n**Ключевые процессы:**\n\n-   Численная оптимизация (обычно алгоритм nlminb)\n\n-   Интегрирование методом Эйлера\n\n-   Расчет логарифмического правдоподобия\n\n-   Оценка матрицы Гессе\n\n**OSA-остатки**\n\n```         \nfit <- calc.osa.resid(fit)\n```\n\n**Что такое OSA-остатки:**\n\n1.  **One-Step-Ahead residuals** - остатки \"на один шаг вперед\"\n\n2.  **Диагностический инструмент**: Показывают, насколько хорошо модель предсказывает следующее наблюдение\n\n3.  **Расчет**: Для каждого года t модель подгоняется по данным до t-1, затем сравнивается предсказание с фактическим значением в t\n\n**Что делают:**\n\n1.  **Обнаружение систематических ошибок**: Выявляют смещения в предсказаниях\n\n2.  **Проверка независимости**: Автокорреляция в остатках указывает на неучтенные зависимости\n\n3.  **Оценка распределения ошибок**: Проверяют соответствие нормальному распределению\n\n4.  **Идентификация выбросов**: Помогают найти аномальные точки данных\n\n## Диагностика сходимости\n\n```{r}\n#| output: false\n#| eval: false\n# ----------------- 7. ДИАГНОСТИКА СХОДИМОСТИ -----------------\n\n## 7.1 Проверка сходимости\nfit$opt$convergence  # 0 = успешная сходимость\n\n## 7.2 Проверка конечных значений\nall(is.finite(fit$sd)) # TRUE = все параметры конечны\n```\n\n**Диагностика сходимости модели SPiCT**\n\n**Проверка сходимости (7.1)**\\\n**`fit$opt$convergence`** — индикатор успешности оптимизации. Возвращаемое значение **0** означает, что алгоритм оптимизации успешно сошелся к точке максимума правдоподобия. Это важно, так как гарантирует:\n\n1.  Параметры модели достигли стабильных значений\n\n2.  Градиент функции правдоподобия близок к нулю\n\n3.  Результаты статистически надежны\n\n4.  Модель готова для дальнейшего анализа и прогнозирования\n\n**Интерпретация кодов:**\n\n-   **0**: Успешная сходимость (идеальный результат)\n\n-   **1**: Достигнут лимит итераций (требует увеличения iter.max)\n\n-   **10**: Дегенерация симплекса (проблемы с данными)\n\n-   Другие коды указывают на специфические ошибки оптимизации\n\n**Проверка конечных значений (7.2)**\\\n**`all(is.finite(fit$sd))`** — комплексная проверка корректности оценок неопределенности. Результат **TRUE** означает:\n\n1.  Все стандартные ошибки параметров являются вещественными числами\n\n2.  Отсутствуют патологические значения (NaN, Inf, NA) в матрице Гессе\n\n3.  Ковариационная матрица положительно определена\n\n4.  Оценки неопределенности надежны для построения доверительных интервалов\n\n**Что проверяет:**\n\n-   Корректность расчета стандартных ошибок\n\n-   Отсутствие вырожденных параметров\n\n-   Численную стабильность решения\n\n-   Возможность интерпретировать результаты\n\n**Последствия FALSE:**\n\n1.  Невозможно построить достоверные доверительные интервалы\n\n2.  Риск ошибочных управленческих рекомендаций\n\n3.  Требуется пересмотр модели (упрощение, изменение прайеров)\n\n## Диагностика модели\n\n```{r}\n#| output: false\n#| eval: false\n\n# ----------------- 8. ДИАГНОСТИКА МОДЕЛИ -----------------\n\n## 8.1 График остатков\nplotspict.osar(fit) \n\n## 8.2 Общая диагностика\nplotspict.diagnostic(fit)\n\n## 8.3 Сравнение приоров и апостериорных распределений\nplotspict.priors(fit)\n\n## 8.4 Проверка корреляции параметров\ncov2cor(fit$cov.fixed)        # Матрица корреляций\ncov2cor(fit$cov.fixed) > 0.8  # Выявление сильных корреляций (>0.8)\n```\n\n![Рис. 4.: График остатков](images/SPICT4.PNG){fig-align=\"center\" width=\"60%\"}\n\n**Остатки по времени** (Residuals vs. time):\n\n```         \n-   Показывает разницу между наблюдаемыми значениями и предсказаниями модели\n\n-   Идеал: случайное распределение вокруг нуля\n\n    ### **Что означает \"Index 1 Bias p-val 0.7813\"?**\n\n    Это результат **статистического теста на систематическую ошибку** (bias) для первого индекса (в вашем случае - CPUE):\n\n    1.  **Index 1**: Это ваш индекс CPUE (первый в списке индексов)\n\n    2.  **Bias p-val**: p-value теста на наличие систематического смещения\n\n    3.  **0.7813**: Конкретное значение p-value\n\n    ### **Интерпретация значения 0.7813:**\n\n    -   **p-value \\> 0.05**: Нет статистически значимых доказательств систематической ошибки (смещения)\n\n    -   **Высокое значение (0.7813)**: Сильно выше 0.05 → модель **не имеет значимого смещения** для этого индекса\n\n    -   **Практический смысл**: Модель адекватно описывает динамику CPUE без постоянного завышения или занижения\n```\n\n![Рис. 5.: Общая диагностика](images/SPICT5.PNG){fig-align=\"center\" width=\"80%\"}\n\n**Структура диагностического графика**\n\n1.  **Первый столбец:** Информация, связанная с данными по **вылову (catch)**.\n\n2.  **Второй и третий столбцы:** Информация, связанная с данными по **индексам биомассы**.\n\n**Строки графика содержат (сверху вниз):**\n\n1.  **Логарифмы исходных рядов данных:**\n\n    -   Верхний левый график в строке: **`log catch data`** (Логарифм данных по вылову).\n\n    -   Срелний и правый графики в строке: **`log index data`** (Логарифм данных по индексу).\n\n    -   *Цель:* Визуально оценить исходные данные.\n\n2.  **OSA-остатки:**\n\n    -   График показывает разницу между наблюдаемыми и предсказанными на один шаг вперед значениями (в логарифмической шкале).\n\n    -   **Заголовок графика** содержит **p-значение теста на смещение (bias test)**. Этот тест проверяет, отличается ли среднее остатков от нуля (систематическая ошибка).\n\n        -   **`Bias p-val: X.XXXX`** (p-значение теста на смещение).\n\n        -   **Зеленый заголовок:** Тест НЕ значим (нет свидетельств систематической ошибки, p \\> 0.05).\n\n        -   **Красный заголовок:** Тест значим (есть свидетельства систематической ошибки, p \\<= 0.05).\n\n    -   Три теста незначимы (p=0.4386 для вылова, p=0.7813 и p=0.9472 для индексов), заголовки зеленые.\n\n3.  **Эмпирическая автокорреляция остатков (ACF - Autocorrelation Function):**\n\n    -   График показывает корреляцию остатков с их собственными лагированными значениями.\n\n    -   Выполняется **два теста на значимую автокорреляцию:**\n\n        1.  **Тест Льюнга-Бокса (Ljung-Box test):** Одновременный тест для нескольких лагов (здесь 4). Результат:\n\n            -   **`LBox p-val: X.XXXX`** в заголовке графика.\n\n            -   На примере: Три теста незначимы (p=0.1348 для вылова, p=0.68 и p=0.3602 для индексов).\n\n        2.  **Тесты для отдельных лагов:** Пунктирные горизонтальные линии на графике показывают критические значения для значимой автокорреляции на каждом конкретном лаге. Если столбики автокорреляции (вертикальные линии) выходят за эти пунктирные линии, это свидетельствует о значимой автокорреляции на данном лаге.\n\n    -   На примере : Никаких нарушений (значимой автокорреляции) не выявлено.\n\n4.  **Тесты на нормальность остатков:**\n\n    -   **QQ-график (Quantile-Quantile plot):** Сравнивает квантили остатков с квантилями теоретического нормального распределения. Прямая линия указывает на нормальность.\n\n    -   **Тест Шапиро-Уилка (Shapiro-Wilk test):** Формальный тест на нормальность. Результат:\n\n        -   **`Shapiro p-val: X.XXXX`** в заголовке графика.\n\n        -   На примере: Три теста незначимы (p=0.1268 для вылова, p=0.9554 и p=0.9825 для индекса), нет свидетельств против нормальности.\n\n**Вывод для примера :**\\\nДанные в этом примере **не показали значимых нарушений** предположений модели (нет систематической ошибки, автокорреляции или отклонения от нормальности остатков). Это **повышает уверенность в полученных результатах** моделирования.\n\n**Для обсуждения возможных нарушений и способов их устранения** читатель отсылается к Pedersen and Berg (2017) см. <https://github.com/DTUAqua/spict/raw/master/spict/inst/doc/spict_handbook.pdf>.\n\n![Рис. 6.: Сравнение априорных и апостериорных распределений](images/SPICT6.PNG){fig-align=\"center\" width=\"80%\"}\n\n**`n` (параметр формы продукционной функции)**\n\n-   **Описание:** Определяет форму продукционной кривой (зависимость роста биомассы от самой биомассы).\n\n-   **Интерпретация:**\n\n    -   **`n = 2`**: Классическая модель Шефера (симметричная кривая, максимум производства при **`B/K = 0.5`**).\n\n    -   **`n ≠ 2`**: Обобщенная модель Пеллы-Томлинсона (асимметричная кривая).\n\n-   **Важность:** влияет на оценку **`Bmsy`** (биомасса при MSY) и статус запаса (**`B/Bmsy`**).\n\n**`alpha1`, `alpha2` (Параметры соотношения шумов для индексов)**\n\n-   **Описание:** Логарифмы отношений стандартных отклонений ошибок наблюдения индексов (**`sdi1`**, **`sdi2`**) к стандартному отклонению процесса биомассы (**`sdb`**):\\\n    **`alpha1 = log(sdi1) - log(sdb)`**\\\n    **`alpha2 = log(sdi2) - log(sdb)`**\n\n-   **Интерпретация:**\n\n    -   Отражают *относительную точность* каждого индекса биомассы по сравнению с изменчивостью самой биомассы.\n\n    -   **`alpha = 0`** (**`sdi = sdb`**): Шум индекса равен шуму биомассы.\n\n    -   **`alpha < 0`** (**`sdi < sdb`**): Индекс точнее, чем изменчивость биомассы (хорошо).\n\n    -   **`alpha > 0`** (**`sdi > sdb`**): Индекс шумнее, чем изменчивость биомассы (плохо).\n\n-   **Контекст:** Появляются, только если в модели используется **два или более индексов** биомассы.\n\n**`beta` (Параметр соотношения шумов для уловов)**\n\n-   **Описание:** Логарифм отношения стандартного отклонения ошибок наблюдения уловов (**`sdc`**) к стандартному отклонению процесса промысловой смертности (**`sdf`**):\\\n    **`beta = log(sdc) - log(sdf)`**\n\n-   **Интерпретация:**\n\n    -   Отражает *относительную точность* данных по уловам по сравнению с изменчивостью промысловой смертности.\n\n    -   **`beta = 0`** (**`sdc = sdf`**): Шум уловов равен шуму F.\n\n    -   **`beta < 0`** (**`sdc < sdf`**): Данные по уловам точнее, чем изменчивость F (хорошо).\n\n    -   **`beta > 0`** (**`sdc > sdf`**): Данные по уловам шумнее, чем изменчивость F (плохо).\n\n**`K` (емкость среды)**\n\n-   **Описание:** Максимальная равновесная биомасса неэксплуатируемого запаса (carrying capacity).\n\n-   **Интерпретация:** Верхняя асимптота кривой роста. Один из самых важных и часто трудных для оценки параметров, особенно при ограниченных данных.\n\n-   **Единицы измерения:** Те же, что и у биомассы (например, тонны, тыс. особей).\n\n### **`bkfrac` (Начальная биомасса)**\n\n-   **Описание:** Доля от **`K`**, которую составляла биомасса запаса в **начальный год** временного ряда:\\\n    **`bkfrac = B₀ / K`**\n\n-   **Интерпретация:**\n\n    -   **`bkfrac = 1`**: Запас был в нетронутом состоянии в начальный год (**`B₀ = K`**).\n\n    -   **`bkfrac < 1`**: Запас уже был эксплуатируемым к началу ряда данных.\n\n-   **Важность:** Сильно влияет на реконструкцию исторической динамики биомассы, особенно если данные начинаются с периода интенсивного промысла.\n\n**Почему именно эти параметры?**\n\nФункция **`plotspict.priors(fit)`** по умолчанию фокусируется на параметрах, для которых:\n\n1.  **Заданы явные априорные распределения** пользователем (как **`logK`** или **`bkfrac`** в примерах).\n\n2.  **Применены стандартные полу-информативные априоры SPiCT** для стабилизации оценки в условиях ограниченных данных. К ним относятся **`n`**, **`alpha1`**, **`alpha2`**, **`beta`**. SPiCT использует их, так как эти параметры (особенно **`n`** и соотношения шумов) часто плохо определяются только данными улова и индекса.\n\n**Сравнение априора и апостериора показывает:**\n\n-   Насколько **данные обновили наши первоначальные представления** (априорные) о параметре.\n\n-   Насколько **информативны были априорные распределения**.\n\n-   **Надежность оценки:** Сильное сужение апостериорного распределения относительно априорного говорит о том, что данные содержат информацию о параметре. Если апостериорное распределение почти совпадает с априорным, данные не добавили новой информации (оценка держится на априорном распределение (прайере)).\n\n## Проверка корреляции параметров\n\n```{r}\n#| output: false\n#| eval: false\n\n## 8.4 Проверка корреляции параметров\n> cov2cor(fit$cov.fixed)        # Матрица корреляций\n              logm        logK        logq        logq      logsdb      logsdf\nlogm    1.00000000 -0.44139706  0.24731406  0.26680092  0.10226103  0.05866772\nlogK   -0.44139706  1.00000000 -0.78966591 -0.84564098 -0.14502822  0.03159055\nlogq    0.24731406 -0.78966591  1.00000000  0.92073272  0.09936208 -0.06019367\nlogq    0.26680092 -0.84564098  0.92073272  1.00000000  0.10661957 -0.06022707\nlogsdb  0.10226103 -0.14502822  0.09936208  0.10661957  1.00000000 -0.07548411\nlogsdf  0.05866772  0.03159055 -0.06019367 -0.06022707 -0.07548411  1.00000000\nlogsdi  0.04194204 -0.06650572  0.12991301  0.13206072  0.05802810 -0.02826486\nlogsdi -0.02144997  0.05063718 -0.08833322 -0.09060172  0.04142955  0.00688377\nlogsdc -0.03142644 -0.10430756  0.07611708  0.07988704  0.19380037 -0.38345908\n            logsdi       logsdi       logsdc\nlogm    0.04194204 -0.021449974 -0.031426440\nlogK   -0.06650572  0.050637182 -0.104307558\nlogq    0.12991301 -0.088333221  0.076117083\nlogq    0.13206072 -0.090601717  0.079887038\nlogsdb  0.05802810  0.041429548  0.193800371\nlogsdf -0.02826486  0.006883770 -0.383459078\nlogsdi  1.00000000 -0.024282304  0.029024203\nlogsdi -0.02428230  1.000000000 -0.005068705\nlogsdc  0.02902420 -0.005068705  1.000000000\n> cov2cor(fit$cov.fixed) > 0.8  # Выявление сильных корреляций (>0.8)\n        logm  logK  logq  logq logsdb logsdf logsdi logsdi logsdc\nlogm    TRUE FALSE FALSE FALSE  FALSE  FALSE  FALSE  FALSE  FALSE\nlogK   FALSE  TRUE FALSE FALSE  FALSE  FALSE  FALSE  FALSE  FALSE\nlogq   FALSE FALSE  TRUE  TRUE  FALSE  FALSE  FALSE  FALSE  FALSE\nlogq   FALSE FALSE  TRUE  TRUE  FALSE  FALSE  FALSE  FALSE  FALSE\nlogsdb FALSE FALSE FALSE FALSE   TRUE  FALSE  FALSE  FALSE  FALSE\nlogsdf FALSE FALSE FALSE FALSE  FALSE   TRUE  FALSE  FALSE  FALSE\nlogsdi FALSE FALSE FALSE FALSE  FALSE  FALSE   TRUE  FALSE  FALSE\nlogsdi FALSE FALSE FALSE FALSE  FALSE  FALSE  FALSE   TRUE  FALSE\nlogsdc FALSE FALSE FALSE FALSE  FALSE  FALSE  FALSE  FALSE   TRUE\n> \n```\n\n**Анализ матрицы корреляций параметров модели SPiCT**\n\nКоманды выполняют два действия:\n\n1.  **`cov2cor(fit$cov.fixed)`** - преобразует матрицу ковариаций в матрицу корреляций\n\n2.  **`cov2cor(fit$cov.fixed) > 0.8`** - выявляет сильные корреляции (\\>0.8)\n\n**Умеренные корреляции (\\|r\\| \\> 0.7):**\n\n-   **logK и logq (-0.79)**:\\\n    Классическая **отрицательная корреляция между емкостью среды и уловистостью**. Означает, что:\n\n    -   Данные можно объяснить либо:\n\n        -   Большим запасом (высокий K) с низкой уловистостью (низкий q)\n\n        -   Или малым запасом (низкий K) с высокой уловистостью (высокий q)\n\n    -   Типично для моделей с ограниченными данными\n\n## Визуализация резульататов\n\n```{r}\n#| output: false\n#| eval: false\n\n----------------- 9. ВИЗУАЛИЗАЦИЯ РЕЗУЛЬТАТОВ -----------------\n\n## 9.1 Основные графики\n\nplot(fit) \\# Комплексный отчет\n\n## 9.2 Биомасса в абсолютных величинах\n\nplotspict.biomass( fit, logax = FALSE, \\# Линейная шкала main = \"Абсолютная биомасса\", ylim = c(0, 250), \\# Ограничение по оси Y plot.obs = TRUE, \\# Отображать наблюдения xlab = \"Год\", CI = 0.95, \\# 95% доверительный интервал qlegend = FALSE, rel.axes = TRUE, rel.ci = TRUE )\n\n## 9.3 Относительная биомасса (B/Bmsy)\n\nplotspict.bbmsy(fit,qlegend = FALSE)\n\n## 9.4 Вылов\n\nplotspict.catch(fit,qlegend = FALSE)\n\n## 9.5 Относительная смертность (F/Fmsy)\n\nplotspict.ffmsy(fit,qlegend = FALSE)\n\n## 9.6 Продукционная кривая\n\nplotspict.production(fit)\n\n## 9.7 Kobe plot\n\nplotspict.fb(fit, ylim=c(0, 0.5), xlim=c(0, 200))\n\n```\n\n![Рис. 7.: Комплексный отчет](images/SPICT7.PNG){fig-align=\"center\" width=\"80%\"}\n\n![Рис. 8.: Динамика абсолютной биомассы](images/SPICT8.PNG){fig-align=\"center\" width=\"60%\"}\n\n![Рис. 9.: Динамика относительной биомассы](images/SPICT9.PNG){fig-align=\"center\" width=\"60%\"}\n\n![Рис. 10.: Динамика относительной смертности](images/SPICT10.PNG){fig-align=\"center\" width=\"60%\"}\n\n![Рис. 11.: Продукционная кривая](images/SPICT11.PNG){fig-align=\"center\" width=\"60%\"}\n\n![Рис. 12.: Kobe plot](images/SPICT12.PNG){fig-align=\"center\" width=\"60%\"}\n\nГрафик показывает динамику биомассы и смертности от промысла с начального года (здесь 2005), обозначенного кругом, до конечного года (здесь 2025), обозначенного квадратом. Жёлтый ромб обозначает среднюю биомассу за длительный период при сохранении текущей (2025) промысловой нагрузки. Эта точка может быть интерпретирована как равновесное значение вылова и обозначена в легенде как E(B∞) как статистический способ выражения ожидания биомассы при t → ∞. Поскольку текущая промысловая смертность близка к FMSY, ожидаемая долгосрочная биомасса близка к BMSY. Серая затенённая область в форме банана обозначает 95% доверительную область пары FMSY, BMSY. Эту область важно визуализировать совместно, поскольку две контрольные точки имеют сильную (отрицательную) корреляцию.\n\n## Анализ результатов\n\n```{r}\n#| output: false\n#| eval: false\n# ----------------- 10. АНАЛИЗ РЕЗУЛЬТАТОВ -----------------\n\n## 10.1 Краткий отчет\nsummary(fit)\n\n## 10.2 Точечные оценки параметров\npars <- sumspict.parest(fit)\n\n## 10.3 Ориентиры управления (стохастические)\nsumspict.srefpoints(fit)\n\n## 10.4 Ориентиры управления (детерминированные)\nsumspict.drefpoints(fit)\n```\n\nКраткий отчет\n\n```{r}\n#| output: false\n#| eval: false\nmary(fit)\nConvergence: 0  MSG: relative convergence (4)\nObjective function at optimum: -4.8303552\nEuler time step (years):  1/16 or 0.0625\nNobs C: 20,  Nobs I1: 20,  Nobs I2: 19\n\nResidual diagnostics (p-values)\n    shapiro   bias    acf   LBox shapiro bias acf LBox  \n C   0.1268 0.4386 0.0562 0.1348       -    -   .    -  \n I1  0.9554 0.7813 0.3360 0.6800       -    -   -    -  \n I2  0.9825 0.9472 0.1390 0.3602       -    -   -    -  \n\nPriors\n      logn  ~  dnorm[log(2), 0.1^2]\n  logalpha  ~  dnorm[log(1), 2^2]\n   logbeta  ~  dnorm[log(1), 2^2]\n      logK  ~  dnorm[log(148.413), 0.7^2]\n logbkfrac  ~  dnorm[log(0.75), 0.25^2]\n\nFixed parameters\n   fixed.value  \n n           2  \n\nModel parameter estimates w 95% CI \n           estimate       cilow       ciupp    log.est  \n alpha1  11.9450241   2.6794895  53.2502930  2.4803148  \n alpha2   5.0683878   1.1265510  22.8028330  1.6230228  \n beta     0.1879597   0.0371609   0.9507000 -1.6715278  \n r        0.3769549   0.2895415   0.4907586 -0.9756298  \n rc       0.3769549   0.2895415   0.4907586 -0.9756298  \n rold     0.3769549   0.2895415   0.4907586 -0.9756298  \n m       17.8600178  16.2681570  19.6076444  2.8825646  \n K      189.5188972 153.7796069 233.5642100  5.2444887  \n q1       0.1446167   0.1110579   0.1883161 -1.9336685  \n q2       0.1105024   0.0861636   0.1417164 -2.2027177  \n sdb      0.0179239   0.0040818   0.0787065 -4.0216194  \n sdf      0.3205493   0.2181678   0.4709762 -1.1377191  \n sdi1     0.2141016   0.1563268   0.2932285 -1.5413046  \n sdi2     0.0908454   0.0648365   0.1272875 -2.3985967  \n sdc      0.0602503   0.0143610   0.2527760 -2.8092469  \n \nDeterministic reference points (Drp)\n         estimate      cilow       ciupp   log.est  \n Bmsyd 94.7594486 76.8898035 116.7821050  4.551342  \n Fmsyd  0.1884774  0.1447707   0.2453793 -1.668777  \n MSYd  17.8600178 16.2681570  19.6076444  2.882565  \nStochastic reference points (Srp)\n        estimate      cilow       ciupp   log.est  rel.diff.Drp  \n Bmsys 94.710229 76.8402135 116.7361074  4.550822 -0.0005196907  \n Fmsys  0.188398  0.1447201   0.2452583 -1.669199 -0.0004216341  \n MSYs  17.843213 16.2542730  19.5874793  2.881623 -0.0009418271  \n\nStates w 95% CI (inp$msytype: s)\n                   estimate      cilow       ciupp    log.est  \n B_2024.94      118.8335053 96.9318694 145.6837887  4.7777234  \n F_2024.94        0.1031939  0.0646828   0.1646340 -2.2711455  \n B_2024.94/Bmsy   1.2547061  1.0845329   1.4515812  0.2269014  \n F_2024.94/Fmsy   0.5477442  0.3417896   0.8778024 -0.6019469  \n\nPredictions w 95% CI (inp$msytype: s)\n                 prediction       cilow       ciupp    log.est  \n B_2026.00      123.0873098 100.3197792 151.0219217  4.8128939  \n F_2026.00        0.1031941   0.0464383   0.2293155 -2.2711437  \n B_2026.00/Bmsy   1.2996200   1.1150104   1.5147950  0.2620719  \n F_2026.00/Fmsy   0.5477452   0.2458405   1.2204040 -0.6019451  \n Catch_2025.00   12.4909882   7.3033391  21.3634865  2.5250074  \n E(B_inf)       137.4532783          NA          NA  4.9232841  \n> \n```\n\n**Анализ результатов модели SPiCT**\n\n**1. Сходимость модели**\n\n**`Convergence: 0 MSG: relative convergence (4)`**\\\n*Интерпретация:* Код 0 указывает на успешную сходимость оптимизации. Сообщение \"relative convergence\" подтверждает, что алгоритм достиг локального минимума с заданной точностью. Результаты могут считаться валидными.\n\n**2. Целевая функция**\n\n**`Objective function at optimum: -4.8303552`**\\\n*Интерпретация:* Значение логарифмической апостериорной плотности (с учетом априорных распределений) в точке оптимума. Более высокие значения (менее отрицательные) указывают на лучшее соответствие модели данным.\n\n**3. Дискретизация времени**\n\n**`Euler time step (years): 1/16 or 0.0625`**\\\n*Интерпретация:* Для решения дифференциальных уравнений использован шаг Эйлера 0.0625 года (\\~23 дня), что обеспечивает высокую точность расчетов.\n\n**4. Данные наблюдений**\n\n```         \nNobs C: 20,  Nobs I1: 20,  Nobs I2: 19\n```\n\n*Интерпретация:*\n\n-   C: 20 точек данных по вылову (2005-2024 гг.)\n-   I1: 20 значений индекса CPUE\n-   I2: 19 значений индекса BESS (отсутствует первое наблюдение)\n\n**5. Диагностика остатков**\n\n```         \nResidual diagnostics (p-values)\nshapiro   bias    acf   LBox\nC   0.1268 0.4386 0.0562 0.1348\nI1  0.9554 0.7813 0.3360 0.6800\nI2  0.9825 0.9472 0.1390 0.3602  \n```\n\n*Ключевые тесты:*\n\n-   **Shapiro-Wilk:** Нормальность остатков (p \\> 0.05 → нормальность не отвергается)\n-   **Bias test:** Систематическая ошибка (p \\> 0.05 → смещение отсутствует)\n-   **ACF/Ljung-Box:** Автокорреляция (p \\< 0.1 для вылова → слабая автокорреляция)\\\n    *Заключение:* Остатки удовлетворительны, кроме возможной слабой автокорреляции в данных по вылову.\n\n**6. Априорные распределения**\n\n```         \nPriors\nlogn  ~  dnorm[log(2), 0.1^2]       # Фиксирован n = 2 (модель Шефера)   \nlogK  ~  dnorm[log(148.413), 0.7^2]  # K ~ 148.4 тыс. тонн (CV=70%)   \nlogbkfrac ~ dnorm[log(0.75), 0.25^2] # Начальная эксплуатация B/K = 0.75\n```\n\n*Интерпретация:* Использованы информативные априорные распределения для ключевых параметров, что характерно для data-limited подходов.\n\n**7. Оценки параметров модели**\n\n```         \nModel parameter estimates w 95% CI\n      estimate       cilow       ciupp  \nK      189.5 [153.8 - 233.6]  # Емкость среды (тыс. тонн)  \nr        0.38 [0.29 - 0.49]   # Внутренняя скорость роста \nq1       0.14 [0.11 - 0.19]   # Catchability CPUE \nq2       0.11 [0.09 - 0.14]   # Catchability BESS  \nsdf      0.32 [0.22 - 0.47]   # SD процесса для F\n```\n\n*Ключевые выводы:* - Высокая неопределенность оценки K (дов. интервал ±40%) - Умеренная скорость восстановления запаса (r ≈ 38% в год) - Индекс BESS имеет более высокую catchability, чем CPUE\n\n**8. Ориентиры управления**\n\n```         \nDeterministic reference points (Drp)\nestimate      95% CI  \nBmsyd   94.8 [76.9 - 116.8]  # Биомасса при MSY  \nFmsyd    0.19 [0.14 - 0.25]  # Смертность при MSY  \nMSYd    17.9 [16.3 - 19.6]   # Макс. устойчивый вылов  \n\nStochastic reference points (Srp)          \nestimate      rel.diff.Drp    \nBmsys   94.7         -0.05%        # Незначительные отличия от детерм. модели  \nFmsys    0.19        -0.04%\n```\n\n*Интерпретация:* Результаты устойчивы к стохастичности модели. MSY ≈ 18 тыс. тонн.\n\n**9. Состояние запаса в 2024 г.**\n\n```         \nStates w 95% CI (inp$msytype: s)                   \nestimate      95% CI  \nB_2024.94        118.8 [96.9 - 145.7]  # Абсолютная биомасса (тыс. т) \nF_2024.94          0.10 [0.06 - 0.16]  # Смертность \nB/Bmsy             1.25 [1.08 - 1.45]  # Биомасса выше Bmsy\nF/Fmsy             0.55 [0.34 - 0.88]  # Эксплуатация ниже Fmsy\n```\n\n*Оценка состояния:* Запас находится в благополучном состоянии (B \\> Bmsy, F \\< Fmsy), но с высокой неопределенностью.\n\n**10. Прогнозы**\n\n```         \nPredictions w 95% CI\nB_2026.00      123.1 [100.3 - 151.0]  # Прогноз биомассы\nCatch_2025.00   12.5 [7.3 - 21.4]     # Прогноз вылова на 2025 г.  \nE(B_inf)       137.5                   # Ожидаемая равновесная биомасса\n```\n\n*Прогнозные показатели:* - Биомасса продолжит умеренный рост - Рекомендуемый вылов на 2025 г. ≈ 12.5 тыс. тонн (дов. интервал ±57%) - Потенциальная равновесная биомасса на 16% выше текущей\n\n**Ключевые выводы:**\n\n1.  Модель успешно сошлась с удовлетворительными остатками\n2.  Запас оценивается выше целевого уровня (B/Bmsy \\> 1)\n3.  Эксплуатация находится на безопасном уровне (F/Fmsy \\< 1)\n4.  Рекомендуемый вылов на 2025 г. — 12.5 \\[7.3 - 21.4\\] тыс. тонн\n5.  Основные источники неопределенности: оценка K и прогноз вылова\n\n## Ретроспективный анализ\n\n```{r}\n#| output: false\n#| eval: false\n# -------------- 11. РЕТРОСПЕКТИВНЫЙ АНАЛИЗ --------------\n\n## 11.1 Запуск ретроспективного анализа\nfit <- retro(fit)\n\n## 11.2 Визуализация ретроспективы\nplotspict.retro(fit, add.mohn = TRUE, CI = 0.95)\n\n## Интерпретация коэффициента Мона (Mohn's rho):\n## Долгоживущие виды: |rho| > 0.2 значимо\n## Короткоживущие виды: |rho| > 0.3 значимо\n```\n\n![Рис. 13.: Визуализация ретроспективного анализа](images/SPICT13.PNG){fig-align=\"center\" width=\"80%\"}\n\n**Суть ретроспективного анализа (Retrospective Analysis)**\n\n**Цель:** Оценка устойчивости модели и выявление систематических смещений (ретроспективного сдвига) в оценках состояния запаса при добавлении новых данных.\n\n**Метод:**\n\n1.  Модель последовательно переоценивается с исключением по 1 последнему году данных (например: 2005-2023, 2005-2022 и т.д.)\n\n2.  Для каждого урезанного периода рассчитываются показатели (B/Bmsy, F/Fmsy) в **перекрывающиеся годы**\n\n3.  Оценки сравниваются с \"базовой\" моделью (со всеми данными)\n\n**Коэффициент Мона (Mohn's rho)**\n\n**Формула расчета:**\n\n```         \nρ = 1/N * Σ [ (X_retro,i - X_base,i) / X_base,i ]\n```\n\nгде:\n\n-   **`N`** – число исключенных лет\n\n-   **`X_retro,i`** – оценка параметра (напр. B/Bmsy) в году i по урезанным данным\n\n-   **`X_base,i`** – оценка того же параметра в году i по полным данным\n\n**Интерпретация результатов в вашем случае:**\n\n```         \n        FFmsy         BBmsy   0.0028358361 -0.0002021046 \n```\n\n1.  **Для F/Fmsy:** ρ = 0.0028 (0.28%)\n\n    -   Положительное значение: текущие оценки F/Fmsy **слегка завышены** по сравнению с ретроспективой\n\n    -   Величина \\< 0.3% – незначима\n\n2.  **Для B/Bmsy:** ρ = -0.0002 (-0.02%)\n\n    -   Отрицательное значение: текущие оценки B/Bmsy **слегка занижены**\n\n    -   Величина \\< 0.1% – пренебрежимо мала\n\n**Вывод для модели:**\n\n-   Коэффициенты Мона близки к нулю (\\|ρ\\| \\< 0.005)\n\n-   **Отсутствует статистически значимый ретроспективный сдвиг**\n\n-   Модель демонстрирует высокую устойчивость к добавлению новых данных\n\n-   Результаты можно считать надежными\n\n> **Важно!** Значимый сдвиг (\\|ρ\\| \\> 0.2-0.3) указывает на:\n>\n> -   Недостаточность данных\n>\n> -   Проблемы со спецификацией модели\n>\n> -   Систематические ошибки в данных\n>\n> -   Необходимость пересмотра модели\n\n## Прогнозирование и сценарии управления\n\n```{r}\n#| output: false\n#| eval: false\n# ----------- 12. ПРОГНОЗИРОВАНИЕ И СЦЕНАРИИ УПРАВЛЕНИЯ -----------\n\n## 12.1 Установка интервала управления\ninp$maninterval <- c(2025, 2026) # Годы прогноза\n\n## 12.2 Базовые сценарии управления\nfit <- manage(fit)\n\n## 12.3 Пользовательские сценарии (постоянный вылов)\ncatchvals = c(10, 12, 15, 17) # Варианты вылова в тыс.тонн\n\nfor(i in seq_along(catchvals)){\n  fit <- add.man.scenario(\n    fit,\n    scenarioTitle = paste0(\"Постоянный вылов \", catchvals[i], \" тыс.т\"),\n    cabs = catchvals[i]  # Абсолютный вылов\n  )\n}\n\n## 12.4 Сводка по сценариям управления\nsumspict.manage(fit, include.unc = TRUE) # С учетом неопределенности\n```\n\nПолучаем:\n\n```{r}\n#| output: false\n#| eval: false\nSPiCT timeline:\n                                                  \n      Observations              Management        \n    2005.00 - 2025.00        2025.00 - 2026.00    \n |-----------------------| ----------------------|\n\nManagement evaluation: 2026.00\n\nPredicted catch for management period and states at management evaluation time:\n\n                                 C B/Bmsy F/Fmsy\n1. Keep current catch         11.8   1.31   0.52\n2. Keep current F             12.5   1.30   0.55\n3. Fish at Fmsy               22.0   1.20   1.00\n4. No fishing                  0.0   1.42   0.00\n5. Reduce F by 25%             9.5   1.33   0.41\n6. Increase F by 25%          15.4   1.27   0.68\n7. MSY hockey-stick rule      22.0   1.20   1.00\n8. ICES advice rule           19.9   1.23   0.90\n9. Постоянный вылов 10 тыс.т  10.0   1.32   0.43\n10. Постоянный вылов 12 тыс.т 12.0   1.30   0.53\n11. Постоянный вылов 15 тыс.т 15.0   1.27   0.66\n12. Постоянный вылов 17 тыс.т 17.0   1.25   0.76\n\n95% confidence intervals for states:\n\n                              B/Bmsy.lo B/Bmsy.hi F/Fmsy.lo F/Fmsy.hi\n1. Keep current catch              1.12      1.52      0.23      1.15\n2. Keep current F                  1.12      1.51      0.25      1.22\n3. Fish at Fmsy                    1.00      1.44      0.45      2.23\n4. No fishing                      1.25      1.63      0.00      0.00\n5. Reduce F by 25%                 1.15      1.54      0.18      0.92\n6. Increase F by 25%               1.08      1.49      0.31      1.53\n7. MSY hockey-stick rule           1.00      1.44      0.45      2.23\n8. ICES advice rule                1.03      1.46      0.40      2.00\n9. Постоянный вылов 10 тыс.т       1.14      1.54      0.19      0.97\n10. Постоянный вылов 12 тыс.т      1.12      1.52      0.24      1.17\n11. Постоянный вылов 15 тыс.т      1.09      1.49      0.30      1.48\n12. Постоянный вылов 17 тыс.т      1.06      1.48      0.34      1.69\n\n```\n\n![Рис. 14.: Правило хоккейной клюшки и ICES](images/SPICT14.PNG){fig-align=\"center\" width=\"80%\"}\n\n**Процесс прогнозирования и оценки сценариев управления**\n\n**1. Установка горизонта прогнозирования**\n\n```         \ninp$maninterval <- c(2025, 2026)\n```\n\n-   **Цель:** Определить период, для которого делаются прогнозы (2025-2026 гг.)\n-   **Механика:** Модель будет рассчитывать состояние запаса и возможный вылов на эти годы\n\n**2. Базовые сценарии управления**\n\n```         \nfit <- manage(fit)\n```\n\nАвтоматически генерируются стандартные сценарии:\n\n1.  **`currentCatch`**: Сохранение текущего вылова (среднее за последние 3 года)\n2.  **`currentF`**: Сохранение текущего уровня смертности (F)\n3.  **`Fmsy`**: Эксплуатация на уровне F~MSY~\n4.  **`noF`**: Полное прекращение промысла\n5.  **`reduceF25`**: Снижение F на 25%\n6.  **`increaseF25`**: Увеличение F на 25%\n7.  **`msyHockeyStick`**: Правило \"хоккейной клюшки\" (F=0 при B\\>B~MSY~, F=F~MSY~ при B≥B~MSY~)\n8.  **`ices`**: Правило ICES (F пропорционален уровню биомассы)\n\n**3. Пользовательские сценарии**\n\n```         \ncatchvals = c(10, 12, 15, 17) for(i in seq_along(catchvals)){   fit <- add.man.scenario(     fit,     scenarioTitle = paste0(\"Постоянный вылов \", catchvals[i], \" тыс.т\"),     cabs = catchvals[i]   ) }\n```\n\n-   **Стратегия:** Фиксированный вылов указанного объема в 2025-2026 гг.\n-   **Диапазон:** От консервативного (10 тыс.т) до рискованного (17 тыс.т)\n\n**4. Сводка результатов**\n\n```         \nsumspict.manage(fit, include.unc = TRUE)\n```\n\n**Ключевые выводы из результатов (на 2026 г.)**\n\n**1. Прогноз состояния запаса**\n\n| **Показатель** | **Значение** | **Интерпретация**                        |\n|:---------------|:-------------|:-----------------------------------------|\n| B/B~MSY~       | 1.25-1.31    | Запас выше целевого уровня (B\\>B~MSY~)   |\n| F/F~MSY~       | 0.52-0.55    | Эксплуатация ниже предельной (F\\<F~MSY~) |\n\n**2. Сравнение сценариев**\n\n| **Сценарий** | **Вылов (тыс.т)** | **B/**B~MSY~ | **F/**F~MSY~ | **Риск перелова** |\n|:---|:---|:---|:---|:---|\n| **Безопасные:** |  |  |  |  |\n| **`noF`** (нет промысла) | 0.0 | 1.42 | 0.00 | Нет |\n| **`reduceF25`** | 9.5 | 1.33 | 0.41 | Низкий |\n| Вылов 10 тыс.т | 10.0 | 1.32 | 0.43 | Низкий |\n| **Оптимальные:** |  |  |  |  |\n| **`currentCatch`** | 11.8 | 1.31 | 0.52 | Низкий |\n| Вылов 12 тыс.т | 12.0 | 1.30 | 0.53 | Низкий |\n| **Рискованные:** |  |  |  |  |\n| **`increaseF25`** | 15.4 | 1.27 | 0.68 | Умеренный |\n| Вылов 15 тыс.т | 15.0 | 1.27 | 0.66 | Умеренный |\n| **Опасные:** |  |  |  |  |\n| F~MSY~ | 22.0 | 1.20 | 1.00 | Высокий |\n| Вылов 17 тыс.т | 17.0 | 1.25 | 0.76 | Высокий |\n\n**3. Анализ неопределенности**\n\nДля ключевых сценариев:\n\n-   **Вылов 12 тыс.т:**\\\n    F/F~MSY~\\> = 0.53 \\[0.24-1.17\\] → 10% вероятность превышения F~MSY~\n\n-   **Вылов 15 тыс.т:**\\\n    F/F~MSY~ = 0.66 \\[0.30-1.48\\] → 30% вероятность превышения F~MSY~\n\n-   **Вылов 17 тыс.т:**\\\n    F/F~MSY~ = 0.76 \\[0.34-1.69\\] → 45% вероятность превышения F~MSY~\n\n**Рекомендации по управлению**\n\n1.  **Оптимальный вылов:** 12 тыс. тонн\n    -   Сохраняет запас в безопасной зоне (B/B~MSY~ \\> 1.3)\n    -   Минимизирует риск перелова (F/F~MSY~ \\< 0.55)\n    -   Учитывает неопределенность модельных оценок\n2.  **Предельно допустимый вылов:** 15 тыс. тонн\n    -   Требует усиленного мониторинга\n    -   Необходим ежегодный пересмотр квот\n3.  **Не рекомендуются:**\n    -   Сценарии с F≥F~MSY~ (22 тыс.т)\n    -   Фиксированный вылов \\>15 тыс.т\n    -   Стратегии, приводящие к снижению B/B~MSY~ \\< 1.25\n\n> **Критический фактор:** Высокая неопределенность прогноза вылова (дов. интервал 7.3-21.4 тыс.т для текущего сценария) требует осторожного подхода.\n","srcMarkdownNoYaml":"\n\n## Введение\n\nБиблиотека SPiCT <https://github.com/DTUAqua/spict> - оценка запаса с помощью стохастической версии продукционной модели и байесовского подхода. Доступен краткий обзор пакета [`здесь`](https://github.com/DTUAqua/spict/raw/master/spict/inst/doc/spict_handbook.pdf), который служит для ознакомления с пакетом и его функционалом. В обзоре также содержится описание более продвинутых функций пакета.\n\nДокумент с техническими рекомендациями по использованию SPiCT доступен [здесь](https://github.com/DTUAqua/spict/raw/master/spict/inst/doc/spict_guidelines.pdf) . Это постоянно обновляемый документ.\n\nПакет также содержит достаточно подробную документацию в виде справочных текстов, связанных с каждой функцией (некоторые из них могут быть не полностью актуальны). Доступ к ним можно получить обычным для R способом, набрав, например `?check.inp`, . Для начала (помимо изучения краткого обзора) рекомендуется прочитать `?check.inp`и `?fit.spict`.\n\n## Установка пакетов и Загрузка данных\n\n```{r}\n#| output: false\n#| eval: false\n\n# ------------------------- 1. ПОДГОТОВКА СРЕДЫ ---------------------------\n\n## 1.1 Установка пакетов (выполнить один раз)\n# install.packages(\"tidyverse\")\n#remotes::install_github(\"DTUAqua/spict/spict\") # Установка SPiCT\n#install.packages(\"TMB\", type=\"source\")\n\n## 1.2 Загрузка библиотек\nlibrary(spict)   # Основной пакет для моделирования\nlibrary(tidyverse) # Для обработки данных и визуализации\n\n\n## 1.3 Установка рабочей директории\nsetwd(\"C:/SPICT\") # Укажите вашу рабочую папку\n\n\n# ------------------------- 2. ЗАГРУЗКА ДАННЫХ ---------------------------\n\n## 2.1 Вектор лет наблюдений\nYear <- 2005:2024\n\n## 2.2 Данные по вылову (тыс. тонн)\nCatch <- c(5,  7,  6, 10, 14, 25, 28, 30, 32, 35, 25, 20, 15, 12, 10, 12, 10, 13, 11, 12)\n\n## 2.3 Индекс CPUE (промысловый индекс)\nCPUEIndex <- c(27.427120, 26.775958, 16.811997, 22.979653, 29.048568, 29.996072, 16.476301,\n17.174455, 10.537272, 14.590435,  8.286352, 11.394168, 15.537878, 13.791166,\n11.527548, 15.336093, 12.154069, 15.568450, 16.221933, 13.421132)\n\n## 2.4 Индекс BESS (научная съемка)\nBESSIndex <- c( NA, 16.270375, 20.691355, 15.141784, 18.594620, 15.975548, 13.792012,\n13.328805, 11.659744, 11.753855,  9.309859,  7.104886,  7.963839,  9.161322,\n10.271221,  9.822960, 10.347376, 11.703610, 13.679876, 13.413696)\n```\n\n## Кросс-корреляции с временным лагом между индексами и уловами\n\n```{r}\n#| output: false\n#| eval: false\n# График кросс-корреляции: Catch и BESSindex (только данные без пропусков)\nccf(na.omit(Catch), na.omit(BESSIndex),\n    main = \"Кросс-корреляция: Уловы и BESSindex\",\n    xlab = \"Лаг (годы)\", ylab = \"Корреляция\")\n\n\n# График кросс-корреляции: Catch и CPUEIndex (только данные без пропусков)\nccf(na.omit(Catch), na.omit(CPUEIndex),\n    main = \"Кросс-корреляция: Уловы и CPUEIndex\",\n    xlab = \"Лаг (годы)\", ylab = \"Корреляция\")\n```\n\n![Рис. 1.: График кросс-корреляции: Catch и BESSindex](images/SPICT1.PNG){fig-align=\"center\" width=\"60%\"}\n\n![Рис. 2.: График кросс-корреляции: Catch и CPUEIndex](images/SPICT2.PNG){fig-align=\"center\" width=\"60%\"}\n\n## Подготовка данных для SPiCT\n\n```{r}\n#| output: false\n#| eval: false\n#| # ------------------- 3. ПОДГОТОВКА ДАННЫХ ДЛЯ SPiCT --------------------\n\n## 3.1 Форматирование данных в список SPiCT\ninput_new <- list(\n  timeC = Year,     # Годы вылова\n  obsC = Catch,     # Значения вылова\n  timeI = list(     # Временные точки для индексов:\n    Year + 0.5,     #  CPUE - середина года (июль)\n    Year + 0.75     #  BESS - 3/4 года (октябрь)\n  ),\n  obsI = list(\n    CPUEIndex,      # Значения индекса CPUE\n    BESSIndex       # Значения индекса BESS\n  )\n)\n\n## 3.2 Проверка и подготовка входных данных\ninp <- check.inp(input_new, verbose = TRUE)\n```\n\nФункция check.inp() выполняет подготовку и валидацию входных данных перед моделированием. Основные задачи функции:\n\nПроверяет наличие обязательных элементов: timeC (временные точки вылова), obsC (значения вылова). Проверяет соответствие индексов (timeI и obsI): одинаковое количество элементов в списках, соответствие длин временных рядов. Обработка пропущенных значений. Автоматически обрабатывает NA в начале вектора CPUEIndex (2005-2010). Удаляет или маркирует пропущенные значения в соответствии с настройками пакета и пр.\n\n## Настройка модели\n\n```{r}\n#| output: false\n#| eval: false\n# ------------------- 4. НАСТРОЙКА МОДЕЛИ --------------------\n\n## 4.1 Установка априорных распределений\ninp$priors$logn <- c(log(2), 0.1, 1)   # Прайер для n (модель Шефера)\ninp$ini$logn <- log(2)                  # Начальное значение\ninp$phases$logn <- -1                   # Фиксируем параметр (не оцениваем)\n\ninp$priors$logK <- c(5, 0.7, 1)       # Прайер для емкости среды (K)\ninp$priors$logbkfrac <- c(log(0.75),0.25,1) # Начальный уровень эксплуатации\n\n\n\n## 4.2 Настройка неопределенности данных\n# Повышаем неопределенность для последнего года вылова\ninp$stdevfacC[length(inp$stdevfacC)] <- 2 \n\n# Повышаем неопределенность для последнего значения BESS\ninp$stdevfacI[[2]][length(inp$stdevfacI[[2]])] <- 2 \n\n## 4.3 Настройка временного шага\ninp$dteuler <- 1/16  # Более точная дискретизация (по умолчанию 1)\n\n## 4.4 Включение оценки ковариации\ninp$getJointPrecision <- TRUE # Для оценки случайных эффектов\n```\n\n**Установка априорных распределений**\n\n```         \ninp$priors$logn <- c(log(2), 0.1, 1) inp$ini$logn <- log(2) inp$phases$logn <- -1\n```\n\n1.  **Прайер для параметра n**: Устанавливаем лог-нормальное распределение для экспоненты в продукционном уравнении, фиксируя модель Шефера (n=2).\n\n2.  **Начальное значение**: Задаем стартовую точку для оптимизации как log(2), что соответствует n=2.\n\n3.  **Фиксация параметра**: Флаг **`-1`** исключает n из оценки, делая его константой (упрощает модель).\n\n4.  **Биологический смысл**: Обеспечивает реалистичную форму кривой производства (параболическую).\n\n```         \ninp$priors$logK <- c(5, 0.7, 1)\n```\n\n1.  **Прайер для ёмкости среды**: Задаем лог-нормальное распределение для K.\n\n2.  **Параметры**: Медиана exp(5)≈148 тыс.т, SD=0.7 в лог-шкале.\n\n3.  **Значение 1**: Активирует использование прайера в расчетах.\n\n4.  **Назначение**: Отражает экспертные знания о возможном диапазоне K.\n\n```         \ninp$priors$logbkfrac <- c(log(0.75),0.25,1)\n```\n\n1.  **Приор для начальной биомассы**: Определяет распределение для B₀/K.\n\n2.  **Параметры**: Медиана 0.75 (начальная биомасса 75% от K), SD=0.25.\n\n3.  **Биологический смысл**: Отражает гипотезу, что запас изначально был близок к неиспользуемому.\n\n4.  **Важность**: Помогает оценить начальные условия при ограниченных данных.\n\n**Настройка неопределенности данных**\n\n```         \ninp$stdevfacC[length(inp$stdevfacC)] <- 2\n```\n\n1.  **Цель**: Увеличить неопределенность последнего года вылова.\n\n2.  **Значение 2**: Стандартная ошибка увеличивается вдвое.\n\n3.  **Причина**: Последние данные часто предварительные или неполные.\n\n4.  **Эффект**: Снижает влияние потенциально ненадежной точки на оценку запаса.\n\n```         \ninp$stdevfacI[[2]][length(inp$stdevfacI[[2]])] <- 2\n```\n\n1.  **Цель**: Повысить неопределенность последнего значения научного индекса (BESS).\n\n2.  **Синтаксис**: **`[[2]]`** указывает на второй индекс в списке.\n\n3.  **Обоснование**: Данные съемок могут требовать последующих корректировок.\n\n4.  **Результат**: Модель становится менее чувствительной к потенциальным аномалиям.\n\n**Настройка временного шага**\n\n```         \ninp$dteuler <- 1/16\n```\n\n1.  **Цель**: Улучшить точность численного интегрирования.\n\n2.  **Значение**: Шаг расчета ≈23 дня (вместо годового).\n\n3.  **Необходимость**: Для короткоживущих видов (н-р, креветка) с быстрой динамикой.\n\n4.  **Эффект**: Точнее учитывает внутригодовые изменения и сезонность.\n\n5.  **Цена**: Увеличивает время расчета в 3-5 раз.\n\n**Включение оценки ковариации**\n\n```         \ninp$getJointPrecision <- TRUE\n```\n\n1.  **Цель**: Рассчитать полную ковариационную матрицу параметров.\n\n2.  **Необходимость**: Для корректной оценки неопределенности производных показателей (B/BMSY).\n\n3.  **Что делает**: Учитывает взаимосвязи между параметрами и скрытыми состояниями.\n\n4.  **Преимущество**: Более реалистичные доверительные интервалы.\n\n5.  **Ограничение**: Увеличивает время расчета на 20-30%.\n\n## Визуализация входных данных\n\n```{r}\n#| output: false\n#| eval: false\n\n# ----------------- 5. ВИЗУАЛИЗАЦИЯ ВХОДНЫХ ДАННЫХ -----------------\n\n## 5.1 Общий график данных\nplotspict.data(inp)\n\nplotspict.ci(inp)\n```\n\n![Рис. 3.: Визуализация входных данных](images/SPICT3.PNG){fig-align=\"center\" width=\"60%\"}\n\n## Запуск модели\n\n```{r}\n#| output: false\n#| eval: false\n# ------------------- 6. ЗАПУСК МОДЕЛИ --------------------\n\n## 6.1 Настройка оптимизатора\ninp$optimiser.control = list(iter.max = 1e5, eval.max = 1e5)\n\n## 6.2 Подгонка модели\nfit <- fit.spict(inp)\n\n## 6.3 Добавление OSA-остатков\nfit <- calc.osa.resid(fit) \n\n```\n\n**Настройка оптимизатора**\n\n```         \ninp$optimiser.control = list(iter.max = 1e5, eval.max = 1e5)\n```\n\n**Что это делает:**\n\n1.  Увеличивает максимальное количество итераций (iter.max) и вычислений (eval.max) для алгоритма оптимизации до 100,000\n\n2.  Обеспечивает, что процесс оптимизации не остановится преждевременно из-за ограничений по умолчанию\n\n3.  Особенно важно для сложных моделей с несколькими индексами или при плохой сходимости\n\n4.  Помогает алгоритму найти глобальный минимум функции правдоподобия\n\n5.  Предотвращает ошибки типа \"maximum iterations reached\"\n\n**Подгонка модели**\n\n```         \nfit <- fit.spict(inp)\n```\n\n**Что происходит:**\n\n1.  **Оценка параметров**: Ищет значения параметров (K, r, q и др.), максимизирующие правдоподобие\n\n2.  **Интегрирование уравнений**: Решает дифференциальные уравнения модели с шагом dteuler\n\n3.  **Расчет неопределенности**: Оценивает стандартные ошибки через обратную матрицу Гессе\n\n4.  **Диагностика сходимости**: Проверяет успешность оптимизации (fit\\$opt\\$convergence)\n\n5.  **Сохраняет результаты**: Формирует объект fit со всеми выходами модели\n\n**Ключевые процессы:**\n\n-   Численная оптимизация (обычно алгоритм nlminb)\n\n-   Интегрирование методом Эйлера\n\n-   Расчет логарифмического правдоподобия\n\n-   Оценка матрицы Гессе\n\n**OSA-остатки**\n\n```         \nfit <- calc.osa.resid(fit)\n```\n\n**Что такое OSA-остатки:**\n\n1.  **One-Step-Ahead residuals** - остатки \"на один шаг вперед\"\n\n2.  **Диагностический инструмент**: Показывают, насколько хорошо модель предсказывает следующее наблюдение\n\n3.  **Расчет**: Для каждого года t модель подгоняется по данным до t-1, затем сравнивается предсказание с фактическим значением в t\n\n**Что делают:**\n\n1.  **Обнаружение систематических ошибок**: Выявляют смещения в предсказаниях\n\n2.  **Проверка независимости**: Автокорреляция в остатках указывает на неучтенные зависимости\n\n3.  **Оценка распределения ошибок**: Проверяют соответствие нормальному распределению\n\n4.  **Идентификация выбросов**: Помогают найти аномальные точки данных\n\n## Диагностика сходимости\n\n```{r}\n#| output: false\n#| eval: false\n# ----------------- 7. ДИАГНОСТИКА СХОДИМОСТИ -----------------\n\n## 7.1 Проверка сходимости\nfit$opt$convergence  # 0 = успешная сходимость\n\n## 7.2 Проверка конечных значений\nall(is.finite(fit$sd)) # TRUE = все параметры конечны\n```\n\n**Диагностика сходимости модели SPiCT**\n\n**Проверка сходимости (7.1)**\\\n**`fit$opt$convergence`** — индикатор успешности оптимизации. Возвращаемое значение **0** означает, что алгоритм оптимизации успешно сошелся к точке максимума правдоподобия. Это важно, так как гарантирует:\n\n1.  Параметры модели достигли стабильных значений\n\n2.  Градиент функции правдоподобия близок к нулю\n\n3.  Результаты статистически надежны\n\n4.  Модель готова для дальнейшего анализа и прогнозирования\n\n**Интерпретация кодов:**\n\n-   **0**: Успешная сходимость (идеальный результат)\n\n-   **1**: Достигнут лимит итераций (требует увеличения iter.max)\n\n-   **10**: Дегенерация симплекса (проблемы с данными)\n\n-   Другие коды указывают на специфические ошибки оптимизации\n\n**Проверка конечных значений (7.2)**\\\n**`all(is.finite(fit$sd))`** — комплексная проверка корректности оценок неопределенности. Результат **TRUE** означает:\n\n1.  Все стандартные ошибки параметров являются вещественными числами\n\n2.  Отсутствуют патологические значения (NaN, Inf, NA) в матрице Гессе\n\n3.  Ковариационная матрица положительно определена\n\n4.  Оценки неопределенности надежны для построения доверительных интервалов\n\n**Что проверяет:**\n\n-   Корректность расчета стандартных ошибок\n\n-   Отсутствие вырожденных параметров\n\n-   Численную стабильность решения\n\n-   Возможность интерпретировать результаты\n\n**Последствия FALSE:**\n\n1.  Невозможно построить достоверные доверительные интервалы\n\n2.  Риск ошибочных управленческих рекомендаций\n\n3.  Требуется пересмотр модели (упрощение, изменение прайеров)\n\n## Диагностика модели\n\n```{r}\n#| output: false\n#| eval: false\n\n# ----------------- 8. ДИАГНОСТИКА МОДЕЛИ -----------------\n\n## 8.1 График остатков\nplotspict.osar(fit) \n\n## 8.2 Общая диагностика\nplotspict.diagnostic(fit)\n\n## 8.3 Сравнение приоров и апостериорных распределений\nplotspict.priors(fit)\n\n## 8.4 Проверка корреляции параметров\ncov2cor(fit$cov.fixed)        # Матрица корреляций\ncov2cor(fit$cov.fixed) > 0.8  # Выявление сильных корреляций (>0.8)\n```\n\n![Рис. 4.: График остатков](images/SPICT4.PNG){fig-align=\"center\" width=\"60%\"}\n\n**Остатки по времени** (Residuals vs. time):\n\n```         \n-   Показывает разницу между наблюдаемыми значениями и предсказаниями модели\n\n-   Идеал: случайное распределение вокруг нуля\n\n    ### **Что означает \"Index 1 Bias p-val 0.7813\"?**\n\n    Это результат **статистического теста на систематическую ошибку** (bias) для первого индекса (в вашем случае - CPUE):\n\n    1.  **Index 1**: Это ваш индекс CPUE (первый в списке индексов)\n\n    2.  **Bias p-val**: p-value теста на наличие систематического смещения\n\n    3.  **0.7813**: Конкретное значение p-value\n\n    ### **Интерпретация значения 0.7813:**\n\n    -   **p-value \\> 0.05**: Нет статистически значимых доказательств систематической ошибки (смещения)\n\n    -   **Высокое значение (0.7813)**: Сильно выше 0.05 → модель **не имеет значимого смещения** для этого индекса\n\n    -   **Практический смысл**: Модель адекватно описывает динамику CPUE без постоянного завышения или занижения\n```\n\n![Рис. 5.: Общая диагностика](images/SPICT5.PNG){fig-align=\"center\" width=\"80%\"}\n\n**Структура диагностического графика**\n\n1.  **Первый столбец:** Информация, связанная с данными по **вылову (catch)**.\n\n2.  **Второй и третий столбцы:** Информация, связанная с данными по **индексам биомассы**.\n\n**Строки графика содержат (сверху вниз):**\n\n1.  **Логарифмы исходных рядов данных:**\n\n    -   Верхний левый график в строке: **`log catch data`** (Логарифм данных по вылову).\n\n    -   Срелний и правый графики в строке: **`log index data`** (Логарифм данных по индексу).\n\n    -   *Цель:* Визуально оценить исходные данные.\n\n2.  **OSA-остатки:**\n\n    -   График показывает разницу между наблюдаемыми и предсказанными на один шаг вперед значениями (в логарифмической шкале).\n\n    -   **Заголовок графика** содержит **p-значение теста на смещение (bias test)**. Этот тест проверяет, отличается ли среднее остатков от нуля (систематическая ошибка).\n\n        -   **`Bias p-val: X.XXXX`** (p-значение теста на смещение).\n\n        -   **Зеленый заголовок:** Тест НЕ значим (нет свидетельств систематической ошибки, p \\> 0.05).\n\n        -   **Красный заголовок:** Тест значим (есть свидетельства систематической ошибки, p \\<= 0.05).\n\n    -   Три теста незначимы (p=0.4386 для вылова, p=0.7813 и p=0.9472 для индексов), заголовки зеленые.\n\n3.  **Эмпирическая автокорреляция остатков (ACF - Autocorrelation Function):**\n\n    -   График показывает корреляцию остатков с их собственными лагированными значениями.\n\n    -   Выполняется **два теста на значимую автокорреляцию:**\n\n        1.  **Тест Льюнга-Бокса (Ljung-Box test):** Одновременный тест для нескольких лагов (здесь 4). Результат:\n\n            -   **`LBox p-val: X.XXXX`** в заголовке графика.\n\n            -   На примере: Три теста незначимы (p=0.1348 для вылова, p=0.68 и p=0.3602 для индексов).\n\n        2.  **Тесты для отдельных лагов:** Пунктирные горизонтальные линии на графике показывают критические значения для значимой автокорреляции на каждом конкретном лаге. Если столбики автокорреляции (вертикальные линии) выходят за эти пунктирные линии, это свидетельствует о значимой автокорреляции на данном лаге.\n\n    -   На примере : Никаких нарушений (значимой автокорреляции) не выявлено.\n\n4.  **Тесты на нормальность остатков:**\n\n    -   **QQ-график (Quantile-Quantile plot):** Сравнивает квантили остатков с квантилями теоретического нормального распределения. Прямая линия указывает на нормальность.\n\n    -   **Тест Шапиро-Уилка (Shapiro-Wilk test):** Формальный тест на нормальность. Результат:\n\n        -   **`Shapiro p-val: X.XXXX`** в заголовке графика.\n\n        -   На примере: Три теста незначимы (p=0.1268 для вылова, p=0.9554 и p=0.9825 для индекса), нет свидетельств против нормальности.\n\n**Вывод для примера :**\\\nДанные в этом примере **не показали значимых нарушений** предположений модели (нет систематической ошибки, автокорреляции или отклонения от нормальности остатков). Это **повышает уверенность в полученных результатах** моделирования.\n\n**Для обсуждения возможных нарушений и способов их устранения** читатель отсылается к Pedersen and Berg (2017) см. <https://github.com/DTUAqua/spict/raw/master/spict/inst/doc/spict_handbook.pdf>.\n\n![Рис. 6.: Сравнение априорных и апостериорных распределений](images/SPICT6.PNG){fig-align=\"center\" width=\"80%\"}\n\n**`n` (параметр формы продукционной функции)**\n\n-   **Описание:** Определяет форму продукционной кривой (зависимость роста биомассы от самой биомассы).\n\n-   **Интерпретация:**\n\n    -   **`n = 2`**: Классическая модель Шефера (симметричная кривая, максимум производства при **`B/K = 0.5`**).\n\n    -   **`n ≠ 2`**: Обобщенная модель Пеллы-Томлинсона (асимметричная кривая).\n\n-   **Важность:** влияет на оценку **`Bmsy`** (биомасса при MSY) и статус запаса (**`B/Bmsy`**).\n\n**`alpha1`, `alpha2` (Параметры соотношения шумов для индексов)**\n\n-   **Описание:** Логарифмы отношений стандартных отклонений ошибок наблюдения индексов (**`sdi1`**, **`sdi2`**) к стандартному отклонению процесса биомассы (**`sdb`**):\\\n    **`alpha1 = log(sdi1) - log(sdb)`**\\\n    **`alpha2 = log(sdi2) - log(sdb)`**\n\n-   **Интерпретация:**\n\n    -   Отражают *относительную точность* каждого индекса биомассы по сравнению с изменчивостью самой биомассы.\n\n    -   **`alpha = 0`** (**`sdi = sdb`**): Шум индекса равен шуму биомассы.\n\n    -   **`alpha < 0`** (**`sdi < sdb`**): Индекс точнее, чем изменчивость биомассы (хорошо).\n\n    -   **`alpha > 0`** (**`sdi > sdb`**): Индекс шумнее, чем изменчивость биомассы (плохо).\n\n-   **Контекст:** Появляются, только если в модели используется **два или более индексов** биомассы.\n\n**`beta` (Параметр соотношения шумов для уловов)**\n\n-   **Описание:** Логарифм отношения стандартного отклонения ошибок наблюдения уловов (**`sdc`**) к стандартному отклонению процесса промысловой смертности (**`sdf`**):\\\n    **`beta = log(sdc) - log(sdf)`**\n\n-   **Интерпретация:**\n\n    -   Отражает *относительную точность* данных по уловам по сравнению с изменчивостью промысловой смертности.\n\n    -   **`beta = 0`** (**`sdc = sdf`**): Шум уловов равен шуму F.\n\n    -   **`beta < 0`** (**`sdc < sdf`**): Данные по уловам точнее, чем изменчивость F (хорошо).\n\n    -   **`beta > 0`** (**`sdc > sdf`**): Данные по уловам шумнее, чем изменчивость F (плохо).\n\n**`K` (емкость среды)**\n\n-   **Описание:** Максимальная равновесная биомасса неэксплуатируемого запаса (carrying capacity).\n\n-   **Интерпретация:** Верхняя асимптота кривой роста. Один из самых важных и часто трудных для оценки параметров, особенно при ограниченных данных.\n\n-   **Единицы измерения:** Те же, что и у биомассы (например, тонны, тыс. особей).\n\n### **`bkfrac` (Начальная биомасса)**\n\n-   **Описание:** Доля от **`K`**, которую составляла биомасса запаса в **начальный год** временного ряда:\\\n    **`bkfrac = B₀ / K`**\n\n-   **Интерпретация:**\n\n    -   **`bkfrac = 1`**: Запас был в нетронутом состоянии в начальный год (**`B₀ = K`**).\n\n    -   **`bkfrac < 1`**: Запас уже был эксплуатируемым к началу ряда данных.\n\n-   **Важность:** Сильно влияет на реконструкцию исторической динамики биомассы, особенно если данные начинаются с периода интенсивного промысла.\n\n**Почему именно эти параметры?**\n\nФункция **`plotspict.priors(fit)`** по умолчанию фокусируется на параметрах, для которых:\n\n1.  **Заданы явные априорные распределения** пользователем (как **`logK`** или **`bkfrac`** в примерах).\n\n2.  **Применены стандартные полу-информативные априоры SPiCT** для стабилизации оценки в условиях ограниченных данных. К ним относятся **`n`**, **`alpha1`**, **`alpha2`**, **`beta`**. SPiCT использует их, так как эти параметры (особенно **`n`** и соотношения шумов) часто плохо определяются только данными улова и индекса.\n\n**Сравнение априора и апостериора показывает:**\n\n-   Насколько **данные обновили наши первоначальные представления** (априорные) о параметре.\n\n-   Насколько **информативны были априорные распределения**.\n\n-   **Надежность оценки:** Сильное сужение апостериорного распределения относительно априорного говорит о том, что данные содержат информацию о параметре. Если апостериорное распределение почти совпадает с априорным, данные не добавили новой информации (оценка держится на априорном распределение (прайере)).\n\n## Проверка корреляции параметров\n\n```{r}\n#| output: false\n#| eval: false\n\n## 8.4 Проверка корреляции параметров\n> cov2cor(fit$cov.fixed)        # Матрица корреляций\n              logm        logK        logq        logq      logsdb      logsdf\nlogm    1.00000000 -0.44139706  0.24731406  0.26680092  0.10226103  0.05866772\nlogK   -0.44139706  1.00000000 -0.78966591 -0.84564098 -0.14502822  0.03159055\nlogq    0.24731406 -0.78966591  1.00000000  0.92073272  0.09936208 -0.06019367\nlogq    0.26680092 -0.84564098  0.92073272  1.00000000  0.10661957 -0.06022707\nlogsdb  0.10226103 -0.14502822  0.09936208  0.10661957  1.00000000 -0.07548411\nlogsdf  0.05866772  0.03159055 -0.06019367 -0.06022707 -0.07548411  1.00000000\nlogsdi  0.04194204 -0.06650572  0.12991301  0.13206072  0.05802810 -0.02826486\nlogsdi -0.02144997  0.05063718 -0.08833322 -0.09060172  0.04142955  0.00688377\nlogsdc -0.03142644 -0.10430756  0.07611708  0.07988704  0.19380037 -0.38345908\n            logsdi       logsdi       logsdc\nlogm    0.04194204 -0.021449974 -0.031426440\nlogK   -0.06650572  0.050637182 -0.104307558\nlogq    0.12991301 -0.088333221  0.076117083\nlogq    0.13206072 -0.090601717  0.079887038\nlogsdb  0.05802810  0.041429548  0.193800371\nlogsdf -0.02826486  0.006883770 -0.383459078\nlogsdi  1.00000000 -0.024282304  0.029024203\nlogsdi -0.02428230  1.000000000 -0.005068705\nlogsdc  0.02902420 -0.005068705  1.000000000\n> cov2cor(fit$cov.fixed) > 0.8  # Выявление сильных корреляций (>0.8)\n        logm  logK  logq  logq logsdb logsdf logsdi logsdi logsdc\nlogm    TRUE FALSE FALSE FALSE  FALSE  FALSE  FALSE  FALSE  FALSE\nlogK   FALSE  TRUE FALSE FALSE  FALSE  FALSE  FALSE  FALSE  FALSE\nlogq   FALSE FALSE  TRUE  TRUE  FALSE  FALSE  FALSE  FALSE  FALSE\nlogq   FALSE FALSE  TRUE  TRUE  FALSE  FALSE  FALSE  FALSE  FALSE\nlogsdb FALSE FALSE FALSE FALSE   TRUE  FALSE  FALSE  FALSE  FALSE\nlogsdf FALSE FALSE FALSE FALSE  FALSE   TRUE  FALSE  FALSE  FALSE\nlogsdi FALSE FALSE FALSE FALSE  FALSE  FALSE   TRUE  FALSE  FALSE\nlogsdi FALSE FALSE FALSE FALSE  FALSE  FALSE  FALSE   TRUE  FALSE\nlogsdc FALSE FALSE FALSE FALSE  FALSE  FALSE  FALSE  FALSE   TRUE\n> \n```\n\n**Анализ матрицы корреляций параметров модели SPiCT**\n\nКоманды выполняют два действия:\n\n1.  **`cov2cor(fit$cov.fixed)`** - преобразует матрицу ковариаций в матрицу корреляций\n\n2.  **`cov2cor(fit$cov.fixed) > 0.8`** - выявляет сильные корреляции (\\>0.8)\n\n**Умеренные корреляции (\\|r\\| \\> 0.7):**\n\n-   **logK и logq (-0.79)**:\\\n    Классическая **отрицательная корреляция между емкостью среды и уловистостью**. Означает, что:\n\n    -   Данные можно объяснить либо:\n\n        -   Большим запасом (высокий K) с низкой уловистостью (низкий q)\n\n        -   Или малым запасом (низкий K) с высокой уловистостью (высокий q)\n\n    -   Типично для моделей с ограниченными данными\n\n## Визуализация резульататов\n\n```{r}\n#| output: false\n#| eval: false\n\n----------------- 9. ВИЗУАЛИЗАЦИЯ РЕЗУЛЬТАТОВ -----------------\n\n## 9.1 Основные графики\n\nplot(fit) \\# Комплексный отчет\n\n## 9.2 Биомасса в абсолютных величинах\n\nplotspict.biomass( fit, logax = FALSE, \\# Линейная шкала main = \"Абсолютная биомасса\", ylim = c(0, 250), \\# Ограничение по оси Y plot.obs = TRUE, \\# Отображать наблюдения xlab = \"Год\", CI = 0.95, \\# 95% доверительный интервал qlegend = FALSE, rel.axes = TRUE, rel.ci = TRUE )\n\n## 9.3 Относительная биомасса (B/Bmsy)\n\nplotspict.bbmsy(fit,qlegend = FALSE)\n\n## 9.4 Вылов\n\nplotspict.catch(fit,qlegend = FALSE)\n\n## 9.5 Относительная смертность (F/Fmsy)\n\nplotspict.ffmsy(fit,qlegend = FALSE)\n\n## 9.6 Продукционная кривая\n\nplotspict.production(fit)\n\n## 9.7 Kobe plot\n\nplotspict.fb(fit, ylim=c(0, 0.5), xlim=c(0, 200))\n\n```\n\n![Рис. 7.: Комплексный отчет](images/SPICT7.PNG){fig-align=\"center\" width=\"80%\"}\n\n![Рис. 8.: Динамика абсолютной биомассы](images/SPICT8.PNG){fig-align=\"center\" width=\"60%\"}\n\n![Рис. 9.: Динамика относительной биомассы](images/SPICT9.PNG){fig-align=\"center\" width=\"60%\"}\n\n![Рис. 10.: Динамика относительной смертности](images/SPICT10.PNG){fig-align=\"center\" width=\"60%\"}\n\n![Рис. 11.: Продукционная кривая](images/SPICT11.PNG){fig-align=\"center\" width=\"60%\"}\n\n![Рис. 12.: Kobe plot](images/SPICT12.PNG){fig-align=\"center\" width=\"60%\"}\n\nГрафик показывает динамику биомассы и смертности от промысла с начального года (здесь 2005), обозначенного кругом, до конечного года (здесь 2025), обозначенного квадратом. Жёлтый ромб обозначает среднюю биомассу за длительный период при сохранении текущей (2025) промысловой нагрузки. Эта точка может быть интерпретирована как равновесное значение вылова и обозначена в легенде как E(B∞) как статистический способ выражения ожидания биомассы при t → ∞. Поскольку текущая промысловая смертность близка к FMSY, ожидаемая долгосрочная биомасса близка к BMSY. Серая затенённая область в форме банана обозначает 95% доверительную область пары FMSY, BMSY. Эту область важно визуализировать совместно, поскольку две контрольные точки имеют сильную (отрицательную) корреляцию.\n\n## Анализ результатов\n\n```{r}\n#| output: false\n#| eval: false\n# ----------------- 10. АНАЛИЗ РЕЗУЛЬТАТОВ -----------------\n\n## 10.1 Краткий отчет\nsummary(fit)\n\n## 10.2 Точечные оценки параметров\npars <- sumspict.parest(fit)\n\n## 10.3 Ориентиры управления (стохастические)\nsumspict.srefpoints(fit)\n\n## 10.4 Ориентиры управления (детерминированные)\nsumspict.drefpoints(fit)\n```\n\nКраткий отчет\n\n```{r}\n#| output: false\n#| eval: false\nmary(fit)\nConvergence: 0  MSG: relative convergence (4)\nObjective function at optimum: -4.8303552\nEuler time step (years):  1/16 or 0.0625\nNobs C: 20,  Nobs I1: 20,  Nobs I2: 19\n\nResidual diagnostics (p-values)\n    shapiro   bias    acf   LBox shapiro bias acf LBox  \n C   0.1268 0.4386 0.0562 0.1348       -    -   .    -  \n I1  0.9554 0.7813 0.3360 0.6800       -    -   -    -  \n I2  0.9825 0.9472 0.1390 0.3602       -    -   -    -  \n\nPriors\n      logn  ~  dnorm[log(2), 0.1^2]\n  logalpha  ~  dnorm[log(1), 2^2]\n   logbeta  ~  dnorm[log(1), 2^2]\n      logK  ~  dnorm[log(148.413), 0.7^2]\n logbkfrac  ~  dnorm[log(0.75), 0.25^2]\n\nFixed parameters\n   fixed.value  \n n           2  \n\nModel parameter estimates w 95% CI \n           estimate       cilow       ciupp    log.est  \n alpha1  11.9450241   2.6794895  53.2502930  2.4803148  \n alpha2   5.0683878   1.1265510  22.8028330  1.6230228  \n beta     0.1879597   0.0371609   0.9507000 -1.6715278  \n r        0.3769549   0.2895415   0.4907586 -0.9756298  \n rc       0.3769549   0.2895415   0.4907586 -0.9756298  \n rold     0.3769549   0.2895415   0.4907586 -0.9756298  \n m       17.8600178  16.2681570  19.6076444  2.8825646  \n K      189.5188972 153.7796069 233.5642100  5.2444887  \n q1       0.1446167   0.1110579   0.1883161 -1.9336685  \n q2       0.1105024   0.0861636   0.1417164 -2.2027177  \n sdb      0.0179239   0.0040818   0.0787065 -4.0216194  \n sdf      0.3205493   0.2181678   0.4709762 -1.1377191  \n sdi1     0.2141016   0.1563268   0.2932285 -1.5413046  \n sdi2     0.0908454   0.0648365   0.1272875 -2.3985967  \n sdc      0.0602503   0.0143610   0.2527760 -2.8092469  \n \nDeterministic reference points (Drp)\n         estimate      cilow       ciupp   log.est  \n Bmsyd 94.7594486 76.8898035 116.7821050  4.551342  \n Fmsyd  0.1884774  0.1447707   0.2453793 -1.668777  \n MSYd  17.8600178 16.2681570  19.6076444  2.882565  \nStochastic reference points (Srp)\n        estimate      cilow       ciupp   log.est  rel.diff.Drp  \n Bmsys 94.710229 76.8402135 116.7361074  4.550822 -0.0005196907  \n Fmsys  0.188398  0.1447201   0.2452583 -1.669199 -0.0004216341  \n MSYs  17.843213 16.2542730  19.5874793  2.881623 -0.0009418271  \n\nStates w 95% CI (inp$msytype: s)\n                   estimate      cilow       ciupp    log.est  \n B_2024.94      118.8335053 96.9318694 145.6837887  4.7777234  \n F_2024.94        0.1031939  0.0646828   0.1646340 -2.2711455  \n B_2024.94/Bmsy   1.2547061  1.0845329   1.4515812  0.2269014  \n F_2024.94/Fmsy   0.5477442  0.3417896   0.8778024 -0.6019469  \n\nPredictions w 95% CI (inp$msytype: s)\n                 prediction       cilow       ciupp    log.est  \n B_2026.00      123.0873098 100.3197792 151.0219217  4.8128939  \n F_2026.00        0.1031941   0.0464383   0.2293155 -2.2711437  \n B_2026.00/Bmsy   1.2996200   1.1150104   1.5147950  0.2620719  \n F_2026.00/Fmsy   0.5477452   0.2458405   1.2204040 -0.6019451  \n Catch_2025.00   12.4909882   7.3033391  21.3634865  2.5250074  \n E(B_inf)       137.4532783          NA          NA  4.9232841  \n> \n```\n\n**Анализ результатов модели SPiCT**\n\n**1. Сходимость модели**\n\n**`Convergence: 0 MSG: relative convergence (4)`**\\\n*Интерпретация:* Код 0 указывает на успешную сходимость оптимизации. Сообщение \"relative convergence\" подтверждает, что алгоритм достиг локального минимума с заданной точностью. Результаты могут считаться валидными.\n\n**2. Целевая функция**\n\n**`Objective function at optimum: -4.8303552`**\\\n*Интерпретация:* Значение логарифмической апостериорной плотности (с учетом априорных распределений) в точке оптимума. Более высокие значения (менее отрицательные) указывают на лучшее соответствие модели данным.\n\n**3. Дискретизация времени**\n\n**`Euler time step (years): 1/16 or 0.0625`**\\\n*Интерпретация:* Для решения дифференциальных уравнений использован шаг Эйлера 0.0625 года (\\~23 дня), что обеспечивает высокую точность расчетов.\n\n**4. Данные наблюдений**\n\n```         \nNobs C: 20,  Nobs I1: 20,  Nobs I2: 19\n```\n\n*Интерпретация:*\n\n-   C: 20 точек данных по вылову (2005-2024 гг.)\n-   I1: 20 значений индекса CPUE\n-   I2: 19 значений индекса BESS (отсутствует первое наблюдение)\n\n**5. Диагностика остатков**\n\n```         \nResidual diagnostics (p-values)\nshapiro   bias    acf   LBox\nC   0.1268 0.4386 0.0562 0.1348\nI1  0.9554 0.7813 0.3360 0.6800\nI2  0.9825 0.9472 0.1390 0.3602  \n```\n\n*Ключевые тесты:*\n\n-   **Shapiro-Wilk:** Нормальность остатков (p \\> 0.05 → нормальность не отвергается)\n-   **Bias test:** Систематическая ошибка (p \\> 0.05 → смещение отсутствует)\n-   **ACF/Ljung-Box:** Автокорреляция (p \\< 0.1 для вылова → слабая автокорреляция)\\\n    *Заключение:* Остатки удовлетворительны, кроме возможной слабой автокорреляции в данных по вылову.\n\n**6. Априорные распределения**\n\n```         \nPriors\nlogn  ~  dnorm[log(2), 0.1^2]       # Фиксирован n = 2 (модель Шефера)   \nlogK  ~  dnorm[log(148.413), 0.7^2]  # K ~ 148.4 тыс. тонн (CV=70%)   \nlogbkfrac ~ dnorm[log(0.75), 0.25^2] # Начальная эксплуатация B/K = 0.75\n```\n\n*Интерпретация:* Использованы информативные априорные распределения для ключевых параметров, что характерно для data-limited подходов.\n\n**7. Оценки параметров модели**\n\n```         \nModel parameter estimates w 95% CI\n      estimate       cilow       ciupp  \nK      189.5 [153.8 - 233.6]  # Емкость среды (тыс. тонн)  \nr        0.38 [0.29 - 0.49]   # Внутренняя скорость роста \nq1       0.14 [0.11 - 0.19]   # Catchability CPUE \nq2       0.11 [0.09 - 0.14]   # Catchability BESS  \nsdf      0.32 [0.22 - 0.47]   # SD процесса для F\n```\n\n*Ключевые выводы:* - Высокая неопределенность оценки K (дов. интервал ±40%) - Умеренная скорость восстановления запаса (r ≈ 38% в год) - Индекс BESS имеет более высокую catchability, чем CPUE\n\n**8. Ориентиры управления**\n\n```         \nDeterministic reference points (Drp)\nestimate      95% CI  \nBmsyd   94.8 [76.9 - 116.8]  # Биомасса при MSY  \nFmsyd    0.19 [0.14 - 0.25]  # Смертность при MSY  \nMSYd    17.9 [16.3 - 19.6]   # Макс. устойчивый вылов  \n\nStochastic reference points (Srp)          \nestimate      rel.diff.Drp    \nBmsys   94.7         -0.05%        # Незначительные отличия от детерм. модели  \nFmsys    0.19        -0.04%\n```\n\n*Интерпретация:* Результаты устойчивы к стохастичности модели. MSY ≈ 18 тыс. тонн.\n\n**9. Состояние запаса в 2024 г.**\n\n```         \nStates w 95% CI (inp$msytype: s)                   \nestimate      95% CI  \nB_2024.94        118.8 [96.9 - 145.7]  # Абсолютная биомасса (тыс. т) \nF_2024.94          0.10 [0.06 - 0.16]  # Смертность \nB/Bmsy             1.25 [1.08 - 1.45]  # Биомасса выше Bmsy\nF/Fmsy             0.55 [0.34 - 0.88]  # Эксплуатация ниже Fmsy\n```\n\n*Оценка состояния:* Запас находится в благополучном состоянии (B \\> Bmsy, F \\< Fmsy), но с высокой неопределенностью.\n\n**10. Прогнозы**\n\n```         \nPredictions w 95% CI\nB_2026.00      123.1 [100.3 - 151.0]  # Прогноз биомассы\nCatch_2025.00   12.5 [7.3 - 21.4]     # Прогноз вылова на 2025 г.  \nE(B_inf)       137.5                   # Ожидаемая равновесная биомасса\n```\n\n*Прогнозные показатели:* - Биомасса продолжит умеренный рост - Рекомендуемый вылов на 2025 г. ≈ 12.5 тыс. тонн (дов. интервал ±57%) - Потенциальная равновесная биомасса на 16% выше текущей\n\n**Ключевые выводы:**\n\n1.  Модель успешно сошлась с удовлетворительными остатками\n2.  Запас оценивается выше целевого уровня (B/Bmsy \\> 1)\n3.  Эксплуатация находится на безопасном уровне (F/Fmsy \\< 1)\n4.  Рекомендуемый вылов на 2025 г. — 12.5 \\[7.3 - 21.4\\] тыс. тонн\n5.  Основные источники неопределенности: оценка K и прогноз вылова\n\n## Ретроспективный анализ\n\n```{r}\n#| output: false\n#| eval: false\n# -------------- 11. РЕТРОСПЕКТИВНЫЙ АНАЛИЗ --------------\n\n## 11.1 Запуск ретроспективного анализа\nfit <- retro(fit)\n\n## 11.2 Визуализация ретроспективы\nplotspict.retro(fit, add.mohn = TRUE, CI = 0.95)\n\n## Интерпретация коэффициента Мона (Mohn's rho):\n## Долгоживущие виды: |rho| > 0.2 значимо\n## Короткоживущие виды: |rho| > 0.3 значимо\n```\n\n![Рис. 13.: Визуализация ретроспективного анализа](images/SPICT13.PNG){fig-align=\"center\" width=\"80%\"}\n\n**Суть ретроспективного анализа (Retrospective Analysis)**\n\n**Цель:** Оценка устойчивости модели и выявление систематических смещений (ретроспективного сдвига) в оценках состояния запаса при добавлении новых данных.\n\n**Метод:**\n\n1.  Модель последовательно переоценивается с исключением по 1 последнему году данных (например: 2005-2023, 2005-2022 и т.д.)\n\n2.  Для каждого урезанного периода рассчитываются показатели (B/Bmsy, F/Fmsy) в **перекрывающиеся годы**\n\n3.  Оценки сравниваются с \"базовой\" моделью (со всеми данными)\n\n**Коэффициент Мона (Mohn's rho)**\n\n**Формула расчета:**\n\n```         \nρ = 1/N * Σ [ (X_retro,i - X_base,i) / X_base,i ]\n```\n\nгде:\n\n-   **`N`** – число исключенных лет\n\n-   **`X_retro,i`** – оценка параметра (напр. B/Bmsy) в году i по урезанным данным\n\n-   **`X_base,i`** – оценка того же параметра в году i по полным данным\n\n**Интерпретация результатов в вашем случае:**\n\n```         \n        FFmsy         BBmsy   0.0028358361 -0.0002021046 \n```\n\n1.  **Для F/Fmsy:** ρ = 0.0028 (0.28%)\n\n    -   Положительное значение: текущие оценки F/Fmsy **слегка завышены** по сравнению с ретроспективой\n\n    -   Величина \\< 0.3% – незначима\n\n2.  **Для B/Bmsy:** ρ = -0.0002 (-0.02%)\n\n    -   Отрицательное значение: текущие оценки B/Bmsy **слегка занижены**\n\n    -   Величина \\< 0.1% – пренебрежимо мала\n\n**Вывод для модели:**\n\n-   Коэффициенты Мона близки к нулю (\\|ρ\\| \\< 0.005)\n\n-   **Отсутствует статистически значимый ретроспективный сдвиг**\n\n-   Модель демонстрирует высокую устойчивость к добавлению новых данных\n\n-   Результаты можно считать надежными\n\n> **Важно!** Значимый сдвиг (\\|ρ\\| \\> 0.2-0.3) указывает на:\n>\n> -   Недостаточность данных\n>\n> -   Проблемы со спецификацией модели\n>\n> -   Систематические ошибки в данных\n>\n> -   Необходимость пересмотра модели\n\n## Прогнозирование и сценарии управления\n\n```{r}\n#| output: false\n#| eval: false\n# ----------- 12. ПРОГНОЗИРОВАНИЕ И СЦЕНАРИИ УПРАВЛЕНИЯ -----------\n\n## 12.1 Установка интервала управления\ninp$maninterval <- c(2025, 2026) # Годы прогноза\n\n## 12.2 Базовые сценарии управления\nfit <- manage(fit)\n\n## 12.3 Пользовательские сценарии (постоянный вылов)\ncatchvals = c(10, 12, 15, 17) # Варианты вылова в тыс.тонн\n\nfor(i in seq_along(catchvals)){\n  fit <- add.man.scenario(\n    fit,\n    scenarioTitle = paste0(\"Постоянный вылов \", catchvals[i], \" тыс.т\"),\n    cabs = catchvals[i]  # Абсолютный вылов\n  )\n}\n\n## 12.4 Сводка по сценариям управления\nsumspict.manage(fit, include.unc = TRUE) # С учетом неопределенности\n```\n\nПолучаем:\n\n```{r}\n#| output: false\n#| eval: false\nSPiCT timeline:\n                                                  \n      Observations              Management        \n    2005.00 - 2025.00        2025.00 - 2026.00    \n |-----------------------| ----------------------|\n\nManagement evaluation: 2026.00\n\nPredicted catch for management period and states at management evaluation time:\n\n                                 C B/Bmsy F/Fmsy\n1. Keep current catch         11.8   1.31   0.52\n2. Keep current F             12.5   1.30   0.55\n3. Fish at Fmsy               22.0   1.20   1.00\n4. No fishing                  0.0   1.42   0.00\n5. Reduce F by 25%             9.5   1.33   0.41\n6. Increase F by 25%          15.4   1.27   0.68\n7. MSY hockey-stick rule      22.0   1.20   1.00\n8. ICES advice rule           19.9   1.23   0.90\n9. Постоянный вылов 10 тыс.т  10.0   1.32   0.43\n10. Постоянный вылов 12 тыс.т 12.0   1.30   0.53\n11. Постоянный вылов 15 тыс.т 15.0   1.27   0.66\n12. Постоянный вылов 17 тыс.т 17.0   1.25   0.76\n\n95% confidence intervals for states:\n\n                              B/Bmsy.lo B/Bmsy.hi F/Fmsy.lo F/Fmsy.hi\n1. Keep current catch              1.12      1.52      0.23      1.15\n2. Keep current F                  1.12      1.51      0.25      1.22\n3. Fish at Fmsy                    1.00      1.44      0.45      2.23\n4. No fishing                      1.25      1.63      0.00      0.00\n5. Reduce F by 25%                 1.15      1.54      0.18      0.92\n6. Increase F by 25%               1.08      1.49      0.31      1.53\n7. MSY hockey-stick rule           1.00      1.44      0.45      2.23\n8. ICES advice rule                1.03      1.46      0.40      2.00\n9. Постоянный вылов 10 тыс.т       1.14      1.54      0.19      0.97\n10. Постоянный вылов 12 тыс.т      1.12      1.52      0.24      1.17\n11. Постоянный вылов 15 тыс.т      1.09      1.49      0.30      1.48\n12. Постоянный вылов 17 тыс.т      1.06      1.48      0.34      1.69\n\n```\n\n![Рис. 14.: Правило хоккейной клюшки и ICES](images/SPICT14.PNG){fig-align=\"center\" width=\"80%\"}\n\n**Процесс прогнозирования и оценки сценариев управления**\n\n**1. Установка горизонта прогнозирования**\n\n```         \ninp$maninterval <- c(2025, 2026)\n```\n\n-   **Цель:** Определить период, для которого делаются прогнозы (2025-2026 гг.)\n-   **Механика:** Модель будет рассчитывать состояние запаса и возможный вылов на эти годы\n\n**2. Базовые сценарии управления**\n\n```         \nfit <- manage(fit)\n```\n\nАвтоматически генерируются стандартные сценарии:\n\n1.  **`currentCatch`**: Сохранение текущего вылова (среднее за последние 3 года)\n2.  **`currentF`**: Сохранение текущего уровня смертности (F)\n3.  **`Fmsy`**: Эксплуатация на уровне F~MSY~\n4.  **`noF`**: Полное прекращение промысла\n5.  **`reduceF25`**: Снижение F на 25%\n6.  **`increaseF25`**: Увеличение F на 25%\n7.  **`msyHockeyStick`**: Правило \"хоккейной клюшки\" (F=0 при B\\>B~MSY~, F=F~MSY~ при B≥B~MSY~)\n8.  **`ices`**: Правило ICES (F пропорционален уровню биомассы)\n\n**3. Пользовательские сценарии**\n\n```         \ncatchvals = c(10, 12, 15, 17) for(i in seq_along(catchvals)){   fit <- add.man.scenario(     fit,     scenarioTitle = paste0(\"Постоянный вылов \", catchvals[i], \" тыс.т\"),     cabs = catchvals[i]   ) }\n```\n\n-   **Стратегия:** Фиксированный вылов указанного объема в 2025-2026 гг.\n-   **Диапазон:** От консервативного (10 тыс.т) до рискованного (17 тыс.т)\n\n**4. Сводка результатов**\n\n```         \nsumspict.manage(fit, include.unc = TRUE)\n```\n\n**Ключевые выводы из результатов (на 2026 г.)**\n\n**1. Прогноз состояния запаса**\n\n| **Показатель** | **Значение** | **Интерпретация**                        |\n|:---------------|:-------------|:-----------------------------------------|\n| B/B~MSY~       | 1.25-1.31    | Запас выше целевого уровня (B\\>B~MSY~)   |\n| F/F~MSY~       | 0.52-0.55    | Эксплуатация ниже предельной (F\\<F~MSY~) |\n\n**2. Сравнение сценариев**\n\n| **Сценарий** | **Вылов (тыс.т)** | **B/**B~MSY~ | **F/**F~MSY~ | **Риск перелова** |\n|:---|:---|:---|:---|:---|\n| **Безопасные:** |  |  |  |  |\n| **`noF`** (нет промысла) | 0.0 | 1.42 | 0.00 | Нет |\n| **`reduceF25`** | 9.5 | 1.33 | 0.41 | Низкий |\n| Вылов 10 тыс.т | 10.0 | 1.32 | 0.43 | Низкий |\n| **Оптимальные:** |  |  |  |  |\n| **`currentCatch`** | 11.8 | 1.31 | 0.52 | Низкий |\n| Вылов 12 тыс.т | 12.0 | 1.30 | 0.53 | Низкий |\n| **Рискованные:** |  |  |  |  |\n| **`increaseF25`** | 15.4 | 1.27 | 0.68 | Умеренный |\n| Вылов 15 тыс.т | 15.0 | 1.27 | 0.66 | Умеренный |\n| **Опасные:** |  |  |  |  |\n| F~MSY~ | 22.0 | 1.20 | 1.00 | Высокий |\n| Вылов 17 тыс.т | 17.0 | 1.25 | 0.76 | Высокий |\n\n**3. Анализ неопределенности**\n\nДля ключевых сценариев:\n\n-   **Вылов 12 тыс.т:**\\\n    F/F~MSY~\\> = 0.53 \\[0.24-1.17\\] → 10% вероятность превышения F~MSY~\n\n-   **Вылов 15 тыс.т:**\\\n    F/F~MSY~ = 0.66 \\[0.30-1.48\\] → 30% вероятность превышения F~MSY~\n\n-   **Вылов 17 тыс.т:**\\\n    F/F~MSY~ = 0.76 \\[0.34-1.69\\] → 45% вероятность превышения F~MSY~\n\n**Рекомендации по управлению**\n\n1.  **Оптимальный вылов:** 12 тыс. тонн\n    -   Сохраняет запас в безопасной зоне (B/B~MSY~ \\> 1.3)\n    -   Минимизирует риск перелова (F/F~MSY~ \\< 0.55)\n    -   Учитывает неопределенность модельных оценок\n2.  **Предельно допустимый вылов:** 15 тыс. тонн\n    -   Требует усиленного мониторинга\n    -   Необходим ежегодный пересмотр квот\n3.  **Не рекомендуются:**\n    -   Сценарии с F≥F~MSY~ (22 тыс.т)\n    -   Фиксированный вылов \\>15 тыс.т\n    -   Стратегии, приводящие к снижению B/B~MSY~ \\< 1.25\n\n> **Критический фактор:** Высокая неопределенность прогноза вылова (дов. интервал 7.3-21.4 тыс.т для текущего сценария) требует осторожного подхода.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"chapter 5.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.29","bibliography":["references.bib"],"editor":"visual","theme":["cosmo","brand"],"title":"Продукционная модель SPiCT"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"chapter 5.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"editor":"visual","documentclass":"scrreprt","title":"Продукционная модель SPiCT"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}