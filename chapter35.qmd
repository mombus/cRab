---
title: "Модель истощения Лесли"
format: html
---

```{=html}
<div id="production-model" style="max-width: 1000px; margin: 0 auto;">
  <div class="controls" style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
    <h4 style="margin-top: 0;">Параметры модели</h4>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
      <div class="param-group">
        <h5>Биологические параметры:</h5>
        <div>
          <label style="display: block; margin-bottom: 10px;">
            <strong>B₀ (Начальная биомасса):</strong> 
            <input type="range" id="B0" min="100" max="2000" step="50" value="1000" style="width: 100%;">
            <span id="B0_value" style="margin-left: 10px;">1000</span>
          </label>
        </div>
        <div>
          <label style="display: block; margin-bottom: 10px;">
            <strong>K (Емкость среды):</strong>
            <input type="range" id="K" min="500" max="5000" step="100" value="2000" style="width: 100%;">
            <span id="K_value" style="margin-left: 10px;">2000</span>
          </label>
        </div>
        <div>
          <label style="display: block; margin-bottom: 10px;">
            <strong>r (Скорость роста):</strong>
            <input type="range" id="r" min="0.1" max="1.5" step="0.05" value="0.5" style="width: 100%;">
            <span id="r_value" style="margin-left: 10px;">0.5</span>
          </label>
        </div>
      </div>
      
      <div class="param-group">
        <h5>Промысловые параметры:</h5>
        <div>
          <label style="display: block; margin-bottom: 10px;">
            <strong>Ежегодный вылов (C):</strong> 
            <input type="range" id="C" min="0" max="300" step="10" value="100" style="width: 100%;">
            <span id="C_value" style="margin-left: 10px;">100</span>
          </label>
        </div>
        <div>
          <label style="display: block; margin-bottom: 10px;">
            <strong>Уровень шума (σ):</strong>
            <input type="range" id="noise" min="0" max="100" step="5" value="20" style="width: 100%;">
            <span id="noise_value" style="margin-left: 10px;">20</span>
          </label>
        </div>
        <div>
          <label style="display: block; margin-bottom: 10px;">
            <strong>MSY (расчетный):</strong>
            <span id="MSY_value" style="font-weight: bold; color: #d63384;">250</span>
          </label>
        </div>
      </div>
    </div>
  </div>
  
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
      <canvas id="biomassChart" width="500" height="300"></canvas>
    </div>
    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
      <canvas id="productionChart" width="500" height="300"></canvas>
    </div>
  </div>
  
  <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 20px;">
    <canvas id="combinedChart" width="1000" height="400"></canvas>
  </div>
  
  <div style="padding: 15px; background: #e8f4fd; border-radius: 5px; font-size: 14px;">
    <h5 style="margin-top: 0;">Уравнение модели:</h5>
    <p><strong>B<sub>t+1</sub> = B<sub>t</sub> + r × B<sub>t</sub> × (1 - B<sub>t</sub>/K) - C + ε</strong></p>
    <p>где: B - биомасса, r - скорость роста, K - емкость среды, C - вылов, ε - случайный шум ~ N(0,σ)</p>
    <p><strong>MSY = r × K / 4</strong> (Максимальный устойчивый вылов)</p>
  </div>
</div>

<!-- Подключаем Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Продукционная модель (модель Шеффера)
function productionModel(B, r, K) {
  return r * B * (1 - B / K);
}

// Генератор случайных чисел с нормальным распределением
function normalRandom(mean, stdDev) {
  let u = 0, v = 0;
  while(u === 0) u = Math.random();
  while(v === 0) v = Math.random();
  return mean + stdDev * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
}

let biomassChart = null;
let productionChart = null;
let combinedChart = null;

function simulatePopulation() {
  const B0 = parseFloat(document.getElementById('B0').value);
  const K = parseFloat(document.getElementById('K').value);
  const r = parseFloat(document.getElementById('r').value);
  const C = parseFloat(document.getElementById('C').value);
  const noiseLevel = parseFloat(document.getElementById('noise').value);
  
  // Обновляем отображаемые значения
  document.getElementById('B0_value').textContent = B0;
  document.getElementById('K_value').textContent = K;
  document.getElementById('r_value').textContent = r.toFixed(2);
  document.getElementById('C_value').textContent = C;
  document.getElementById('noise_value').textContent = noiseLevel;
  
  // Рассчитываем MSY
  const MSY = (r * K) / 4;
  document.getElementById('MSY_value').textContent = Math.round(MSY);
  
  // Генерируем данные за 2000-2100 годы
  const years = [];
  const biomass = [];
  const production = [];
  const catchData = [];
  const noiseData = [];
  
  let currentBiomass = B0;
  
  for (let year = 2000; year <= 2100; year++) {
    years.push(year);
    
    // Рассчитываем продукцию
    const productionValue = productionModel(currentBiomass, r, K);
    
    // Генерируем шум
    const noise = normalRandom(0, noiseLevel);
    
    // Обновляем биомассу
    currentBiomass = currentBiomass + productionValue - C + noise;
    
    // Ограничиваем биомассу снизу (не может быть отрицательной)
    currentBiomass = Math.max(0, currentBiomass);
    
    biomass.push(currentBiomass);
    production.push(productionValue);
    catchData.push(C);
    noiseData.push(noise);
  }
  
  return { years, biomass, production, catchData, noiseData, MSY };
}

function initCharts() {
  const data = simulatePopulation();
  
  // График биомассы
  const biomassCtx = document.getElementById('biomassChart').getContext('2d');
  biomassChart = new Chart(biomassCtx, {
    type: 'line',
    data: {
      labels: data.years,
      datasets: [{
        label: 'Биомасса (B)',
        data: data.biomass,
        borderColor: 'rgb(54, 162, 235)',
        backgroundColor: 'rgba(54, 162, 235, 0.1)',
        borderWidth: 2,
        tension: 0.1,
        fill: true
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Динамика биомассы',
          font: { size: 14 }
        }
      },
      scales: {
        x: {
          title: { display: true, text: 'Год' }
        },
        y: {
          title: { display: true, text: 'Биомасса' },
          min: 0
        }
      }
    }
  });
  
  // График продукции и вылова
  const productionCtx = document.getElementById('productionChart').getContext('2d');
  productionChart = new Chart(productionCtx, {
    type: 'line',
    data: {
      labels: data.years,
      datasets: [
        {
          label: 'Продукция (P)',
          data: data.production,
          borderColor: 'rgb(75, 192, 192)',
          backgroundColor: 'rgba(75, 192, 192, 0.1)',
          borderWidth: 2,
          tension: 0.1
        },
        {
          label: 'Вылов (C)',
          data: data.catchData,
          borderColor: 'rgb(255, 99, 132)',
          borderWidth: 2,
          borderDash: [5, 5],
          fill: false
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Продукция и вылов',
          font: { size: 14 }
        }
      },
      scales: {
        x: {
          title: { display: true, text: 'Год' }
        },
        y: {
          title: { display: true, text: 'Величина' },
          min: 0
        }
      }
    }
  });
  
  // Комбинированный график
  const combinedCtx = document.getElementById('combinedChart').getContext('2d');
  combinedChart = new Chart(combinedCtx, {
    type: 'line',
    data: {
      labels: data.years,
      datasets: [
        {
          label: 'Биомасса (B)',
          data: data.biomass,
          borderColor: 'rgb(54, 162, 235)',
          backgroundColor: 'rgba(54, 162, 235, 0.1)',
          borderWidth: 2,
          yAxisID: 'y',
          fill: true
        },
        {
          label: 'Продукция (P)',
          data: data.production,
          borderColor: 'rgb(75, 192, 192)',
          borderWidth: 2,
          yAxisID: 'y1'
        },
        {
          label: 'Вылов (C)',
          data: data.catchData,
          borderColor: 'rgb(255, 99, 132)',
          borderWidth: 2,
          borderDash: [5, 5],
          yAxisID: 'y1'
        },
        {
          label: 'MSY',
          data: Array(data.years.length).fill(data.MSY),
          borderColor: 'rgb(220, 53, 69)',
          borderWidth: 1,
          borderDash: [2, 2],
          yAxisID: 'y1',
          pointRadius: 0
        }
      ]
    },
    options: {
      responsive: true,
      interaction: {
        mode: 'index',
        intersect: false
      },
      plugins: {
        title: {
          display: true,
          text: 'Комбинированная динамика популяции',
          font: { size: 16 }
        },
        tooltip: {
          mode: 'index',
          intersect: false
        }
      },
      scales: {
        x: {
          title: { display: true, text: 'Год' }
        },
        y: {
          type: 'linear',
          display: true,
          position: 'left',
          title: { display: true, text: 'Биомасса' },
          min: 0
        },
        y1: {
          type: 'linear',
          display: true,
          position: 'right',
          title: { display: true, text: 'Продукция/Вылов' },
          min: 0,
          grid: {
            drawOnChartArea: false
          }
        }
      }
    }
  });
}

function updateCharts() {
  const data = simulatePopulation();
  
  if (biomassChart) {
    biomassChart.data.datasets[0].data = data.biomass;
    biomassChart.update();
  }
  
  if (productionChart) {
    productionChart.data.datasets[0].data = data.production;
    productionChart.data.datasets[1].data = data.catchData;
    productionChart.update();
  }
  
  if (combinedChart) {
    combinedChart.data.datasets[0].data = data.biomass;
    combinedChart.data.datasets[1].data = data.production;
    combinedChart.data.datasets[2].data = data.catchData;
    combinedChart.data.datasets[3].data = Array(data.years.length).fill(data.MSY);
    combinedChart.update();
  }
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
  initCharts();
  
  // Добавляем обработчики событий для ползунков
  document.getElementById('B0').addEventListener('input', updateCharts);
  document.getElementById('K').addEventListener('input', updateCharts);
  document.getElementById('r').addEventListener('input', updateCharts);
  document.getElementById('C').addEventListener('input', updateCharts);
  document.getElementById('noise').addEventListener('input', updateCharts);
});

// Обработчик изменения размера окна
window.addEventListener('resize', function() {
  if (biomassChart) biomassChart.resize();
  if (productionChart) productionChart.resize();
  if (combinedChart) combinedChart.resize();
});
</script>

<style>
.controls input[type="range"] {
  vertical-align: middle;
}

.controls label {
  font-family: Arial, sans-serif;
  font-size: 14px;
}

.param-group {
  padding: 15px;
  background: white;
  border-radius: 5px;
  border: 1px solid #e0e0e0;
}

.param-group h5 {
  margin: 0 0 15px 0;
  color: #333;
  font-size: 14px;
  border-bottom: 1px solid #eee;
  padding-bottom: 5px;
}

#production-model {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

#MSY_value {
  background: #f8f9fa;
  padding: 2px 8px;
  border-radius: 3px;
  border: 1px solid #dee2e6;
}
</style>
```
</div>
