---
title: "Моделирование дрейфа личинок"
format: html
---

![](images/LarvaeDrifting.PNG){fig-align="center" width="75%"}

## Введение

В фокусе нашего сегодняшнего рассмотрения находится вероятностное моделирование Лагранжева переноса — методология, занимающая центральное место в современной физической экологии и являющаяся основным инструментом для исследования процессов распространения морских организмов на ранних стадиях онтогенеза. Давайте разберемся, что скрывается за этим сложным термином. В основе его лежит фундаментальное разделение способов описания движения. Представьте себе океан. Вы можете изучать его, стоя на капитанском мосту и измеряя скорость и направление течения в фиксированных точках пространства — это Эйлеров подход, описывающий поле скоростей в координатах x, y, z. Но если вы хотите понять судьбу конкретной частицы, например, личинки краба, вы должны сесть на нее верхом и отправиться в путешествие, описывая изменение ее координат во времени — это и есть Лагранжев подход. Таким образом, Лагранжев перенос — это метод траекторного моделирования, который позволяет нам реконструировать путь, проходимый условной частицей в уже известном поле течений.

Однако океан — среда турбулентная и вероятностная по своей природе. Если бы мы просто перемещали частицу со средней скоростью течения, мы бы получили идеализированную, прямолинейную траекторию, которая имеет очень мало общего с реальностью. Реальная личинка подвергается воздействию целого спектра процессов, которые не отражены в осредненных полях скоростей: это и турбулентная диффузия, и ветровое дрейфовое течение, и мелкомасштабные вихри, и даже собственное поведение организма. Именно поэтому чисто детерминистическая Лагранжева модель была бы серьезным упрощением. Чтобы приблизиться к реальности, мы вводим вероятностную, или стохастическую, составляющую. По сути, мы признаем, что наше знание о поле течений неполно, и эта неполнота моделируется путем добавления случайных возмущений к основным параметрам — скорости и направлению движения.

В контексте данной модели эти возмущения вносятся двумя основными способами. Во-первых, это добавление случайной компоненты к направлению переноса. Вместо того чтобы строго следовать интерполированному направлению течения, частица на каждом шаге получает случайное отклонение, обычно распределенное по нормальному закону с нулевым средним, но с стандартным отклонением, которое задается на основе данных о естественной изменчивости течений. Во-вторых, аналогичным образом случайно модулируется и скорость движения частицы. Это позволяет учесть тот факт, что мгновенная скорость потока может отклоняться от осредненного по климатологии или по, например, декаде (10 дней) значения. Таким образом, каждая частица из одного и того же пункта выпуска проходит уникальный путь, и ансамбль из тысяч таких смоделированных траекторий образует так называемое «облако вероятности», которое визуализируется в виде карт плотности распределения.

Интерпретация результатов такой модели имеет принципиально вероятностный характер. Мы не можем сказать точно, куда приплывет личинка из точки *А*; мы можем сказать, что с вероятностью, скажем, 70% она окажется в радиусе 50 км от точки *B* через 30 дней, или что лишь 5% личинок достигнут отдаленного шельфового полигона. Этот вывод важен для решения целого ряда прикладных задач. Например, для оценки связности между разными участками популяции: модель показывает, возможен ли обмен личинками между двумя удаленными друг от друга банками или отмелями с зарослями водорослей, или же эти субпопуляции изолированы. Для планирования морских охраняемых районов (МРА) — чтобы понять, насколько эффективно тот или иной МРА может действовать как источник рекрутов для окружающих акваторий. Наконец, в условиях меняющегося климата такие модели позволяют строить прогнозы смещения ареалов видов и перестройки трофических цепей из-за изменения переноса на ранних стадиях жизни. В итоге, стохастическое Лагранжево моделирование превращается из чисто математического упражнения в мощный инструмент экологического прогнозирования, позволяющий заглянуть в будущее морских экосистем и дать количественную оценку тем процессам, которые мы не можем непосредственно наблюдать в полном объеме.

## Скрипт и входные данные

Давайте теперь подробно разберем, как именно работает этот сложный вычислительный организм — наша модель. Представьте, что мы проводим грандиозный виртуальный эксперимент, и я буду вашим гидом по его основным этапам. Все начинается с подготовки лаборатории: мы очищаем рабочее пространство от старых данных и загружаем весь необходимый инструментарий — специальные библиотеки для чтения сеточных данных в формате NetCDF, для их обработки, анализа и, что крайне важно, для визуализации. Без этого наш дальнейший анализ был бы просто невозможен. Затем мы подгружаем сами данные (4 файла [Bio-ORACLE](https://www.bio-oracle.org/downloads-to-email.php)), а это, напомню, массивные многомерные массивы, содержащие информацию о средних значениях и размахе скорости и направления течений по всему мировому океану. Но поскольку наша цель — Баренцево море, мы совершаем первую важную операцию — обрезаем эти глобальные данные до размеров нашего региона интереса, чтобы не тратить вычислительные ресурсы на обработку лишней информации. Это как взять подробную карту мира и вырезать из нее нужный нам квадрат. Но и эти данные неидеальны — в них могут встречаться пропуски или артефакты, поэтому мы проводим их очистку, заменяя аномальные значения на физически осмысленные консервативные оценки.

![](images/CurrBar.png){fig-align="center" width="60%"}

Теперь, когда у нас есть готовое к работе поле течений, мы определяем правила игры — набор функций, которые и являются математическим сердцем модели. Ключевая из них — функция билинейной интерполяции. Ее задача — быть переводчиком между дискретной сеткой наших данных и непрерывным миром, в котором движется личинка. Частица может находиться в любой точке, а не обязательно в узле сетки, где нам известны параметры течения. Эта функция берет четыре ближайших узла и вычисляет взвешенное среднее, плавно определяя скорость и направление течения именно в той точке, где находится наша виртуальная личинка в данный момент времени. Следующий важный блок — это функции, рассчитывающие перемещение. Одна из них, основанная на формуле гаверсинуса, умеет точно вычислять расстояние между двумя точками на сфере, что принципиально важно для корректности моделирования на планете Земля. А вторая — это уже непосредственно закон движения, который, зная текущую позицию, скорость, направление течения и временной шаг, вычисляет новую координату. И здесь в игру вступает та самая стохастичность: к интерполированным значениям скорости и направления мы добавляем случайные возмущения, параметры которых заданы на основе данных о естественной изменчивости течений. Именно это позволяет каждой частице из одной и той же начальной точки пойти по своему уникальному пути, имитируя воздействие турбулентности и других неучтенных процессов.

Наконец, мы запускаем сам эксперимент. Мы задаем координаты точек выпуска личинок — тех мест, где, как мы полагаем, происходит нерест. И затем для каждой точки мы выпускаем целое облако из сотни или тысячи виртуальных частиц-трассеров. Для каждой частицы мы в цикле, шаг за шагом, моделируем ее судьбу на протяжении девяноста дней. На каждом шестичасовом шаге мы интерполируем для нее поле течений, добавляем случайность, рассчитываем новое положение и сохраняем его. И так тысячи частиц, тысячи шагов — рождается огромный массив данных, трехмерный куб траекторий, где одно измерение — это точка выпуска, второе — номер частицы, а третье — временной шаг.

Но сырые координаты сами по себе не являются знанием. Следующая фаза — это пост-обработка и анализ, где мы превращаем этот массив чисел в понятные человеку образы и выводы. Мы преобразуем данные в удобный табличный формат и начинаем задавать им вопросы. Года находится основная масса личинок из каждой точки на 30-й день? Мы строим карты плотности вероятности, подсчитывая, в какие ячейки сетки попало больше всего частиц. Как далеко они уплывают и как рассеиваются? Мы считаем статистики — средние, максимальные дистанции, стандартные отклонения и площадь занимаемого ими облака. И наконец, мы визуализируем все эти результаты, создавая серию карт, которые наглядно показывают эволюцию облака рассеивания во времени, и графиков, показывающих динамику ключевых параметров. Весь этот путь — от чтения сырых данных до итоговых карт вероятности — и представляет собой замкнутый контур вероятностного моделирования Лагранжева переноса, который дает нам не точный прогноз, а наиболее вероятную картину развития событий в океане.

[Скрипт](https://mombus.github.io/cRab/data/LarvaeDriting.R).

ВХОДНЫЕ ДАННЫЕ (должны быть в рабочей директории), скачанные с сайта [Bio-ORACLE](https://www.bio-oracle.org/downloads-to-email.php):

1.  Среднее направление течений (градусы) - Current direction \[mean\].nc
2.  Диапазон направления течений (градусы) - Current direction \[range\].nc
3.  Средняя скорость течений (метры в секунду) - Current velocity \[mean\].nc
4.  Диапазон скорости течений (метры в секунду) - Current velocity \[range\].nc

![](images/LarvaeRose.PNG){fig-align="center" width="70%"}
